var B=Object.defineProperty;var q=(t,e,s)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var d=(t,e,s)=>(q(t,typeof e!="symbol"?e+"":e,s),s),L=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var n=(t,e,s)=>(L(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)};import{i as v,j as D,s as J,k as M,l as z,m as y,_ as H,o as g,a as Y,c as _,d as u,F,r as O,n as G,v as K,u as C,q as Q,f as W,t as P,x as X,y as Z,T as ee,p as te,h as se,b as T,z as ae,E as ne}from"./index.a3a5c436.js";import{g as ie}from"./hacks.4ce7539b.js";function oe(t,e,s){const a=new Map(t.map(i=>[s(i),i])),o=e.map(i=>a.has(s(i))?Object.assign(a.get(s(i)),i):i);t.splice(0,t.length,...o)}const w=v([]);async function R(){const t=await fetch("/api/datasets/");oe(w.value,await t.json(),e=>e.name)}let k=null;function Ee(){return k||(k=R()),w.value}function Ie(t){const e=w.value.find(a=>a.name===t);if(e)return e;const s=D({name:t});return w.value.push(s),k||(k=R()),s}function le(t,e=0){let s=3735928559^e,a=1103547991^e;for(let o=0,i;o<t.length;o++)i=t.charCodeAt(o),s=Math.imul(s^i,2654435761),a=Math.imul(a^i,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),4294967296*(2097151&a)+(s>>>0)}const re=1500,j=new Map;var l,f,c;class ce{constructor(){b(this,l,v([]));d(this,"steps",z(n(this,l)));d(this,"serverHash",v(null));d(this,"clientHash",y(()=>$(n(this,l).value)));d(this,"isModified",y(()=>this.serverHash.value!==this.clientHash.value));b(this,f,[]);b(this,c,[]);d(this,"canUndo",y(()=>(n(this,l).value,n(this,f).length>0)));d(this,"canRedo",y(()=>(n(this,l).value,n(this,c).length>0)))}restore(e){e!==this.steps.value&&(n(this,f).splice(0,n(this,f).length),n(this,c).splice(0,n(this,c).length),n(this,l).value=e)}update(e){n(this,c).splice(0,n(this,c).length),n(this,f).push(n(this,l).value),n(this,l).value=e}undo(){n(this,c).push(n(this,l).value),n(this,l).value=n(this,f).pop()}redo(){n(this,f).push(n(this,l).value),n(this,l).value=n(this,c).pop()}}l=new WeakMap,f=new WeakMap,c=new WeakMap;async function ue(t){return await(await fetch(`/api/datasets/${encodeURIComponent(t.name)}/configuration.json`)).json()}function $(t){return le(JSON.stringify(t))}function pe(t){if(!j.has(t.name)){const e=J({version:null,files:[],filters:new ce});j.set(t.name,e),ue(t).then(s=>{e.version=s.version,e.files.splice(0,e.files.length,...s.files),e.filters.restore(s.filters.map(a=>({...a,id:ie()}))),e.filters.serverHash.value=e.filters.clientHash.value,M(e.filters.clientHash,(a,o,i)=>{if(a===e.filters.serverHash.value)return;const x=setTimeout(async()=>{console.assert(e.filters.isModified.value,"filtersteps configuration is marked as not-modified"),console.assert(e.filters.clientHash.value===a,"hash changed after watch() but onCleanup was not called"),console.assert(a===$(e.filters.steps.value),"newHash does not match the hash for the current filtersteps configuration"),(await fetch(`/api/datasets/${encodeURIComponent(t.name)}/configuration.json`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({filters:e.filters.steps.value},null,2)})).ok&&(e.filters.serverHash.value=a)},re);i(()=>clearTimeout(x))})})}return j.get(t.name)}function Me(t){return pe(t).filters}function fe(t){switch(t.type){case"tuple":return t.parameters.map(e=>fe(e));case"list":return[];case"str":return"";default:return t.default}}const r=D({categories:[],mapping:{}});async function he(){return await(await fetch("/api/categories/")).json()}async function de(){return await fetch("/api/categories/",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)})}let I=null;function A(){return I||(I=he().then(t=>Object.assign(r,t))),r}function N(){return A().categories}function V(t){const e=A();return Object.entries(e.mapping).reduce((s,[a,o])=>o.includes(t.name)?[...s,e.categories.find(i=>i.name==a)]:s,[])}function ge(t,e){const s=new Set(t.map(a=>a.name));N().forEach(({name:a})=>{if(s.has(a))a in r.mapping?r.mapping[a].includes(e.name)||r.mapping[a].push(e.name):r.mapping[a]=[e.name];else if(a in r.mapping){let o;for(;(o=r.mapping[a].indexOf(e.name))!==-1;)r.mapping[a].splice(o,1)}}),de()}const ve=t=>(te("data-v-fdef0114"),t=t(),se(),t),me=ve(()=>u("header",null," Set categories ",-1)),_e={class:"category-list"},ye=["value"],Ce={__name:"CategoryPicker",setup(t,{expose:e}){const s=D({top:"0px",left:"0px"});v(!1);const a=v(null);let o=v(null);const i=y({get(){return a.value===null?null:o.value!==null?o.value:V(a.value)},set(h){o.value=h.slice()}});M(a,function(h,p){(h==null?void 0:h.name)!==(p==null?void 0:p.name)&&(o.value=null)},{deep:!0});function x(){console.assert(a.value!==null),o.value!==null&&(ge(o.value,a.value),o.value=null),S()}async function E(h,p){if(a.value=h,p){const m=p.target.getBoundingClientRect();Object.assign(s,{top:`${m.bottom}px`,left:`${m.left}px`})}}function S(){a.value=null}return e({showForDataset:E,hide:S}),(h,p)=>(g(),Y(ee,{to:"body"},[a.value!==null?(g(),_("div",{key:0,ref:"element",class:"popup",style:X(s)},[me,u("ol",_e,[(g(!0),_(F,null,O(C(N)(),m=>(g(),_("li",{key:m.name},[u("label",null,[G(u("input",{type:"checkbox","onUpdate:modelValue":p[0]||(p[0]=U=>Q(i)?i.value=U:null),value:m},null,8,ye),[[K,C(i)]]),W(" "+P(m.name),1)])]))),128))]),u("footer",null,[u("button",{onClick:S},"Cancel"),u("button",{onClick:x},"Apply")])],4)):Z("",!0)]))}},be=H(Ce,[["__scopeId","data-v-fdef0114"]]);const we={class:"tags-container"},ke={class:"category-tags"},xe={class:"tag-name"},Se={__name:"TagsEditor",props:{dataset:Object},setup(t){const e=t,s=v();return(a,o)=>(g(),_("div",we,[u("div",ke,[(g(!0),_(F,null,O(C(V)(e.dataset),i=>(g(),_("span",{class:"tag",key:i.name},[T(C(ae)),u("span",xe,P(i.name),1)]))),128))]),u("button",{class:"icon-button",onClick:o[0]||(o[0]=i=>s.value.showForDataset(e.dataset,i)),title:"Change dataset tags"},[T(C(ne))]),T(be,{ref_key:"categoryPicker",ref:s},null,512)]))}},He=H(Se,[["__scopeId","data-v-d8e2ba32"]]);export{He as T,Me as a,Ie as b,fe as d,Ee as g};
