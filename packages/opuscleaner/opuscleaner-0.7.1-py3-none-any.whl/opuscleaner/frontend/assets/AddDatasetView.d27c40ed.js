var U=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var b=(e,t,r)=>(U(e,t,"read from private field"),r?r.call(e):t.get(e)),V=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},M=(e,t,r,i)=>(U(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);var j=(e,t,r)=>(U(e,t,"access private method"),r);import{i as f,j as re,k as ie,_ as K,o as d,c as u,d as n,F as X,r as Q,a4 as O,t as w,u as o,b as c,bF as ce,y as P,bG as de,p as W,h as Y,bH as ue,m as v,aL as pe,n as T,bw as ge,w as z,R as F,v as he,f as p,bx as _e,a as we,T as fe,bI as J,bJ as me,bK as be}from"./index.943e6c8e.js";import{C as A}from"./vue-select.eb0a0fe1.js";function ve(e){const t=e==0?0:Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}const q=f(0);async function m(e,t){try{q.value+=1;const r=await fetch(e,t);if(!r.ok)throw new Error(r.status);return await r.json()}finally{q.value-=1}}var h,C,Z;class ye{constructor(t,r){V(this,C);V(this,h,void 0);this.interval=t,this.callback=r}start(){b(this,h)&&clearTimeout(b(this,h)),M(this,h,setTimeout(j(this,C,Z).bind(this),this.interval))}stop(){clearTimeout(b(this,h)),M(this,h,null)}restart(){this.stop(),this.start()}}h=new WeakMap,C=new WeakSet,Z=function(){Promise.resolve(this.callback()).then(()=>{b(this,h)&&this.start()})};const _=re({});function Le(){return _}function Ie(e){m(`/api/download/downloads/${encodeURIComponent(e.entry.id)}`,{method:"DELETE"}).then(t=>{_[t.entry.id]=t})}function ke(e){ae(e.entry)}async function De(e){return await m("/api/download/downloads/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.map(({id:t})=>({id:t})))})}async function ee(){return await m("/api/download/downloads/")}function te(e){De(e).then(t=>{Object.assign(_,B(t))})}function ae(e){return te([e])}function D(e){return e.id in _&&["pending","downloading","downloaded"].includes(_[e.id].state)&&_[e.id]}async function Oe(){return await m("/api/download/languages/")}async function Ce(e){return await m(`/api/download/languages/${encodeURIComponent(e)}`)}async function Ne(e){return await m(`/api/download/by-language/${encodeURIComponent(e)}`)}let H=new ye(1e3,async()=>{const e=await ee();Object.assign(_,B(e))});ie(_,e=>{const t=new Set(["pending","downloading"]);Object.values(e).some(r=>t.has(r.state))?H.restart():H.stop()});function B(e){return Object.fromEntries(e.map(t=>[t.entry.id,t]))}ee().then(e=>{Object.assign(_,B(e))});const Se=e=>(W("data-v-f0874565"),e=e(),Y(),e),$e={class:"downloads-popup"},Ue=Se(()=>n("summary",null,"Downloads",-1)),Ve={class:"corpus-name"},Me={class:"download-state"},Te=["onClick"],Ae=["onClick"],Be={__name:"DownloadPopup",setup(e){return(t,r)=>(d(),u("details",$e,[Ue,n("ul",null,[(d(!0),u(X,null,Q(o(Le)(),i=>(d(),u("li",{key:i.entry.id,class:O(i.state)},[n("span",Ve,w(i.entry.corpus),1),n("em",Me,w(i.state),1),["pending","downloading"].includes(i.state)?(d(),u("button",{key:0,onClick:L=>o(Ie)(i),title:"Cancel download"},[c(o(ce))],8,Te)):P("",!0),["failed","cancelled"].includes(i.state)?(d(),u("button",{key:1,onClick:L=>o(ke)(i),title:"Retry download"},[c(o(de))],8,Ae)):P("",!0)],2))),128))])]))}},xe=K(Be,[["__scopeId","data-v-f0874565"]]);const y=e=>(W("data-v-f5e717bd"),e=e(),Y(),e),Ge={class:"downloader"},Re=y(()=>n("h1",{class:"datasets-catalogue-title"},[p(" Datasets catalogue "),n("small",null,[n("em",null,"TODO"),p(" datasets")])],-1)),Ee={class:"search-inputs"},je={class:"segmented-control"},Pe={class:"sort-order"},ze=["disabled"],Fe={class:"dataset-list"},Je=["id"],qe={class:"dataset-name"},He={class:"dataset-title"},Ke=["href"],Xe={key:0,class:"download-dataset-button",disabled:"disabled"},Qe={key:1,class:"download-dataset-button",disabled:""},We=["onClick"],Ye={class:"metadata-dataset"},Ze=y(()=>n("dt",null,"Version",-1)),et={title:"Version"},tt=y(()=>n("dt",null,"Languages",-1)),at={title:"Languages"},st=y(()=>n("dt",null,"Pairs",-1)),nt={title:"Sentence pairs"},ot=y(()=>n("dt",null,"Size",-1)),lt={title:"Download size"},rt={__name:"AddDatasetView",props:{preprocessing:{type:String,default:"bilingual"},languages:{type:Array,default:()=>[]}},setup(e){const t=e;function r(l){return l!=""}const i={MONOLINGUAL:"monolingual",BILINGUAL:"bilingual"};window.localStorage["add-dataset-preprocessing"]=t.preprocessing,window.localStorage["add-dataset-languages"]=t.languages.join(";");const L=ue(),x=[{label:"Corpus name",compare:(l,s)=>l.corpus.localeCompare(s.corpus)},{label:"Download size",compare:(l,s)=>s.size-l.size},{label:"Sentence pairs",compare:(l,s)=>s.pairs-l.pairs}],N=f(x[0]),S=new Map,$=new Map,I=f(""),k=f(!0),G=f(),se=v(()=>{if(!t.languages[0])return[];if(!S.has(t.languages[0])){const l=f([]);S.set(t.languages[0],l),Ce(t.languages[0]).then(s=>{l.value=s})}return S.get(t.languages[0]).value}),ne=v(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(G.value||[]).map(s=>{try{return{lang:s,label:`${l.of(s)} (${s})`}}catch{return{lang:s,label:s}}})}),oe=v(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(se.value||[]).map(s=>{try{return{lang:s,label:`${l.of(s)} (${s})`}}catch{return{lang:s,label:s}}})}),R=v(()=>{let l;switch(t.preprocessing){case i.BILINGUAL:if(!t.languages[0]||!t.languages[1])return[];l=`${t.languages[0]}-${t.languages[1]}`;break;case i.MONOLINGUAL:if(!t.languages[0])return[];l=`${t.languages[0]}`;break;default:throw new Error("Unknown preprocessing type")}if(!$.has(l)){const a=f([]);$.set(l,a),Ne(l).then(g=>a.value=g)}let s=$.get(l).value;return I.value.length>0&&(s=s.filter(({corpus:a,group:g})=>a.toLowerCase().indexOf(I.value.toLowerCase())!==-1)),s=s.filter(a=>{switch(t.preprocessing){case i.BILINGUAL:return a.langs.filter(r).length>1;case i.MONOLINGUAL:return a.langs.filter(r).length==1;default:return!1}}),k.value&&(s=Array.from(s.reduce((a,g)=>((!a.has(g.corpus)||a.get(g.corpus).version<g.version)&&a.set(g.corpus,g),a),new Map).values())),s.sort(N.value.compare),s}),E=v(()=>R.value.filter(l=>!("paths"in l||D(l))));pe(async()=>{Oe().then(l=>{G.value=l})});const le=new Intl.NumberFormat;return(l,s)=>(d(),u("div",Ge,[Re,n("div",Ee,[n("label",null,[T(n("input",{type:"search",placeholder:"Search dataset\u2026","onUpdate:modelValue":s[0]||(s[0]=a=>I.value=a)},null,512),[[ge,I.value]])]),n("span",je,[c(o(F),{class:O({"search-button":!0,checked:e.preprocessing==i.MONOLINGUAL}),to:{name:"add-dataset",params:{preprocessing:i.MONOLINGUAL,languages:t.languages.slice(0,1)}}},{default:z(()=>[p(" Monolingual ")]),_:1},8,["class","to"]),c(o(F),{class:O({"search-button":!0,checked:e.preprocessing==i.BILINGUAL}),to:{name:"add-dataset",params:{preprocessing:i.BILINGUAL,languages:t.languages}}},{default:z(()=>[p(" Bilingual ")]),_:1},8,["class","to"])]),n("label",{class:O(["search-button",{checked:k.value}])},[T(n("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=a=>k.value=a)},null,512),[[he,k.value]]),p(" Latest only ")],2),n("label",null,[c(o(A),{options:o(ne),reduce:({lang:a})=>a,modelValue:t.languages[0],"onUpdate:modelValue":s[2]||(s[2]=a=>o(L).push({name:"add-dataset",params:{preprocessing:t.preprocessing,languages:[a].concat(t.languages.slice(1))}})),placeholder:"Origin language"},null,8,["options","reduce","modelValue"])]),T(n("label",null,[c(o(A),{options:o(oe),reduce:({lang:a})=>a,modelValue:t.languages[1],"onUpdate:modelValue":s[3]||(s[3]=a=>o(L).push({name:"add-dataset",params:{preprocessing:t.preprocessing,languages:[t.languages[0],a]}})),placeholder:"Target language"},null,8,["options","reduce","modelValue"])],512),[[_e,e.preprocessing==i.BILINGUAL]]),n("label",Pe,[p(" Sort by: "),c(o(A),{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=a=>N.value=a),options:x,placeholder:"Sort order"},null,8,["modelValue"])]),n("button",{class:"download-dataset-button",onClick:s[5]||(s[5]=a=>o(te)(o(E))),disabled:o(E).length===0},[p(" Download all "),c(o(J),{class:"download-icon"})],8,ze)]),n("div",Fe,[(d(!0),u(X,null,Q(o(R),a=>(d(),u("div",{class:"dataset",key:a.id,id:`did-${a.id}`},[n("div",qe,[n("h3",He,[n("a",{href:`https://opus.nlpl.eu/${a.corpus}-${a.version}.php`,target:"_blank"},w(a.corpus),9,Ke)]),"paths"in a||o(D)(a).state==="downloaded"?(d(),u("button",Xe,[p(" Downloaded "),c(o(me),{class:"download-icon"})])):o(D)(a)?(d(),u("button",Qe,[p(w(o(D)(a).state)+" ",1),c(o(be),{class:"download-icon loading-spinner"})])):(d(),u("button",{key:2,class:"download-dataset-button",onClick:g=>o(ae)(a)},[p(" Download "),c(o(J),{class:"download-icon"})],8,We))]),n("dl",Ye,[Ze,n("dd",et,w(a.version),1),tt,n("dd",at,w(a.langs.filter(r).join("\u2192")),1),st,n("dd",nt,w(a.pairs?o(le).format(a.pairs):""),1),ot,n("dd",lt,w(a.size?o(ve)(a.size):""),1)])],8,Je))),128))]),(d(),we(fe,{to:".navbar"},[c(xe)]))]))}},ut=K(rt,[["__scopeId","data-v-f5e717bd"]]);export{ut as default};
