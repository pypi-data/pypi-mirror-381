{% load dynforms %}
<div class="controls" id="{{ field.name }}__controls">
    <div>{{ field.instructions }}</div>
    <table class="w-100 table table-ruled">
        <thead>
        <tr class="text-center">
            <th></th>
            {% for rubric in field.rubrics %}
            <th scope="col" class="col text-nowrap">{{ rubric }}</th>
            {% endfor %}
            <th>N/A</th>
        </tr>
        </thead>
        <tbody>
        {% with field|likert_scores as scores %}
        {% for choice in field|likert_choices:data %}
            <tr>
                <td class="text-left text-nowrap">
                    {{ choice.name }}
                    <input type="hidden" name="{{ field.name }}__{{ choice.index }}__name"
                           value="{{ choice.name }}"
                    />
                    <input type="hidden" name="{{ field.name }}__{{ choice.index }}__label"
                           value="{{ choice.label }}" id="{{ field.name }}-{{ choice.index }}-label"
                    />
                </td>
                {% for score in scores %}
                <td class="text-center">
                    <input type="radio" class="form-check-input {{ required }} label-src" aria-label="{{ score.rubric }}"
                           data-label-field="#{{ field.name }}-{{ choice.index }}-label"
                           data-label-value="{{ score.rubric }}"
                           name="{{ field.name }}__{{ choice.index }}__value" value="{{ score.value }}"
                           {% if choice.value == score.value %}checked{% endif %}
                    />
                </td>
                {% endfor %}
                <td class="text-center">
                    <input type="radio" class="form-check-input label-src" {{ required }} aria-label="N/A"
                           data-label-field="#{{ field.name }}-{{ choice.index }}-label"
                           data-label-value="N/A"
                           name="{{ field.name }}__{{ choice.index }}__value"
                    />
                </td>
            </tr>
        {% endfor %}
        {% endwith %}
        </tbody>
    </table>
    <script>
        // set the label from the rubric when the value changes
        $(document).ready(function(){
            $(document).on("change", '#{{ field.name }}__controls input.label-src', function() {
                const $labelField = $($(this).data('label-field'));
                if ($(this).is(':checked') && $labelField.length) {
                    $labelField.val($(this).data('label-value'));
                }
            });
        });
    </script>
</div>