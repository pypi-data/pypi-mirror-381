version: "3.8"

services:
  diagram-ai-generator:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: diagram-ai-generator
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      # Mount output directory to persist generated diagrams
      - ./generated_diagrams:/app/generated_diagrams
      # Mount configuration if needed
      - ./config:/app/config:ro
    ports:
      - "8080:8080"
    restart: "no"
    # Healthcheck deshabilitado para evitar reinicios
    # healthcheck:
    #   test: ["CMD", "python3", "-c", "import sys; sys.path.append('/app'); from src.application.services.diagram_service import DiagramService; print('OK')"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 10s

  # Optional: Add a web interface or API gateway
  # nginx:
  #   image: nginx:alpine
  #   container_name: diagram-ai-nginx
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #   depends_on:
  #     - diagram-ai-generator
  #   restart: unless-stopped

volumes:
  generated_diagrams:
    driver: local
