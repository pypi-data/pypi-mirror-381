name: Build and Publish Docs

on:
    # run this workflow when dev checks pass
    push:
        branches:
            - main

    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:

jobs:
    # This workflow contains a single job called "docs"
    docs:
        name: Build and deploy docs

        strategy:
            matrix:
                os: [ubuntu-latest]
                python-version: ["3.12"]

        runs-on: ${{ matrix.os }}

        steps:
            - name: Get repo
              uses: actions/checkout@v4

            - name: Get gh-pages branch
              run: git fetch origin gh-pages --depth=1

            # - name: Configure git for github-actions[bot]
            #   run: |
            #       git config --global user.name "github-actions[bot]"
            #       git config --global user.email "github-actions[bot]@users.noreply.github.com"

            - name: Install the latest version of uv
              id: setup-uv
              uses: astral-sh/setup-uv@v6

            - name: Set up Python
              run: uv sync --python ${{ matrix.python-version }} --all-extras

            - name: Build docs
              run: uv run mkdocs build

            - name: Publish docs
              run: uv run mkdocs gh-deploy --force --remote-branch gh-pages --remote-name origin
