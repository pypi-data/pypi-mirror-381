{% macro display_card(card, actions=True) %}
  {%
  set brand_logos = {
    "visa" : "https://js.stripe.com/v3/fingerprinted/img/visa-d6c6e0a636f7373e06d5fb896ad49475.svg",
    "mastercard" : "https://js.stripe.com/v3/fingerprinted/img/mastercard-a96ee3841a5e1e28d05ed3f0f4da62b8.svg",
    "american express" : "https://js.stripe.com/v3/fingerprinted/img/amex-edf6011de255d8a4c22904795c9d8770.svg",
    "discover" : "https://js.stripe.com/v3/fingerprinted/img/discover-8f3d8fc6ef836da1fcac12c095ee6fb8.svg",
    "diners club" : "https://js.stripe.com/v3/fingerprinted/img/diners-fced9e136fd8c25f40a3e7b37a51dc1d.svg",
    "jcb" : "https://js.stripe.com/v3/fingerprinted/img/jcb-1b12d588a1e9465d4d9fb84a610f9136.svg",
    "unionpay" : "https://js.stripe.com/v3/fingerprinted/img/unionpay-en-099cb6671310a54f640ac16d5f2a825c.svg",
  }
  %}

  <section class="payment-card">

    <div class="card-details">
    <img src="{{ brand_logos[card.card.brand] }}" style="width: 92px; float: left; margin-right: 10px; margin-top: 10px;">
    <br/>
    <b>{{ card.card.brand }}</b>
    <br/>
    ending in <b>{{ card.card.last4 }}</b>
    <br/>
    <span class="opacity-60">
    expiring {{ card.card.exp_month }}/{{ card.card.exp_year }}
    </span>
    </div>

    <br/>
    <div style="margin-top: -12px;">
    {% if actions %}
      <center>
      <a href="/billing/confirm-update-card/delete-card/{{ card.id }}"><button type="button">delete</button></a>
      <a href="/billing/confirm-update-card/make-card-active/{{ card.id }}" class="button button-small button-white"><button type="button">make active</button></a>
      </center>
    {% endif %}
    </div>
  <br/>
  </section>


{% endmacro %}


{% macro new_card() %}
<script src="/static/js/jquery.min.js"></script>
<script src="https://js.stripe.com/v3/"></script>
<form action="/billing/add-card?shop_id={{ request.shop.id }}" method="post" data-secret="{{ client_secret }}" id="payment-form">
  {% include 'snippets/csrf.j2' %}
  <div class="form-row">

    <div id="payment-element">
      <!-- Elements will create form elements here -->
    </div>
  
    <!--
    -->
    <a href="https://stripe.com/docs/security/stripe" target="_blank"><img style="width: initial;" src="https://stripe.com/img/about/logos/badge/outline-dark.svg"></a>

    <button class="green-button button-max-width" style="margin-bottom: 0px; margin-top: 8px;">&#128274; Save Card</button>
    

    <!-- Used to display Element errors. -->
    <div id="error-message" role="alert" style="font-weight: bold;"></div>

  </div>
</form>

<script>

//$(document).ready(function() {
$(function () {

  var stripe = Stripe("{{ request.shop.stripe_public_api_key }}");

  const options = {clientSecret: '{{ client_secret }}'};

  var elements = stripe.elements(options);

  // Create and mount the Payment Element
  const paymentElement = elements.create('payment');
  paymentElement.mount('#payment-element');

  // confirm stripe payment method setup intent.
  var form = document.getElementById('payment-form');

  form.addEventListener('submit', async (event) => {
    event.preventDefault();
  
    const {error} = await stripe.confirmSetup({
      //`Elements` instance that was used to create the Payment Element
      elements,
      confirmParams: {
        return_url: '{{ request.route_url("add-card", shop_id=request.shop.id) }}',
      }
    });
  
    if (error) {
      // This point will only be reached if there is an immediate error when
      // confirming the payment. Show error to your customer (for example, payment
      // details incomplete)
      const messageContainer = document.querySelector('#error-message');
      messageContainer.textContent = error.message;
    } else {
      // Your customer will be redirected to your `return_url`. For some payment
      // methods like iDEAL, your customer will be redirected to an intermediate
      // site first to authorize the payment, then redirected to the `return_url`.
    }

  });

});

</script>
{% endmacro %}
