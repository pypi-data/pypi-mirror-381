# ğŸ—ï¸ EchoFrame æ¶æ„æ–‡æ¡£

## æ¶æ„æ¦‚è¿°

EchoFrame æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å¯æ‰©å±•çš„ OneBot-11 æœºå™¨äººæ¡†æ¶ï¼Œé‡‡ç”¨æ’ä»¶åŒ–å’Œä¸­é—´ä»¶è®¾è®¡ã€‚

---

## ğŸ“Š æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           EchoFrame 2.0                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   æ ¸å¿ƒå±‚ï¼ˆCore Layerï¼‰            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ Bot æ ¸å¿ƒ                       â”‚ â”‚
â”‚  â”‚  â€¢ æ’ä»¶ç³»ç»Ÿï¼ˆçƒ­åŠ è½½ï¼‰             â”‚ â”‚
â”‚  â”‚  â€¢ ä¸­é—´ä»¶ç³»ç»Ÿ                     â”‚ â”‚
â”‚  â”‚  â€¢ å¿ƒè·³ç®¡ç†                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   åŒ…è£…å±‚ï¼ˆWrapper Layerï¼‰         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ Message/Event è½»é‡åŒ…è£…         â”‚ â”‚
â”‚  â”‚  â€¢ MS å·¥å‚ç±»                      â”‚ â”‚
â”‚  â”‚  â€¢ æ‰©å±•æ–¹æ³•                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   é€šä¿¡å±‚ï¼ˆAdapter Layerï¼‰         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ AioCQHTTP é€‚é…å™¨ï¼ˆåå‘ï¼‰       â”‚ â”‚
â”‚  â”‚  â€¢ WebSocket å®¢æˆ·ç«¯ï¼ˆæ­£å‘ï¼‰       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â†“                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   aiocqhttp     â”‚
         â”‚  ï¼ˆåº•å±‚åº“ï¼‰      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  OneBot å®ç°    â”‚
         â”‚ (Lagrangeç­‰)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒæ¨¡å—

### 1. Bot æ ¸å¿ƒï¼ˆcore/bot.pyï¼‰

**èŒè´£**ï¼š
- ç®¡ç†æœºå™¨äººç”Ÿå‘½å‘¨æœŸ
- åè°ƒå„ä¸ªæ¨¡å—
- æä¾›ç»Ÿä¸€çš„ API

**ä¸»è¦æ–¹æ³•**ï¼š
```python
await bot.start()          # å¯åŠ¨
await bot.stop()           # åœæ­¢
await bot.send(event, msg) # å‘é€æ¶ˆæ¯
bot.is_superuser(user_id)  # æƒé™æ£€æŸ¥
```

---

### 2. æ’ä»¶ç³»ç»Ÿï¼ˆcore/plugin.pyï¼‰

**ç‰¹è‰²åŠŸèƒ½**ï¼š
- çƒ­åŠ è½½/çƒ­é‡è½½
- å¯ç”¨/ç¦ç”¨
- å®æ—¶å¯¼å…¥
- Web API å‹å¥½

**æ ¸å¿ƒç±»**ï¼š
- `PluginManager` - æ’ä»¶ç®¡ç†å™¨
- `Plugin` - æ’ä»¶åŸºç±»
- `PluginMetadata` - å…ƒæ•°æ®
- `PluginStatus` - çŠ¶æ€æšä¸¾
- `PluginOperationResult` - æ“ä½œç»“æœ

**è£…é¥°å™¨**ï¼š
```python
@on_command("/cmd")    # å‘½ä»¤å¤„ç†
@on_message()          # æ¶ˆæ¯äº‹ä»¶
@on_notice()           # é€šçŸ¥äº‹ä»¶
@on_request()          # è¯·æ±‚äº‹ä»¶
```

---

### 3. ä¸­é—´ä»¶ç³»ç»Ÿï¼ˆcore/middleware.pyï¼‰

**èŒè´£**ï¼š
- äº‹ä»¶å¤„ç†å‰åé’©å­
- ç»Ÿä¸€çš„å¤„ç†æµç¨‹

**å†…ç½®ä¸­é—´ä»¶**ï¼š
- `log_middleware` - æ—¥å¿—å’Œæ€§èƒ½
- `auth_middleware` - æƒé™å’Œé»‘åå•
- `rate_limit_middleware` - é™æµé˜²åˆ·
- `error_handler_middleware` - é”™è¯¯å¤„ç†

**è‡ªå®šä¹‰ä¸­é—´ä»¶**ï¼š
```python
@middleware(priority=100)
async def my_middleware(bot, event, next):
    # å‰ç½®å¤„ç†
    result = await next()
    # åç½®å¤„ç†
    return result
```

---

### 4. æ¶ˆæ¯ç³»ç»Ÿï¼ˆcore/message.pyï¼‰

**è½»é‡çº§åŒ…è£…**ï¼Œåº•å±‚ä½¿ç”¨ `aiocqhttp.Message`

**MS å·¥å‚ç±»**ï¼š
```python
msg = MS.text("æ–‡æœ¬") + MS.face(14) + MS.image(url)
```

**æ”¯æŒçš„æ¶ˆæ¯æ®µ**ï¼š26 ç§ OneBot-11 æ ‡å‡†æ¶ˆæ¯æ®µ

---

### 5. äº‹ä»¶ç³»ç»Ÿï¼ˆcore/event.pyï¼‰

**è½»é‡çº§åŒ…è£…**ï¼Œåº•å±‚ä½¿ç”¨ `aiocqhttp.Event`

**æ‰©å±•æ–¹æ³•**ï¼š
```python
event.is_group()           # æ˜¯å¦ç¾¤èŠ
event.is_to_me()           # æ˜¯å¦ @ æœºå™¨äºº
event.get_message_text()   # è·å–çº¯æ–‡æœ¬
event.has_image()          # æ˜¯å¦æœ‰å›¾ç‰‡
event.get_images()         # è·å–å›¾ç‰‡åˆ—è¡¨
```

---

## ğŸ”Œ é€šä¿¡å±‚

### é€‚é…å™¨æ¨¡å¼

æ”¯æŒä¸¤ç§è¿æ¥æ¨¡å¼ï¼š

#### 1. AioCQHTTP é€‚é…å™¨ï¼ˆåå‘ï¼‰
- ä½¿ç”¨ aiocqhttp åº“
- EchoFrame ä½œä¸ºæœåŠ¡ç«¯
- OneBot å®ç°è¿æ¥è¿‡æ¥

#### 2. WebSocket å®¢æˆ·ç«¯ï¼ˆæ­£å‘ï¼‰
- è½»é‡çº§å®ç°ï¼ˆ~180 è¡Œï¼‰
- EchoFrame ä½œä¸ºå®¢æˆ·ç«¯
- ä¸»åŠ¨è¿æ¥åˆ° OneBot å®ç°

---

## ğŸ“¦ æ•°æ®æµ

```
OneBot å®ç°
    â”‚
    â”œâ”€ [äº‹ä»¶] â”€â”€â†’ AioCQHTTP/WebSocket å®¢æˆ·ç«¯
    â”‚                      â†“
    â”‚              Adapter Layer
    â”‚                      â†“
    â”‚              Event Parsing
    â”‚                      â†“
    â”‚              Middleware Chain
    â”‚                      â†“
    â”‚              Plugin Manager
    â”‚                      â†“
    â”‚              Event Handlers
    â”‚                      â†“
    â”‚              Bot.send()
    â”‚                      â†“
    â”‚              Adapter.call_api()
    â”‚                      â†“
    â”œâ”€ [API è°ƒç”¨] â†â”€ AioCQHTTP/WebSocket å®¢æˆ·ç«¯
    â”‚
OneBot å®ç°
```

---

## ğŸ¯ æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

```
1. å¯åŠ¨é˜¶æ®µ
   â””â”€ load_plugins_from_dir()
      â””â”€ load_plugin_from_dir()
         â””â”€ Plugin.__init__()
            â””â”€ Plugin.on_load()

2. è¿è¡Œé˜¶æ®µ
   â”œâ”€ æ¥æ”¶äº‹ä»¶
   â”œâ”€ ä¸­é—´ä»¶å¤„ç†
   â”œâ”€ æ’ä»¶å¤„ç†
   â””â”€ å‘é€å“åº”

3. çƒ­åŠ è½½é˜¶æ®µ
   â””â”€ reload_plugin()
      â”œâ”€ Plugin.on_unload()
      â”œâ”€ æ¸…ç†æ¨¡å—
      â”œâ”€ é‡æ–°å¯¼å…¥
      â””â”€ Plugin.on_load()

4. åœæ­¢é˜¶æ®µ
   â””â”€ cleanup_plugins()
      â””â”€ Plugin.on_unload()
```

---

## ğŸ’¡ è®¾è®¡åŸåˆ™

### 1. åˆ†å±‚è®¾è®¡
- æ ¸å¿ƒå±‚ï¼šæ ¸å¿ƒåŠŸèƒ½
- åŒ…è£…å±‚ï¼šç®€åŒ– API
- é€šä¿¡å±‚ï¼šåº•å±‚å®ç°

### 2. æ’ä»¶åŒ–
- æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥æ’ä»¶åŒ–
- çƒ­åŠ è½½æ”¯æŒ
- æœ€å°ä¾èµ–

### 3. å¯æ‰©å±•æ€§
- ä¸­é—´ä»¶ç³»ç»Ÿ
- è£…é¥°å™¨é£æ ¼
- Web API å‹å¥½

### 4. è½»é‡çº§
- ä½¿ç”¨æˆç†Ÿçš„åº“ï¼ˆaiocqhttpï¼‰
- ä»£ç ç²¾ç®€ï¼ˆ~2700 è¡Œï¼‰
- æœ€å°ä¾èµ–

---

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

- **å¼‚æ­¥ I/O** - é«˜å¹¶å‘
- **äº‹ä»¶é©±åŠ¨** - ä½å»¶è¿Ÿ
- **è¿æ¥æ± ** - aiocqhttp è‡ªåŠ¨ç®¡ç†
- **è‡ªåŠ¨é‡è¿** - ç½‘ç»œç¨³å®š

---

## ğŸ”§ æ‰©å±•ç‚¹

### 1. è‡ªå®šä¹‰é€‚é…å™¨

```python
class MyAdapter:
    async def start(self): ...
    async def call_api(self, action, **params): ...
```

### 2. è‡ªå®šä¹‰ä¸­é—´ä»¶

```python
@middleware(priority=100)
async def my_middleware(bot, event, next):
    return await next()
```

### 3. è‡ªå®šä¹‰æ’ä»¶

```python
class MyPlugin(Plugin):
    async def on_load(self): ...
    async def on_unload(self): ...
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [QUICK_START.md](QUICK_START.md) - å¿«é€Ÿå¼€å§‹
- [CONFIG_GUIDE.md](CONFIG_GUIDE.md) - é…ç½®æŒ‡å—
- [PLUGIN_DEVELOPMENT_GUIDE.md](../PLUGIN_DEVELOPMENT_GUIDE.md) - æ’ä»¶å¼€å‘

---

**äº†è§£ EchoFrame çš„æ¶æ„è®¾è®¡ï¼** ğŸ—ï¸

