{
  "$id": "ptag.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "x-canonical": "https://civic-interconnect.github.io/civic-transparency-ptag-spec/en/spec/schemas/ptag.schema.json",
  "title": "Provenance Tag",
  "description": "Per-post provenance tags. Values are bucketed/categorical-no PII or direct identifiers.",
  "$defs": {
    "AcctAge": {
      "type": "string",
      "enum": ["0-7d", "8-30d", "1-6m", "6-24m", "24m+"]
    },
    "AcctType": {
      "type": "string",
      "enum": [
        "person",
        "org",
        "media",
        "public_official",
        "unverified",
        "declared_automation"
      ]
    },
    "AutomationFlag": {
      "type": "string",
      "enum": ["manual", "scheduled", "api_client", "declared_bot"]
    },
    "PostKind": {
      "type": "string",
      "enum": ["original", "reshare", "quote", "reply"]
    },
    "ClientFamily": {
      "type": "string",
      "enum": ["web", "mobile", "third_party_api"]
    },
    "MediaProvenance": {
      "type": "string",
      "enum": ["c2pa_present", "hash_only", "none"]
    },
    "ISO3166CountryOrSubdivision": {
      "type": "string",
      "description": "Uppercase ISO-3166-1 alpha-2 country code, optionally with ISO-3166-2 subdivision (e.g., US or US-CA).",
      "pattern": "^[A-Z]{2}(-[A-Z0-9]{1,3})?$"
    },
    "HexHash8": {
      "type": "string",
      "description": "Fixed 8-character lowercase hex hash (privacy-preserving, daily salted).",
      "pattern": "^[a-f0-9]{8}$",
      "minLength": 8,
      "maxLength": 8
    }
  },
  "type": "object",
  "properties": {
    "acct_age_bucket": {
      "description": "Account age bucketed for privacy: e.g., '0-7d', '8-30d', '1-6m', '6-24m', '24m+'.",
      "allOf": [{ "$ref": "#/$defs/AcctAge" }]
    },
    "acct_type": {
      "description": "Declared identity account type.",
      "allOf": [{ "$ref": "#/$defs/AcctType" }]
    },
    "automation_flag": {
      "description": "Posting method with clear boundaries: manual (direct user interaction), scheduled (user-configured delayed posting), api_client (third-party tools like Buffer/Hootsuite), declared_bot (automated systems with explicit bot declaration).",
      "allOf": [{ "$ref": "#/$defs/AutomationFlag" }]
    },
    "post_kind": {
      "description": "Content relationship: original, reshare, quote, reply.",
      "allOf": [{ "$ref": "#/$defs/PostKind" }]
    },
    "client_family": {
      "description": "Application class: web, mobile, third_party_api.",
      "allOf": [{ "$ref": "#/$defs/ClientFamily" }]
    },
    "media_provenance": {
      "description": "Embedded authenticity: c2pa_present, hash_only, none.",
      "allOf": [{ "$ref": "#/$defs/MediaProvenance" }]
    },
    "dedup_hash": {
      "description": "Privacy-preserving rolling hash for duplicate detection (fixed 8 hex characters, salted daily to prevent cross-dataset correlation).",
      "allOf": [{ "$ref": "#/$defs/HexHash8" }]
    },
    "origin_hint": {
      "description": "Geographic origin limited to country-level (ISO country codes) or major subdivisions only for populations >1M, e.g., 'US', 'US-CA', where lawful.",
      "allOf": [{ "$ref": "#/$defs/ISO3166CountryOrSubdivision" }]
    }
  },
  "required": [
    "acct_age_bucket",
    "acct_type",
    "automation_flag",
    "post_kind",
    "client_family",
    "media_provenance",
    "dedup_hash"
  ],
  "additionalProperties": false,
  "examples": [
    {
      "acct_age_bucket": "0-7d",
      "acct_type": "person",
      "automation_flag": "api_client",
      "post_kind": "reshare",
      "client_family": "mobile",
      "media_provenance": "hash_only",
      "origin_hint": "US-CA",
      "dedup_hash": "9a4b2c1d"
    }
  ]
}
