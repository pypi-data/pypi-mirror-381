---
name: plan
description: "Plan how to implement the specified feature. This is the third step in the Spec-Driven Development lifecycle."
ai_assistant: "{{ ai_assistant }}"
command_prefix: "{{ assistant_command_prefix if assistant_command_prefix else '' }}"
---

Plan how to implement the specified feature.

This is the third step in the Spec-Driven Development lifecycle.

Given the implementation details provided as an argument, do this:

1. Run `specifyx run setup-plan setup --json` (or `uvx specifyx run setup-plan setup --json` if specifyx not found) from the repo root and parse JSON for FEATURE_SPEC, IMPL_PLAN, SPECS_DIR, BRANCH. All future file paths must be absolute.
   
   **For No-Branch Workflow:**
   - If multiple specs exist on main branch, you must specify which spec to work with: `specifyx run setup-plan setup --spec-id 001 --json`
   - The error message will show available spec IDs if `--spec-id` is required
   
   **Troubleshooting:**
   - Check current status first: `specifyx run setup-plan check [--spec-id 001]`
   - If the command is unclear, run: `specifyx run setup-plan --help`
   - If error shows "Multiple specs available", add `--spec-id` with the desired spec number
2. Read and analyze the feature specification to understand:
   - The feature requirements and user stories
   - Functional and non-functional requirements
   - Success criteria and acceptance criteria
   - Any technical constraints or dependencies mentioned

3. Read the constitution at `.specify/memory/constitution.md` to understand constitutional requirements.

4. Execute the implementation plan template:
   - Load `.specify/templates/plan-template.j2` (already copied to IMPL_PLAN path)
   - Set Input path to FEATURE_SPEC
   - Run the Execution Flow (main) function steps 1-10
   - The template is self-contained and executable
   - Follow error handling and gate checks as specified
   - Let the template guide artifact generation in $SPECS_DIR:
     * Phase 0 generates research.md
     * Phase 1 generates data-model.md, contracts/, quickstart.md
     * Phase 2 generates tasks.md
   - Incorporate user-provided details from arguments into Technical Context: {ARGS}
   - Update Progress Tracking as you complete each phase

5. Verify execution completed:
   - Check Progress Tracking shows all phases complete
   - Ensure all required artifacts were generated
   - Confirm no ERROR states in execution

6. Report results with branch name, file paths, and generated artifacts.

Use absolute paths with the repository root for all file operations to avoid path issues.

{% if assistant_workflow_integration -%}

**{{ ai_assistant | title }} Integration:**
{{ assistant_workflow_integration }}
{% endif %}

{% if assistant_custom_commands -%}

**Available Commands:**
{{ assistant_custom_commands }}
{% endif %}

{% if assistant_command_prefix -%}

**Command Prefix:** `{{ assistant_command_prefix }}`
{% endif %}

**Next Steps After Planning:**
- **Continue workflow**: Use `/tasks` to break down plans into executable tasks (auto-detect from branch)
- **No-branch workflow**: Use `/tasks` with `--spec-id` parameter if working on main branch
- **Review plans**: Re-run `/clarify` if implementation planning reveals new ambiguities in requirements