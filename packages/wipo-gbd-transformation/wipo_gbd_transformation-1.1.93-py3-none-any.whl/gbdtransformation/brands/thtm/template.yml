{% from 'navigation.tmpl' import match %}

{% call(header) match('TradeMarkTransactionBody.TransactionContentDetails', Transaction) %}
type: {{ header | translate_type }}

{% call(trademark) match('TransactionData.TradeMarkApplication.TradeMarkDetails.TradeMark', header) %}
kind: {{ trademark | translate_kind(header) }}

reference:
{% if header | is_international %}
  office: WO
  registration:
    - number: {{ trademark | get_ir_refnum }}
{% endif %}

registrationOfficeCode: {{ trademark.RegistrationOfficeCode }}
designatedCountries:
  - {{ trademark.RegistrationOfficeCode }}

applicationLanguageCode: {{ trademark.ApplicationLanguageCode }}

{% set tmstatus = trademark | translate_status %}
gbdStatus: {{ tmstatus }}
officeStatus: {{ trademark.MarkCurrentStatusCode }}
statusDate: {{ trademark.MarkCurrentStatusDate }}
publicationDate: {{ (trademark.PublicationDetails.Publication | last).PublicationDate }}

markFeature: {{ trademark | translate_feature }}

st13: {{ trademark.ApplicationNumber | st13('TH', appdate=trademark.ApplicationDate) }}
applicationNumber: {{ trademark.ApplicationNumber }}
applicationDate: {{ trademark.ApplicationDate }}
registrationNumber: {{ trademark | get_registration_nb(tmstatus) }}
registrationDate: {{ trademark | get_registration_date(tmstatus) }}

expiryDate: {{ trademark | get_expiry_date(tmstatus) }}

{% if tmstatus == 'Ended' %}
terminationDate: {{ trademark.MarkCurrentStatusDate }}
{% endif %}

markDisclaimerDetails:
  {% call(disclaimer) match('MarkDisclaimerDetails.MarkDisclaimer', trademark) %}
  - text: {{ disclaimer.__value }}
    languageCode: {{ disclaimer.__value | guess_language(disclaimer._languageCode, default=trademark.ApplicationLanguageCode) }}
  {% endcall %}

wordMarkSpecification:
  {% call(wordSpec) match('WordMarkSpecification', trademark) %}
  {% set verbal_by_language = wordSpec.MarkVerbalElementText | verbal_lang_map(applang=trademark.ApplicationLanguageCode) %}
  markVerbalElement:
    {% for lang, verbals in verbal_by_language.items() %}
    {% for verbal in verbals %}
    - languageCode: {{ lang }}
      text: {{ verbal }}
    {% endfor %}
    {% endfor %}
  markTranslation:
    {% call(trans) match('MarkTranslation', wordSpec) %}
    - text: {{ trans }}
      languageCode: {{ trans | guess_language(trans._languageCode, trademark.ApplicationLanguageCode) }}
    {% endcall %}
  {% endcall %}

markImageDetails:
  {% call(img) match('MarkImageDetails.MarkImage', trademark) %}
    - name: {{ trademark.ApplicationNumber }}
      {% call(cclaim) match('MarkImageColourClaimedText', img) %}
      {% if not cclaim.__value  == 'N/A' %}
      colourIndicator: {{ cclaim.__value | remove_trailing('-') | get_true_or_false }}
      colourClaimed:
        - text: {{ cclaim.__value | remove_trailing('-') }}
          languageCode: {{  cclaim.__value | remove_trailing('-') | guess_language(cclaim._languageCode, trademark.ApplicationLanguageCode) }}
      {% endif %}
      {% endcall %}

      # thtm uses this as device description
      {% call(signif) match('WordMarkSpecification.MarkSignificantVerbalElement', trademark) %}
      description:
        - text: {{ signif }}
          languageCode: {{ signif | guess_language(signif._languageCode, trademark.ApplicationLanguageCode) }}
      {% endcall %}

      {% call(category) match('MarkImageCategory', img) %}
      classification:
        kind: {{ category.CategoryKind }}
        version: {{ category.CategoryVersion }}
        code:
          {% call(vc) match('CategoryCodeDetails.CategoryCode', category) %}
            - {{ vc }}
          {% endcall %}
      {% endcall %}
  {% endcall %}

{% call(nc_gs) match('GoodsServicesDetails.GoodsServices', trademark) %}
goodsServicesClassification:
  kind: Nice
  version: {{ ASK_THE_OFFICE }}
  class:
    {% call(nice) match('ClassDescriptionDetails.ClassDescription', nc_gs) %}
    - code: {{ nice.ClassNumber | int }}
      terms:
      {% if nice.GoodsServicesDescription | has_value %}
      {% call(desc) match('GoodsServicesDescription', nice) %}
        {{ nice.GoodsServicesDescription.__value | guess_language(nice.GoodsServicesDescription._languageCode, trademark.ApplicationLanguageCode) | field_name}}:
        {% for gsline in nice.GoodsServicesDescription.__value | remove_trailing('.', '-') | split_terms %}
          - {{ gsline | lower }}
        {% endfor %}
      {% endcall %}
      {% endif %}
    {% endcall %}
{% endcall %}

applicants:
  {% call(applicant) match('ApplicantDetails.Applicant', trademark) %}
    {% call(details) match('ApplicantAddressBook.FormattedNameAddress.Name.FreeFormatName', applicant) %}
      - identifier: {{ details.ApplicantIdentifier }}
        fullName:
          {% call(nameline) match('FreeFormatNameDetails.FreeFormatNameLine', details) %}
          {% if not nameline.__value == '-' %}
          - text: {{ nameline }}
            languageCode: {{ nameline.__value | guess_language(nameline._languageCode, trademark.ApplicationLanguageCode) }}
          {% endif %}
          {% endcall %}
      {% endcall %}
      {% call(address) match('ApplicantAddressBook.FormattedNameAddress.Address', applicant) %}
        fullAddress:
          {% call(adrline) match('FreeFormatAddress.FreeFormatAddressLine', address) %}
          {% if not adrline == '-' %}
          - text: {{ adrline }}
            languageCode: {{ adrline | guess_language(adrline._languageCode, trademark.ApplicationLanguageCode) }}
          {% endif %}
          {% endcall %}
        countryCode: {{ address.AddressCountryCode | remove_trailing('-') }}
      {% endcall %}
    {% endcall %}

representatives:
  {% call(representative) match('RepresentativeDetails.Representative', trademark) %}
    {% call(details) match('RepresentativeAddressBook.FormattedNameAddress.Name.FreeFormatName', representative) %}
      - identifier: {{ details.RepresentativeIdentifier }}
        fullName:
          {% call(nameline) match('FreeFormatNameDetails.FreeFormatNameLine', details) %}
          - text: {{ nameline }}
            languageCode: {{ nameline.__value | guess_language(nameline._languageCode, trademark.ApplicationLanguageCode) }}
          {% endcall %}
      {% endcall %}
      {% call(address) match('RepresentativeAddressBook.FormattedNameAddress.Address', representative) %}
        fullAddress:
          {% call(adrline) match('FreeFormatAddress.FreeFormatAddressLine', address) %}
          {% if not adrline == '-' %}
          - text: {{ adrline }}
            languageCode: {{ adrline | guess_language(adrline._languageCode, trademark.ApplicationLanguageCode) }}
          {% endif %}
          {% endcall %}
        countryCode: {{ address.AddressCountryCode | remove_trailing('-') }}
      {% endcall %}
    {% endcall %}

priorities:
  {% call(priority) match('PriorityDetails.Priority', trademark) %}
    - countryCode: {{ priority.PriorityCountryCode }}
      number: {{ priority.PriorityNumber }}
      date: {{ priority.PriorityDate }}
  {% endcall %}

events:
  {% call(event) match('MarkEventDetails.MarkEvent', trademark) %}
    - officeKind: {{ event.MarkEventCode }}
      gbdKind: {{ event.MarkEventCode | translate_event }}
      date: {{ event.MarkEventDate }}
  {% endcall %}

{% endcall %}
{% endcall %}
