"use strict";(self.webpackChunkjupyter_offlinenotebook=self.webpackChunkjupyter_offlinenotebook||[]).push([[154],{154:(o,e,n)=>{n.r(e),n.d(e,{OfflineNotebookButtons:()=>N,default:()=>j});var t=n(12),l=n(256),r=n(23),a=n(296),i=n(794),s=n(61),c=n.n(s);let d=null,f=null,u=null,p=null,b=null;class k extends(c()){constructor(){super("jupyter-offlinenotebook"),this.version(1).stores({offlinenotebook:"pk, repoid, name, type"}),this.offlinenotebook=this.table("offlinenotebook")}}function h(){return b||(b=new k,console.log("offline-notebook: Opened IndexedDB")),b}function w(){const o=document.createElement("a");document.body.appendChild(o),o.href=u,o.target="_blank",o.style.display="none",o.click(),document.body.removeChild(o)}function g(){return d}function m(){return f}function y(){return p}var v=n(751),B=n.n(v);const C="jp-OfflineNotebookToolbarIcon",x={activate:function(o){console.log("Activating jupyter-offlinenotebook JupyterLab extension");const e=r.PageConfig.getBaseUrl(),n=a.ServerConnection.makeSettings();a.ServerConnection.makeRequest(e+"offlinenotebook/config",{},n).then(async o=>{var e;e=await o.json(),d=e.repoid,d?console.log("offline-notebook repoid: "+d):console.log("offline-notebook repoid not found, disabled"),f=e.binder_repo_label||"Repo",console.log("offline-notebook repoLabel: "+f),u=e.binder_ref_url,console.log("offline-notebook binderRefUrl: "+u),p=e.binder_persistent_url,console.log("offline-notebook binderPersistentUrl: "+p)}),o.docRegistry.addWidgetExtension("Notebook",new N)},id:"offlinenotebook:offlineNotebookButtons",autoStart:!0};class N{createNew(o,e){const n=[];if(n.push(["downloadVisible",new i.ToolbarButton({className:"downloadVisible",iconClass:"fas fa-download "+C,onClick:()=>{!function(o){var e;const n=o.context.path.replace(/.*\//,""),t=null===(e=o.content.model)||void 0===e?void 0:e.toJSON();if(!t){const o="Content model is null";throw(0,i.showErrorMessage)("Local storage error",o),o}!function(o,e){const n=new Blob([JSON.stringify(e)],{type:"application/x-ipynb+json"}),t=window.URL.createObjectURL(n),l=document.createElement("a");document.body.appendChild(l),l.href=t,l.style.display="none",l.download=o,console.log("offlinenotebook: "+o,n),l.click(),window.URL.revokeObjectURL(t),document.body.removeChild(l)}(n,t)}(o)},tooltip:"Download visible",label:"Download"})]),g()&&(n.push(["saveToBrowser",new i.ToolbarButton({className:"saveToBrowser",iconClass:"fas fa-cloud-download-alt "+C,onClick:()=>{!function(o){var e;const n=o.context.path,t=null===(e=o.content.model)||void 0===e?void 0:e.toJSON();if(!t){const o="Content model is null";throw(0,i.showErrorMessage)("Local storage error",o),o}const l=D(n);!function(o,e){const n="repoid:"+d+" path:"+o;h().offlinenotebook.put({pk:n,repoid:d,name:o.replace(/.*\//,""),path:o,format:"json",type:"notebook",content:e}).then(o=>(o=>(console.log("offline-notebook saved: ",o),(0,i.showDialog)({title:"Notebook saved to browser storage",body:l,buttons:[i.Dialog.okButton()]})))(o)).catch(o=>(o=>{throw(0,i.showErrorMessage)("Local storage IndexedDB error",o),o})(o))}(n,t)}(o)},tooltip:"Save to browser storage"})]),n.push(["loadFromBrowser",new i.ToolbarButton({className:"loadFromBrowser",iconClass:"fas fa-cloud-upload-alt "+C,onClick:()=>{!function(o){const e=o.context.path,n=D(e),t="repoid:"+g()+" path:"+e;!function(o,e){const n="repoid:"+d+" path:"+o;h().offlinenotebook.get(n).then(o=>e(o)).catch(o=>(o=>{throw(0,i.showErrorMessage)("Local storage IndexedDB error",o),o})(o))}(e,e=>{if(e)return console.log("offline-notebook found "+t),(0,i.showDialog)({title:"This will replace your current notebook with",body:n,buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:"OK"})]}).then(n=>{if(n.button.accept&&!o.context.isDisposed){const n=function(o,e){return"object"==typeof o&&null!==o&&e in o?o[e]:null}(e,"content");n?o.context.model.fromJSON(n):(0,i.showErrorMessage)("Invalid notebook",'"content" not found')}});console.log("offline-notebook not found "+t),(0,i.showErrorMessage)("Notebook not found in browser storage",t)})}(o)},tooltip:"Restore from browser storage"})])),u){const o={GitHub:"fab fa-github",GitLab:"fab fa-gitlab",Git:"fab fa-git"};n.push(["openRepo",new i.ToolbarButton({className:"openRepo",iconClass:(o[m()]||"fas fa-external-link-alt")+" "+C,onClick:w,tooltip:"Visit Binder repository",label:m()})])}return y()&&n.push(["linkToBinder",new i.ToolbarButton({className:"linkToBinder",iconClass:"fas fa-link "+C,onClick:()=>{!function(o){const e=o.context.path,n=y()+"?urlpath="+encodeURIComponent("lab/tree/"+e);(0,i.showDialog)({title:"Share Binder link",body:new L(n),buttons:[i.Dialog.okButton()]})}(o)},tooltip:"Link to this Binder",label:"Binder"})]),n.reverse(),n.forEach(e=>{o.toolbar.insertItem(9,e[0],e[1])}),new t.DisposableDelegate(()=>{n.forEach(o=>{o[1].dispose()})})}}function D(o){return"repoid: "+g()+" path: "+o}class L extends l.Widget{constructor(o){super({node:R(o)})}}function R(o){const e=B()("<div/>",{style:"flex-direction: row;","data-url":o}).append(B()("<pre/>",{text:o,style:"margin: 0; white-space: pre-wrap; word-break: break-all;"})),n=B()("<button/>",{title:"Copy binder link to clipboard","data-url":o}).click(()=>{!function(o){const e=B()("<input>");B()(o).parent().append(e),e.val(B()(o).data("url")).select(),document.execCommand("copy"),e.remove()}(n)});return n.append(B()("<i/>",{class:"fas fa-clipboard"})),e.append(n),e.get(0)}const j=x}}]);