import"./CWj6FrbW.js";import{p as at,g as e,a7 as Z,u as gt,c as H,s as G,r as q,J as L,t as Q,d as T,a as rt,aw as ft,f as ct}from"./CH6P3X75.js";import{n as B,a as V,t as mt}from"./RmD8FzRo.js";import{i as J,s as bt,a as xt}from"./DA6bFLPR.js";import{p as j,b as ut,a as W}from"./DQXoLcsF.js";import{Y as it,Z as yt,$ as wt,l as c,z as vt,a0 as zt,N as $,a1 as kt}from"./DQe_kdRt.js";import"./6t3IJ0vQ.js";import{o as St}from"./DEgUu98i.js";import"./8NsknIT2.js";import"./CxFKfZ9T.js";import"./keKYsoph.js";import"./69_IOA4Y.js";import"./CCx7Ho51.js";import{s as K}from"./DGTPl6Gk.js";function st(r,t){const n={...r};return n.x=Math.round(Math.max(t.x,Math.min(n.x,t.x+t.width-n.width))),n.y=Math.round(Math.max(t.y,Math.min(n.y,t.y+t.height-n.height))),n.width=Math.round(Math.min(n.width,t.x+t.width-n.x)),n.height=Math.round(Math.min(n.height,t.y+t.height-n.y)),n}function X(r){return typeof r=="string"?new it([[document.querySelector(r)]],[document.documentElement]):new it([[r]],yt)}function _t(r){let t;for(;t=r.sourceEvent;)r=t;return r}function lt(r,t){if(r=_t(r),t===void 0&&(t=r.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var u=n.createSVGPoint();return u.x=r.clientX,u.y=r.clientY,u=u.matrixTransform(t.getScreenCTM().inverse()),[u.x,u.y]}if(t.getBoundingClientRect){var w=t.getBoundingClientRect();return[r.clientX-w.left-t.clientLeft,r.clientY-w.top-t.clientTop]}}return[r.pageX,r.pageY]}const Mt={passive:!1},N={capture:!0,passive:!1};function tt(r){r.stopImmediatePropagation()}function O(r){r.preventDefault(),r.stopImmediatePropagation()}function Rt(r){var t=r.document.documentElement,n=X(r).on("dragstart.drag",O,N);"onselectstart"in t?n.on("selectstart.drag",O,N):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Dt(r,t){var n=r.document.documentElement,u=X(r).on("dragstart.drag",null);t&&(u.on("click.drag",O,N),setTimeout(function(){u.on("click.drag",null)},0)),"onselectstart"in n?u.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const p=r=>()=>r;function et(r,{sourceEvent:t,subject:n,target:u,identifier:w,active:z,x:i,y:x,dx:g,dy:o,dispatch:d}){Object.defineProperties(this,{type:{value:r,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:u,enumerable:!0,configurable:!0},identifier:{value:w,enumerable:!0,configurable:!0},active:{value:z,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:x,enumerable:!0,configurable:!0},dx:{value:g,enumerable:!0,configurable:!0},dy:{value:o,enumerable:!0,configurable:!0},_:{value:d}})}et.prototype.on=function(){var r=this._.on.apply(this._,arguments);return r===this._?this:r};function Tt(r){return!r.ctrlKey&&!r.button}function Ct(){return this.parentNode}function Et(r,t){return t??{x:r.x,y:r.y}}function jt(){return navigator.maxTouchPoints||"ontouchstart"in this}function ht(){var r=Tt,t=Ct,n=Et,u=jt,w={},z=wt("start","drag","end"),i=0,x,g,o,d,f=0;function l(a){a.on("mousedown.drag",v).filter(u).on("touchstart.drag",M).on("touchmove.drag",E,Mt).on("touchend.drag touchcancel.drag",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(a,b){if(!(d||!r.call(this,a,b))){var s=Y(this,t.call(this,a,b),a,b,"mouse");s&&(X(a.view).on("mousemove.drag",S,N).on("mouseup.drag",D,N),Rt(a.view),tt(a),o=!1,x=a.clientX,g=a.clientY,s("start",a))}}function S(a){if(O(a),!o){var b=a.clientX-x,s=a.clientY-g;o=b*b+s*s>f}w.mouse("drag",a)}function D(a){X(a.view).on("mousemove.drag mouseup.drag",null),Dt(a.view,o),O(a),w.mouse("end",a)}function M(a,b){if(r.call(this,a,b)){var s=a.changedTouches,h=t.call(this,a,b),_=s.length,y,k;for(y=0;y<_;++y)(k=Y(this,h,a,b,s[y].identifier,s[y]))&&(tt(a),k("start",a,s[y]))}}function E(a){var b=a.changedTouches,s=b.length,h,_;for(h=0;h<s;++h)(_=w[b[h].identifier])&&(O(a),_("drag",a,b[h]))}function C(a){var b=a.changedTouches,s=b.length,h,_;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),h=0;h<s;++h)(_=w[b[h].identifier])&&(tt(a),_("end",a,b[h]))}function Y(a,b,s,h,_,y){var k=z.copy(),R=lt(y||s,b),F,U,m;if((m=n.call(a,new et("beforestart",{sourceEvent:s,target:l,identifier:_,active:i,x:R[0],y:R[1],dx:0,dy:0,dispatch:k}),h))!=null)return F=m.x-R[0]||0,U=m.y-R[1]||0,function P(A,nt,dt){var ot=R,I;switch(A){case"start":w[_]=P,I=i++;break;case"end":delete w[_],--i;case"drag":R=lt(dt||nt,b),I=i;break}k.call(A,a,new et(A,{sourceEvent:nt,subject:m,target:l,identifier:_,active:I,x:R[0]+F,y:R[1]+U,dx:R[0]-ot[0],dy:R[1]-ot[1],dispatch:k}),h)}}return l.filter=function(a){return arguments.length?(r=typeof a=="function"?a:p(!!a),l):r},l.container=function(a){return arguments.length?(t=typeof a=="function"?a:p(a),l):t},l.subject=function(a){return arguments.length?(n=typeof a=="function"?a:p(a),l):n},l.touchable=function(a){return arguments.length?(u=typeof a=="function"?a:p(!!a),l):u},l.on=function(){var a=z.on.apply(z,arguments);return a===z?l:a},l.clickDistance=function(a){return arguments.length?(f=(a=+a)*a,l):Math.sqrt(f)},l}function Lt({handle:r,getCurrentBbox:t,onResize:n,onDragEnd:u,onInteractionStart:w,onInteractionEnd:z}){let i;return ht().on("start",()=>{i=t(),w==null||w()}).on("drag",x=>{let g=i.x,o=i.y,d=i.width,f=i.height;const l=x.x-x.subject.x,v=x.y-x.subject.y;switch(r){case"nw":g=i.x+l,o=i.y+v,d=i.width-l,f=i.height-v;break;case"ne":o=i.y+v,d=i.width+l,f=i.height-v;break;case"sw":g=i.x+l,d=i.width-l,f=i.height+v;break;case"se":d=i.width+l,f=i.height+v;break;case"n":o=i.y+v,f=i.height-v;break;case"s":f=i.height+v;break;case"w":g=i.x+l,d=i.width-l;break;case"e":d=i.width+l;break}const S=1;d<S&&(d=S,r.includes("w")&&(g=i.x+i.width-S)),f<S&&(f=S,r.includes("n")&&(o=i.y+i.height-S));const D=Math.round(g),M=Math.round(o),E=Math.round(d),C=Math.round(f);n&&n({x:D,y:M,width:E,height:C})}).on("end",()=>{const{x,y:g,width:o,height:d}=t();u&&u({x,y:g,width:o,height:d}),z==null||z()})}function Pt({getCurrentBbox:r,onMove:t,onDragEnd:n,onInteractionStart:u,onInteractionEnd:w}){let z;return ht().on("start",()=>{z=r(),u==null||u()}).on("drag",i=>{const x=i.x-i.subject.x,g=i.y-i.subject.y,o=Math.round(z.x+x),d=Math.round(z.y+g);t&&t({x:o,y:d,width:z.width,height:z.height})}).on("end",()=>{const i=r();n&&n(i),w==null||w()})}var Ft=B('<text dominant-baseline="middle" text-anchor="end"> </text><text text-anchor="middle"> </text><text dominant-baseline="middle" text-anchor="end"> </text>',1),Xt=B('<g><rect stroke-width="2" pointer-events="all" vector-effect="non-scaling-stroke" class="movable-rectangle" style="cursor: move;"></rect><!></g>');function Yt(r,t){at(t,!0);const n=j(t,"bbox",15),u=j(t,"colorStroke",3,"#007bff"),w=j(t,"colorFill",3,"transparent"),z=j(t,"opacity",3,.3),i=j(t,"handleSize",3,12),x=j(t,"scale",3,1),g=T(()=>n().x),o=T(()=>n().y),d=T(()=>n().width),f=T(()=>n().height);let l=Z(void 0),v=Z(!1);function S(){if(!e(l))return;const b=i()/x(),s=Math.min(b,e(d)*.1,e(f)*.1),h=[{id:"nw",x:e(g)-s/2,y:e(o)-s/2,cursor:"nwse-resize",label:"Resize northwest corner"},{id:"ne",x:e(g)+e(d)-s/2,y:e(o)-s/2,cursor:"nesw-resize",label:"Resize northeast corner"},{id:"sw",x:e(g)-s/2,y:e(o)+e(f)-s/2,cursor:"nesw-resize",label:"Resize southwest corner"},{id:"se",x:e(g)+e(d)-s/2,y:e(o)+e(f)-s/2,cursor:"nwse-resize",label:"Resize southeast corner"},{id:"n",x:e(g)+e(d)/2-s/2,y:e(o)-s/2,cursor:"ns-resize",label:"Resize top edge"},{id:"s",x:e(g)+e(d)/2-s/2,y:e(o)+e(f)-s/2,cursor:"ns-resize",label:"Resize bottom edge"},{id:"w",x:e(g)-s/2,y:e(o)+e(f)/2-s/2,cursor:"ew-resize",label:"Resize left edge"},{id:"e",x:e(g)+e(d)-s/2,y:e(o)+e(f)/2-s/2,cursor:"ew-resize",label:"Resize right edge"}],y=X(e(l)).selectAll(".resize-handle").data(h,k=>k.id);y.enter().append("rect").attr("class","resize-handle").attr("width",s).attr("height",s).attr("fill",u()).attr("stroke",u()).attr("stroke-width","1").attr("vector-effect","non-scaling-stroke").attr("role","button").attr("style",k=>`cursor: ${k.cursor};`).attr("data-testid",k=>`resize-handle-${k.id}`).attr("aria-label",k=>k.label).merge(y).attr("x",k=>k.x).attr("y",k=>k.y).attr("width",s).attr("height",s).attr("fill",u()).attr("stroke",u()),y.exit().remove()}function D(){if(!e(l))return;["nw","ne","sw","se","n","s","w","e"].forEach(h=>{if(!e(l))return;const _=e(l).querySelector(`[data-testid="resize-handle-${h}"]`);_&&X(_).call(Lt({handle:h,getCurrentBbox:()=>({x:e(g),y:e(o),width:e(d),height:e(f)}),onResize:y=>{n(n().x=y.x,!0),n(n().y=y.y,!0),n(n().width=y.width,!0),n(n().height=y.height,!0),t.onResize&&t.onResize(y),S()},onDragEnd:y=>{t.onDragEnd&&t.onDragEnd(y)},onInteractionStart:()=>{L(v,!0)},onInteractionEnd:()=>{L(v,!1)}}))});const s=e(l).querySelector(".movable-rectangle");s&&X(s).call(Pt({getCurrentBbox:()=>({x:e(g),y:e(o),width:e(d),height:e(f)}),onMove:h=>{n(n().x=h.x,!0),n(n().y=h.y,!0),n(n().width=h.width,!0),n(n().height=h.height,!0),t.onResize&&t.onResize(h),S()},onDragEnd:h=>{t.onDragEnd&&t.onDragEnd(h)},onInteractionStart:()=>{L(v,!0)},onInteractionEnd:()=>{L(v,!1)}}))}St(()=>{e(l)&&(S(),D())});const M=async()=>{e(l)&&(await ft(),S(),D())};gt(()=>{S(),M()});var E=Xt(),C=H(E),Y=G(C);{var a=b=>{var s=Ft(),h=ct(s),_=H(h);q(h);var y=G(h),k=H(y);q(y);var R=G(y),F=H(R);q(R),Q(()=>{c(h,"x",e(g)-10/x()),c(h,"y",e(o)+1/x()),c(h,"fill",u()),c(h,"font-size",14/x()),K(_,`x: ${e(g)??""}, y: ${e(o)??""}`),c(y,"x",e(g)+e(d)/2),c(y,"y",e(o)+e(f)+20/x()),c(y,"fill",u()),c(y,"font-size",14/x()),K(k,`w: ${e(d)??""}px`),c(R,"x",e(g)-10/x()),c(R,"y",e(o)+e(f)/2),c(R,"fill",u()),c(R,"font-size",14/x()),K(F,`h: ${e(f)??""}px`)}),V(b,s)};J(Y,b=>{e(v)&&b(a)})}q(E),ut(E,b=>L(l,b),()=>e(l)),Q(()=>{c(C,"x",e(g)),c(C,"y",e(o)),c(C,"width",e(d)),c(C,"height",e(f)),c(C,"stroke",u()),c(C,"fill",w()),c(C,"fill-opacity",z())}),V(r,E),rt()}var At=mt("<!> <!> <!>",1);function ae(r,t){var F,U;at(t,!0);const[n,u]=bt(),w=()=>xt(g,"$customLabelColorsStore",n),z=j(t,"showLabel",3,!1),i=j(t,"isResizable",3,!1),x=j(t,"scale",3,1),{customLabelColorsStore:g}=kt(),o=T(()=>t.annotation.annotation_label.annotation_label_name),d=(U=(F=t.annotation)==null?void 0:F.instance_segmentation_details)==null?void 0:U.segmentation_mask,f=T(()=>t.annotation.annotation_id),l=T(()=>$(e(o),1)),v=T(()=>{var m;return((m=w()[e(o)])==null?void 0:m.color)??$(e(o),1).color}),S=T(()=>{var m;return((m=w()[e(o)])==null?void 0:m.color)??$(e(o),.4).color}),D=T(()=>{var m;return((m=w()[e(o)])==null?void 0:m.alpha)*.4});let M=Z(W(vt(t.annotation)));const E=m=>{L(M,W(t.constraintBox?st(m,t.constraintBox):m))},C=m=>{var A;const P=t.constraintBox?st(m,t.constraintBox):m;L(M,W(P)),(A=t.onBoundingBoxChanged)==null||A.call(t,P)},Y=T(()=>[e(M).x,e(M).y,e(M).width,e(M).height]);var a=At(),b=ct(a);{var s=m=>{const P=T(()=>[e(M).x,e(M).y]);Ot(m,{get coordinates(){return e(P)},get colorText(){return e(l)},get label(){return e(o)}})};J(b,m=>{z()&&m(s)})}var h=G(b,2);{var _=m=>{zt(m,{segmentation:d,get width(){return t.imageWidth},get colorFill(){return e(S)},get opacity(){return e(D)}})};J(h,m=>{d&&m(_)})}var y=G(h,2);{var k=m=>{Yt(m,{get colorStroke(){return e(v)},get colorFill(){return e(S)},get opacity(){return e(D)},get scale(){return x()},onResize:E,onDragEnd:C,get bbox(){return e(M)},set bbox(P){L(M,W(P))}})},R=m=>{qt(m,{get bbox(){return e(Y)},get annotationId(){return e(f)},get label(){return e(o)},get colorStroke(){return e(v)},get colorFill(){return e(S)},get opacity(){return e(D)}})};J(y,m=>{i()&&t.constraintBox?m(k):m(R,!1)})}V(r,a),rt(),u()}var Ht=B('<rect vector-effect="non-scaling-stroke" stroke-width="2" pointer-events="all" data-testid="annotation_box"></rect>');function qt(r,t){const n=j(t,"isPrediction",3,!1),[u,w,z,i]=t.bbox,x=n()?"5,5":"none",g=n()?.8:1;var o=Ht();c(o,"x",u),c(o,"y",w),c(o,"width",z),c(o,"height",i),c(o,"stroke-opacity",g),c(o,"stroke-dasharray",x),Q(()=>{c(o,"stroke",t.colorStroke),c(o,"fill",t.colorFill),c(o,"fill-opacity",t.opacity),c(o,"aria-label",t.label),c(o,"data-annotation-id",t.annotationId)}),V(r,o)}var Gt=B('<g class="unscaled"><rect></rect><text class="annotation-label-text" data-testid="svg-annotation-text"> </text></g>');function Ot(r,t){at(t,!0);const n=j(t,"fontSize",3,14),u=j(t,"isPrediction",3,!1),w=T(()=>t.coordinates[0]),z=T(()=>t.coordinates[1]);let i=Z(null);const x=T(()=>e(i)?(e(i).textContent=u()?`${t.label} (pred)`:t.label,e(i).getBBox()):{width:0,height:0}),g=5,o=u()?.8:1,d=u()?"italic":"normal";var f=Gt(),l=H(f);c(l,"opacity",o);var v=G(l);c(v,"x",g),c(v,"y",-5),c(v,"font-style",d);var S=H(v,!0);q(v),ut(v,D=>L(i,D),()=>e(i)),q(f),Q(()=>{var D,M,E;c(f,"transform",`translate(${e(w)}, ${e(z)})`),c(f,"data-label",t.label),c(l,"y",-((D=e(x))==null?void 0:D.height)),c(l,"width",((M=e(x))==null?void 0:M.width)+g*2),c(l,"height",(E=e(x))==null?void 0:E.height),c(l,"fill",t.colorText.color),c(v,"fill",t.colorText.contrastColor),c(v,"font-size",n()),K(S,u()?`${t.label} (pred)`:t.label)}),V(r,f),rt()}export{Yt as R,ae as S,Rt as a,ht as d,lt as p,X as s,Dt as y};
