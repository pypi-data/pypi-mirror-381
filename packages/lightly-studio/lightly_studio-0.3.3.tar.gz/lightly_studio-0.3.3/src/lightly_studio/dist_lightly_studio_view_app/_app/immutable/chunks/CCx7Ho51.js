import{o as M,E as W,C as Q,n as J,at as Y,q as K,F as V,l as D,w as A,au as X,m as O}from"./CH6P3X75.js";import{u as Z}from"./6t3IJ0vQ.js";function ye(n,t,...e){var i=n,r=J,s;M(()=>{r!==(r=t())&&(s&&(Y(s),s=null),s=Q(()=>r(i,...e)))},W),K&&(i=V)}const ee=/\{[^{}]+\}/g,te=()=>{var n,t;return typeof process=="object"&&Number.parseInt((t=(n=process==null?void 0:process.versions)==null?void 0:n.node)==null?void 0:t.substring(0,2))>=18&&process.versions.undici};function re(){return Math.random().toString(36).slice(2,11)}function ne(n){let{baseUrl:t="",Request:e=globalThis.Request,fetch:i=globalThis.fetch,querySerializer:r,bodySerializer:s,headers:l,requestInitExt:f=void 0,...q}={...n};f=te()?f:void 0,t=v(t);const y=[];async function h(a,o){const{baseUrl:m,fetch:R=i,Request:ce=e,headers:N,params:g={},parseAs:U="json",querySerializer:S,bodySerializer:_=s??ae,body:P,...x}=o||{};m&&(t=v(m));let z=typeof r=="function"?r:H(r);S&&(z=typeof S=="function"?S:H({...typeof r=="object"?r:{},...S}));const C=P===void 0?void 0:_(P),B=C===void 0||C instanceof FormData?{}:{"Content-Type":"application/json"},G={redirect:"follow",...q,...x,body:C,headers:oe(B,l,N,g.header)};let j,E,b=new e(ie(a,{baseUrl:t,params:g,querySerializer:z}),G);for(const u in x)u in b||(b[u]=x[u]);if(y.length){j=re(),E=Object.freeze({baseUrl:t,fetch:R,parseAs:U,querySerializer:z,bodySerializer:_});for(const u of y)if(u&&typeof u=="object"&&typeof u.onRequest=="function"){const d=await u.onRequest({request:b,schemaPath:a,params:g,options:E,id:j});if(d){if(!(d instanceof e))throw new Error("onRequest: must return new Request() when modifying the request");b=d}}}let c;try{c=await R(b,f)}catch(u){let d=u;if(y.length)for(let p=y.length-1;p>=0;p--){const T=y[p];if(T&&typeof T=="object"&&typeof T.onError=="function"){const w=await T.onError({request:b,error:d,schemaPath:a,params:g,options:E,id:j});if(w){if(w instanceof Response){d=void 0,c=w;break}if(w instanceof Error){d=w;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(d)throw d}if(y.length)for(let u=y.length-1;u>=0;u--){const d=y[u];if(d&&typeof d=="object"&&typeof d.onResponse=="function"){const p=await d.onResponse({request:b,response:c,schemaPath:a,params:g,options:E,id:j});if(p){if(!(p instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");c=p}}}if(c.status===204||c.headers.get("Content-Length")==="0")return c.ok?{data:void 0,response:c}:{error:void 0,response:c};if(c.ok)return U==="stream"?{data:c.body,response:c}:{data:await c[U](),response:c};let I=await c.text();try{I=JSON.parse(I)}catch{}return{error:I,response:c}}return{request(a,o,m){return h(o,{...m,method:a.toUpperCase()})},GET(a,o){return h(a,{...o,method:"GET"})},PUT(a,o){return h(a,{...o,method:"PUT"})},POST(a,o){return h(a,{...o,method:"POST"})},DELETE(a,o){return h(a,{...o,method:"DELETE"})},OPTIONS(a,o){return h(a,{...o,method:"OPTIONS"})},HEAD(a,o){return h(a,{...o,method:"HEAD"})},PATCH(a,o){return h(a,{...o,method:"PATCH"})},TRACE(a,o){return h(a,{...o,method:"TRACE"})},use(...a){for(const o of a)if(o){if(typeof o!="object"||!("onRequest"in o||"onResponse"in o||"onError"in o))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");y.push(o)}},eject(...a){for(const o of a){const m=y.indexOf(o);m!==-1&&y.splice(m,1)}}}}function $(n,t,e){if(t==null)return"";if(typeof t=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${n}=${(e==null?void 0:e.allowReserved)===!0?t:encodeURIComponent(t)}`}function k(n,t,e){if(!t||typeof t!="object")return"";const i=[],r={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(const f in t)i.push(f,e.allowReserved===!0?t[f]:encodeURIComponent(t[f]));const l=i.join(",");switch(e.style){case"form":return`${n}=${l}`;case"label":return`.${l}`;case"matrix":return`;${n}=${l}`;default:return l}}for(const l in t){const f=e.style==="deepObject"?`${n}[${l}]`:l;i.push($(f,t[l],e))}const s=i.join(r);return e.style==="label"||e.style==="matrix"?`${r}${s}`:s}function F(n,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){const s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",l=(e.allowReserved===!0?t:t.map(f=>encodeURIComponent(f))).join(s);switch(e.style){case"simple":return l;case"label":return`.${l}`;case"matrix":return`;${n}=${l}`;default:return`${n}=${l}`}}const i={simple:",",label:".",matrix:";"}[e.style]||"&",r=[];for(const s of t)e.style==="simple"||e.style==="label"?r.push(e.allowReserved===!0?s:encodeURIComponent(s)):r.push($(n,s,e));return e.style==="label"||e.style==="matrix"?`${i}${r.join(i)}`:r.join(i)}function H(n){return function(e){const i=[];if(e&&typeof e=="object")for(const r in e){const s=e[r];if(s!=null){if(Array.isArray(s)){if(s.length===0)continue;i.push(F(r,s,{style:"form",explode:!0,...n==null?void 0:n.array,allowReserved:(n==null?void 0:n.allowReserved)||!1}));continue}if(typeof s=="object"){i.push(k(r,s,{style:"deepObject",explode:!0,...n==null?void 0:n.object,allowReserved:(n==null?void 0:n.allowReserved)||!1}));continue}i.push($(r,s,n))}}return i.join("&")}}function se(n,t){let e=n;for(const i of n.match(ee)??[]){let r=i.substring(1,i.length-1),s=!1,l="simple";if(r.endsWith("*")&&(s=!0,r=r.substring(0,r.length-1)),r.startsWith(".")?(l="label",r=r.substring(1)):r.startsWith(";")&&(l="matrix",r=r.substring(1)),!t||t[r]===void 0||t[r]===null)continue;const f=t[r];if(Array.isArray(f)){e=e.replace(i,F(r,f,{style:l,explode:s}));continue}if(typeof f=="object"){e=e.replace(i,k(r,f,{style:l,explode:s}));continue}if(l==="matrix"){e=e.replace(i,`;${$(r,f)}`);continue}e=e.replace(i,l==="label"?`.${encodeURIComponent(f)}`:encodeURIComponent(f))}return e}function ae(n){return n instanceof FormData?n:JSON.stringify(n)}function ie(n,t){var r;let e=`${t.baseUrl}${n}`;(r=t.params)!=null&&r.path&&(e=se(e,t.params.path));let i=t.querySerializer(t.params.query??{});return i.startsWith("?")&&(i=i.substring(1)),i&&(e+=`?${i}`),e}function oe(...n){const t=new Headers;for(const e of n){if(!e||typeof e!="object")continue;const i=e instanceof Headers?e.entries():Object.entries(e);for(const[r,s]of i)if(s===null)t.delete(r);else if(Array.isArray(s))for(const l of s)t.append(r,l);else s!==void 0&&t.set(r,s)}return t}function v(n){return n.endsWith("/")?n.substring(0,n.length-1):n}const he="/images",le="/",fe=ne({baseUrl:le,fetch}),L=A(new Set);function me(n){const{dataset_id:t,kind:e}=n,{tags:i}=Z(),r=A(!1),s=A(null),l=A(!1),f=()=>{D(l)||(l.set(!0),fe.GET("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:t}}}).then(a=>{a.data&&i.set(a.data)}).catch(a=>{s.set(a)}).finally(()=>{l.set(!1)}))};!D(r)&&t&&(f(),r.set(!0));const q=X(i,a=>{const o=a??[];return e?o.filter(R=>e.includes(R.kind)):o}),y=a=>{L.update(o=>(o.has(a)?o.delete(a):o.add(a),new Set([...o])))},h=()=>{L.set(new Set)};return{tags:O(q),loadTags:f,tagsSelected:O(L),tagSelectionToggle:y,clearTagsSelected:h,isLoading:O(l),error:s}}export{he as P,le as a,fe as c,ye as s,me as u};
