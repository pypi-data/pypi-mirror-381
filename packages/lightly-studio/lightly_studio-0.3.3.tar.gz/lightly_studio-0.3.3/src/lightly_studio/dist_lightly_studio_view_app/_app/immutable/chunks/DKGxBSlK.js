import"./CWj6FrbW.js";import{p as ie,c as b,g as s,d as m,r as _,t as ae,a as ne,J as M,a7 as q,u as te,f as se,s as Q}from"./CH6P3X75.js";import{n as $e,a as o,t as x,c as ve,d as ue}from"./RmD8FzRo.js";import{a as f,s as ge,i as H}from"./DA6bFLPR.js";import{i as et,j as tt,k as st,l as B,n as it,c as at,s as nt,o as lt,p as ot,q as rt,t as dt,v as ct,w as mt,G as ft,L as vt,S as ut,x as gt,y as _t}from"./DQe_kdRt.js";import{p as _e,r as pt,a as E,b as ht}from"./DQXoLcsF.js";import{o as pe}from"./DEgUu98i.js";import{u as he}from"./6t3IJ0vQ.js";import{r as St}from"./H7C68rOM.js";import{u as bt}from"./8NsknIT2.js";import{c as xt,u as yt}from"./BND_-4Kp.js";import"./keKYsoph.js";import"./69_IOA4Y.js";import{P as wt,u as Pt}from"./CCx7Ho51.js";import{S as It}from"./D6r9vr07.js";import{b as Ft}from"./CxFKfZ9T.js";import{b as jt}from"./D4whDBUi.js";import{u as Ct,i as Ot}from"./CWPZrTTJ.js";var Ht=$e('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function Rt(e,t){ie(t,!0);const[i,d]=ge(),v=()=>f(y,"$isHidden",i),p=_e(t,"sampleImageObjectFit",3,"contain"),{isHidden:y}=et(),h=m(()=>t.sample.annotations.filter(w=>w.annotation_type!=="classification"));var n=Ht(),c=b(n);let u;tt(c,21,()=>s(h),st,(w,l)=>{It(w,{get annotation(){return s(l)},get showLabel(){return t.showLabel},get imageWidth(){return t.sample.width}})}),_(c),_(n),ae(w=>{B(n,"viewBox",`0 0 ${t.sample.width} ${t.sample.height}`),B(n,"preserveAspectRatio",p()==="contain"?"xMidYMid meet":"xMidYMid slice"),B(n,"width",t.containerWidth),B(n,"height",t.containerHeight),u=it(c,0,"",null,u,w)},[()=>({invisible:v()})]),o(e,n),ne(),d()}var At=x("<img>");function kt(e,t){ie(t,!0);const i=_e(t,"objectFit",3,"contain"),d=pt(t,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:v,...p}=d,{getDatasetVersion:y}=he();let h=q("");pe(async()=>{var u;(u=t.sample)!=null&&u.dataset_id&&M(h,E(await y(t.sample.dataset_id)))});var n=At();let c;ae(u=>c=nt(n,c,{src:`${wt}/sample/${t.sample.sample_id}${s(h)?`?v=${s(h)}`:""}`,alt:t.sample.file_path_abs,class:u,style:`--object-fit: ${i()??""}`,loading:"lazy",...p},"svelte-1c6bz0a"),[()=>at("sample-image rounded-lg bg-black",v)]),jt(n),o(e,n),ne()}const Mt=e=>{const t=["readSamplesInfinite",e.dataset_id,e.mode,e.mode==="normal"?e.filters:e.classifierSamples,{metadata_values:e.metadata_values,text_embedding:e.text_embedding}];return Ot({queryKey:t,queryFn:async({pageParam:i=0,signal:d})=>{const v=Nt(e,i),{data:p}=await Ft({path:{dataset_id:e.dataset_id},body:v,signal:d,throwOnError:!0});return p},initialPageParam:0,getNextPageParam:i=>i.nextCursor??void 0,enabled:Vt(e)})},Nt=(e,t)=>{var d,v;const i={pagination:{offset:t,limit:100},text_embedding:e.text_embedding,filters:{metadata_filters:e.metadata_values?xt(e.metadata_values):void 0}};if(e.mode==="classifier"&&e.classifierSamples){const p=[...e.classifierSamples.positiveSampleIds,...e.classifierSamples.negativeSampleIds];return{...i,sample_ids:p}}else if(e.mode==="normal"&&e.filters)return{...i,filters:{...i.filters,annotation_label_ids:(d=e.filters.annotation_label_ids)!=null&&d.length?e.filters.annotation_label_ids:void 0,tag_ids:(v=e.filters.tag_ids)!=null&&v.length?e.filters.tag_ids:void 0,width:e.filters.dimensions?{min:e.filters.dimensions.min_width,max:e.filters.dimensions.max_width}:void 0,height:e.filters.dimensions?{min:e.filters.dimensions.min_height,max:e.filters.dimensions.max_height}:void 0}};return i},Vt=e=>e.mode==="classifier"?!!(e.classifierSamples&&(e.classifierSamples.positiveSampleIds.length>0||e.classifierSamples.negativeSampleIds.length>0)):!0,Lt=e=>{const t=Mt(e),i=lt(t),d=Ct();return{samples:i,refresh:()=>{d.invalidateQueries({queryKey:t.queryKey})}}};var zt=x('<div class="flex h-full w-full items-center justify-center"><div>Loading samples...</div></div>'),qt=x('<div class="flex h-full w-full items-center justify-center"><div class="mb-2 font-medium">Error loading samples</div></div>'),Bt=x('<div class="flex h-full w-full items-center justify-center"><div class="text-center text-muted-foreground"><div class="mb-2 text-lg font-medium">No samples found</div> <div class="text-sm"><!></div></div></div>'),Et=x('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a data-testid="sample-link" class="block"><!> <!></a></div>'),Tt=x('<div class="flex justify-center p-4"><!></div>'),Wt=x("<!> <!>",1),Gt=x('<div class="viewport flex-1 svelte-gzepom"><!></div>'),Qt=x('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function fs(e,t){ie(t,!0);const[i,d]=ge(),v=()=>f(Pe,"$isCreateClassifiersPanelOpen",i),p=()=>f(Ie,"$isRefineClassifiersPanelOpen",i),y=()=>f(je,"$classifierSamples",i),h=()=>f(t.selectedAnnotationFilterIds,"$selectedAnnotationFilterIds",i),n=()=>f(xe,"$tagsSelected",i),c=()=>f(ye,"$dimensions",i),u=()=>f(we,"$metadataValues",i),w=()=>f(t.textEmbedding,"$textEmbedding",i),l=()=>f(s(ke),"$infiniteSamples",i),le=()=>f(be,"$gridViewSampleRenderingStore",i),Se=()=>f(Fe,"$selectedSampleIds",i),{gridViewSampleRenderingStore:be}=ot(),{tagsSelected:xe}=Pt({dataset_id:t.dataset_id,kind:["sample"]}),{dimensionsValues:ye}=bt(),{metadataValues:we}=yt(t.dataset_id),{isCreateClassifiersPanelOpen:Pe}=ct(),{isRefineClassifiersPanelOpen:Ie}=mt(),{selectedSampleIds:Fe,classifierSamples:je,toggleSampleSelection:Ce,getDatasetVersion:Oe,setSamplesTotalCount:He}=he(),N=m(()=>v()||p()),Re=m(()=>{var a,r;return{dataset_id:t.dataset_id,mode:s(N)?"classifier":"normal",...s(N)?{classifierSamples:y()}:{filters:{annotation_label_ids:(a=h())!=null&&a.length?h():void 0,tag_ids:n().size>0?Array.from(n()):void 0,dimensions:c()}},metadata_values:u(),text_embedding:(r=w())==null?void 0:r.embedding}}),Ae=m(()=>Lt(s(Re))),ke=m(()=>s(Ae).samples),P=m(()=>{var a;return((a=l().data)==null?void 0:a.pages.flatMap(r=>r.data))||[]});let C=q(null),oe=q(!1),D=q(E(le())),K=q(0);const{initialize:Me,savePosition:Ne,getRestoredPosition:Ve}=rt("samples_scroll");pe(async()=>{Me(),await Oe(t.dataset_id),M(oe,!0)});const re=m(()=>{var r;return[h().join(","),Array.from(n()).join(","),`${c().min_width}-${c().max_width}`,`${c().min_height}-${c().max_height}`,JSON.stringify(u()),((r=w())==null?void 0:r.queryText)||"",s(N)?"classifier":"normal",s(N)&&y()?`pos:${y().positiveSampleIds.length},neg:${y().negativeSampleIds.length}`:""].filter(Boolean).join("|")}),Le=m(()=>Ve(s(re)));function ze(a){const r=a.target.scrollTop;Ne(r,s(re))}te(()=>{M(D,E(le()))}),te(()=>{var a;l().isSuccess&&((a=l().data)==null?void 0:a.pages.length)>0&&He(l().data.pages[0].total_count)}),te(()=>{if(!s(C))return;M(K,E(s(C).clientHeight));const a=new ResizeObserver(()=>{s(C)&&M(K,E(s(C).clientHeight))});return a.observe(s(C)),()=>{a.disconnect()}});function qe(){l().hasNextPage&&!l().isFetchingNextPage&&l().fetchNextPage()}const de=16,Be=dt(),[Ee,Dt]=Be;var ce=ve(),Te=se(ce);{var We=a=>{var r=zt();o(a,r)},Ge=(a,r)=>{{var Qe=R=>{var J=qt();o(R,J)},De=(R,J)=>{{var Ke=A=>{var V=Bt(),T=b(V),W=Q(b(T),2),I=b(W);{var F=j=>{var L=ue("No samples available for this classifier.");o(j,L)},U=j=>{var L=ue("This dataset doesn't contain any samples.");o(j,L)};H(I,j=>{s(N)?j(F):j(U,!1)})}_(W),_(T),_(V),o(A,V)},Je=(A,V)=>{{var T=I=>{var F=Gt(),U=b(F);const j=m(()=>t.sampleHeight+de),L=m(()=>t.sampleWidth+de);ft(U,{get itemCount(){return s(P).length},get itemHeight(){return s(j)},get itemWidth(){return s(L)},get height(){return s(K)},get scrollPosition(){return s(Le)},onscroll:ze,class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${t.sampleWidth??""}px; --sample-height: ${t.sampleHeight??""}px;`},overScan:100,item:(Y,S)=>{let g=()=>S==null?void 0:S().index,X=()=>S==null?void 0:S().style;var G=ve(),Z=se(G);{var z=O=>{var k=Et(),$=b(k),Ue=b($);const Ye=m(()=>Se().has(s(P)[g()].sample_id));ut(Ue,{onSelect:()=>Ce(s(P)[g()].sample_id),get isSelected(){return s(Ye)}}),_($);var ee=Q($,2),fe=b(ee);kt(fe,{get sample(){return s(P)[g()]},get objectFit(){return s(D)}});var Xe=Q(fe,2);Rt(Xe,{get sample(){return s(P)[g()]},get containerWidth(){return t.sampleWidth},get sampleImageObjectFit(){return s(D)},get containerHeight(){return t.sampleHeight}}),_(ee),_(k),ae(Ze=>{gt(k,X()),B(ee,"href",Ze)},[()=>Ee(St.toSample({sampleId:s(P)[g()].sample_id,datasetId:t.dataset_id,sampleIndex:g()}),void 0)]),o(O,k)};H(Z,O=>{s(P)[g()]&&O(z)})}o(Y,G)},footer:Y=>{var S=Wt(),g=se(S);const X=m(()=>!l().hasNextPage||l().isFetchingNextPage);vt(g,{onIntersect:qe,get disabled(){return s(X)}});var G=Q(g,2);{var Z=z=>{var O=Tt(),k=b(O);_t(k,{}),_(O),o(z,O)};H(G,z=>{l().isFetchingNextPage&&z(Z)})}o(Y,S)},$$slots:{item:!0,footer:!0}}),_(F),ht(F,me=>M(C,me),()=>s(C)),o(I,F)},W=I=>{var F=Qt();o(I,F)};H(A,I=>{s(oe)?I(T):I(W,!1)},V)}};H(R,A=>{l().isSuccess&&s(P).length===0?A(Ke):A(Je,!1)},J)}};H(a,R=>{l().isError?R(Qe):R(De,!1)},r)}};H(Te,a=>{l().isPending?a(We):a(Ge,!1)})}o(e,ce),ne(),d()}export{fs as S};
