import{p as T,f as B,n as Gt,a as H,w as Pt,l as _t,$ as ft,g as t,d as i,c as f,r as m,s as S,t as F,J as Kt,a7 as qt,ax as Mt}from"../chunks/CH6P3X75.js";import{c as Vt}from"../chunks/CxFKfZ9T.js";import{u as ht}from"../chunks/6t3IJ0vQ.js";import"../chunks/CWj6FrbW.js";import{c as Z,a as p,t as P,n as Jt}from"../chunks/RmD8FzRo.js";import{i as O,a as j,s as K}from"../chunks/DA6bFLPR.js";import{e as pt}from"../chunks/D4whDBUi.js";import{I as Zt,l as X,F as Xt,D as at,U as Yt,V as Qt,W as ta,X as aa,z as gt,O as ea,j as na,t as oa,J as Nt,K as Ct,y as Bt,i as sa,p as ia,S as ra,B as da,n as la,H as ca}from"../chunks/DQe_kdRt.js";import{g as tt,c as ua}from"../chunks/DEgUu98i.js";import{f as kt,S as va}from"../chunks/CR2upx_Q.js";import{r as z}from"../chunks/H7C68rOM.js";import"../chunks/8NsknIT2.js";import{p as R}from"../chunks/keKYsoph.js";import"../chunks/69_IOA4Y.js";import{s as ma}from"../chunks/CCx7Ho51.js";import{S as _a}from"../chunks/D6r9vr07.js";import{S as fa,B as pa,a as ga,b as Q,c as vt,H as ha,d as mt,D as ba,e as xa,Z as Ia,g as Aa,u as wa}from"../chunks/DcY4jgG3.js";import{S as Sa}from"../chunks/BdfTHw61.js";import{s as ya,r as $a,a as Ma}from"../chunks/DQXoLcsF.js";import{s as G}from"../chunks/DGTPl6Gk.js";import{C as ka}from"../chunks/CwPowJfP.js";function Pa(v,a){T(a,!0);let o=$a(a,["$$slots","$$events","$$legacy"]);Zt(v,ya({name:"square-dashed"},()=>o,{iconNode:[["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M21 19a2 2 0 0 1-2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h1"}],["path",{d:"M14 3h1"}],["path",{d:"M14 21h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v1"}],["path",{d:"M3 14v1"}],["path",{d:"M21 14v1"}]],children:(e,s)=>{var r=Z(),I=B(r);ma(I,()=>a.children??Gt),p(e,r)},$$slots:{default:!0}})),H()}const Na=({annotationIndex:v,...a})=>{const o=Pt({isLoading:!1});return(async()=>{o.update(e=>({...e,isLoading:!0}));try{const{data:e}=await Vt({path:{dataset_id:a.dataset_id},query:{cursor:v>0?v-1:0,limit:3,annotation_label_ids:a.annotation_label_ids,tag_ids:a.tag_ids}});if(!e){o.update(n=>({...n,isLoading:!1,error:"No annotations data received",data:void 0}));return}const{setAnnotationsTotalCount:s}=ht();s(e.total_count);let r;const I=v>0?e.data[0]:void 0;e.data.length>1&&(r=v===0?e.data[1]:e.data[2]),o.update(n=>({...n,isLoading:!1,error:void 0,data:{annotationNext:r,annotationPrevious:I}}))}catch(e){o.update(s=>({...s,isLoading:!1,error:String(e)}))}})(),o},Ca=async({parent:v,params:{dataset_id:a,annotationId:o,annotationIndex:c}})=>{const{annotationsSelectedTagsIds:e,annotationsSelectedAnnotationLabelsIds:s,dataset:r}=await v(),I=parseInt(c,10),n=Pt();if(!r)throw new Error("Dataset data not found");return Na({annotationIndex:I,dataset_id:a,currentAnnotationId:o,annotation_label_ids:Array.from(_t(s)),tag_ids:Array.from(_t(e))}).subscribe(({data:N})=>{n.set(N)}),{annotationAdjacents:n,annotationIndex:I,annotationId:o,dataset:r}},ye=Object.freeze(Object.defineProperty({__proto__:null,load:Ca},Symbol.toStringTag,{value:"Module"}));function Ba(v,a){T(a,!0);const[o,c]=K(),e=()=>j(t(r),"$annotationAdjacents",o),s=i(()=>R.data.annotationIndex),r=i(()=>R.data.annotationAdjacents),I=()=>{e().annotationNext&&tt(z.toSampleWithAnnotation({datasetId:e().annotationNext.dataset_id,sampleId:e().annotationNext.sample_id,annotationId:e().annotationNext.annotation_id,annotationIndex:t(s)+1}))},n=()=>{e().annotationPrevious&&tt(z.toSampleWithAnnotation({datasetId:e().annotationPrevious.dataset_id,sampleId:e().annotationPrevious.sample_id,annotationId:e().annotationPrevious.annotation_id,annotationIndex:t(s)-1}))},N=h=>{switch(h.key){case"ArrowRight":I();break;case"ArrowLeft":n();break}};var y=Z();pt("keydown",ft,N);var w=B(y);{var $=h=>{const b=i(()=>!!e().annotationPrevious),A=i(()=>!!e().annotationNext);Sa(h,{get hasPrevious(){return t(b)},get hasNext(){return t(A)},onPrevious:n,onNext:I})};O(w,h=>{e()&&h($)})}p(v,y),H(),c()}const Da={object_detection:"Object Detection",instance_segmentation:"Instance Segmentation",semantic_segmentation:"Semantic Segmentation",classification:"Classification"};var La=P('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1);function ja(v,a){var o=La(),c=B(o),e=f(c,!0);m(c);var s=S(c,2),r=f(s,!0);m(s),F(()=>{G(e,a.label),X(s,"data-testid",`annotation-metadata-${a.id}`),G(r,a.value)}),p(v,o)}var Ea=P('<span class="break-all text-sm"> </span>'),Ra=P('<span class="text-sm"> </span> <!>',1);function Ta(v,a){T(a,!0);const[o,c]=K(),e=()=>j(r,"$result",o),s=()=>j(a.isEditingMode,"$isEditingMode",o),r=Xt(),{updateAnnotation:I}=at({datasetId:a.datasetId,annotationId:a.annotationId,onUpdate:a.onUpdate}),n=i(()=>ta(e().data||[])),N=i(()=>{const x=t(n).find(u=>u.value===a.value);return x||{value:a.value,label:a.value}});var y=Ra(),w=B(y),$=f(w,!0);m(w);var h=S(w,2);{var b=x=>{const u=i(()=>t(n).find(d=>{var g;return d.value===((g=t(N))==null?void 0:g.value)}));Yt(x,{get items(){return t(n)},get selectedItem(){return t(u)},name:"annotation-label",placeholder:"Select a label",onSelect:g=>{I({annotation_id:a.annotationId,dataset_id:a.datasetId,label_name:g.value})},notFound:(g,_)=>{let k=()=>_==null?void 0:_().inputValue;Qt(g,{get label(){return k()}})},$$slots:{notFound:!0}})},A=x=>{var u=Ea();X(u,"data-testid","annotation-metadata-label");var d=f(u,!0);m(u),F(()=>G(d,a.value)),p(x,u)};O(h,x=>{s()?x(b):x(A,!1)})}F(()=>G($,a.label)),p(v,y),H(),c()}var Ha=P('<div class="flex flex-col gap-4"><div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>');function Ua(v,a){T(a,!0);const[o,c]=K(),e=()=>j(t(I),"$annotationResp",o),{datasetId:s}=R.data,r=i(()=>at({datasetId:s,annotationId:a.annotationId})),I=i(()=>t(r).annotation);let n=i(()=>e().data);const N=i(()=>{var A,x;if(!t(n))return[];let b=[{id:"label",label:"Label:",value:(x=(A=t(n))==null?void 0:A.annotation_label)==null?void 0:x.annotation_label_name},{id:"type",label:"Type:",value:Da[t(n).annotation_type]||"Unknown"}];if(t(n)&&!aa(t(n))){const{height:u,width:d}=gt(t(n));b=[{id:"height",label:"Height:",value:kt(Math.round(u))+"px"},{id:"width",label:"Width:",value:kt(Math.round(d))+"px"},...b]}return b}),{isEditingMode:y}=R.data.globalStorage;var w=Z(),$=B(w);{var h=b=>{ea(b,{title:"Annotation details",children:(A,x)=>{var u=Ha(),d=f(u);na(d,21,()=>t(N),({label:g,value:_,id:k})=>g,(g,_)=>{let k=()=>t(_).label,D=()=>t(_).value,M=()=>t(_).id;var C=Z(),l=B(C);{var q=E=>{Ta(E,{get onUpdate(){return a.onUpdate},get annotationId(){return a.annotationId},datasetId:s,get label(){return k()},get value(){return D()},isEditingMode:y})},et=E=>{ja(E,{get label(){return k()},get id(){return M()},get value(){return D()}})};O(l,E=>{M()==="label"&&y?E(q):E(et,!1)})}p(g,C)}),m(d),m(u),p(A,u)}})};O($,b=>{t(N).length>0&&b(h)})}p(v,w),H(),c()}var za=P('<!> <h2 class="py-2 text-lg font-semibold"><a>Check all sample annotations</a></h2>',1),Fa=P('<div class="flex h-full w-full items-center justify-center"><!></div>'),Oa=P('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-hidden dark:[color-scheme:dark]"><!> <!></div>');function Wa(v,a){T(a,!0);const{datasetId:o}=R.data;let c=qt(void 0);at({datasetId:o,annotationId:a.annotationId}).annotation.subscribe(n=>{n.isSuccess&&Kt(c,Ma(n.data.sample))});const s=oa(),[r,I]=s;Nt(v,{className:"h-full",children:(n,N)=>{Ct(n,{className:"h-full flex flex-col",children:(y,w)=>{var $=Oa(),h=f($);Ua(h,{get annotationId(){return a.annotationId},get onUpdate(){return a.onUpdate}});var b=S(h,2);{var A=u=>{var d=za(),g=B(d);fa(g,{get sample(){return t(c)},showCustomMetadata:!1});var _=S(g,2),k=f(_);m(_),F(D=>X(k,"href",D),[()=>r(z.toSample({sampleId:t(c).sample_id,datasetId:t(c).dataset_id}),void 0)]),p(u,d)},x=u=>{var d=Fa(),g=f(d);Bt(g,{size:"large",align:"center"}),m(d),p(u,d)};O(b,u=>{t(c)?u(A):u(x,!1)})}m($),p(y,$)},$$slots:{default:!0}})},$$slots:{default:!0}}),H()}var Ga=P('<!> <span class="hidden sm:inline">Home</span>',1),Ka=P('<!> <span class="max-w-[150px] truncate"> </span>',1),qa=P('<!> <span class="hidden sm:inline">Annotations</span>',1),Va=P('<!> <span class="max-w-[200px] truncate"> </span>',1),Ja=P("<!> <!> <!> <!> <!> <!> <!>",1);function Za(v,a){T(a,!0);const[o,c]=K(),e=()=>j(s,"$annotationsTotalCount",o),{annotationsTotalCount:s}=ht();pa(v,{class:"mb-2",children:(r,I)=>{ga(r,{children:(n,N)=>{var y=Ja(),w=B(y);Q(w,{children:(d,g)=>{const _=i(()=>z.toHome());vt(d,{get href(){return t(_)},class:"flex items-center gap-2",children:(k,D)=>{var M=Ga(),C=B(M);ha(C,{class:"h-4 w-4"}),Mt(2),p(k,M)},$$slots:{default:!0}})},$$slots:{default:!0}});var $=S(w,2);mt($,{});var h=S($,2);Q(h,{children:(d,g)=>{const _=i(()=>z.toAnnotations(a.dataset.dataset_id));vt(d,{get href(){return t(_)},class:"flex items-center gap-2",get title(){return a.dataset.directory},children:(k,D)=>{var M=Ka(),C=B(M);ba(C,{class:"h-4 w-4"});var l=S(C,2),q=f(l,!0);m(l),F(()=>{X(l,"title",a.dataset.directory),G(q,a.dataset.name)}),p(k,M)},$$slots:{default:!0}})},$$slots:{default:!0}});var b=S(h,2);mt(b,{});var A=S(b,2);Q(A,{children:(d,g)=>{const _=i(()=>z.toAnnotations(a.dataset.dataset_id));vt(d,{get href(){return t(_)},class:"flex items-center gap-2",children:(k,D)=>{var M=qa(),C=B(M);ka(C,{class:"h-4 w-4"}),Mt(2),p(k,M)},$$slots:{default:!0}})},$$slots:{default:!0}});var x=S(A,2);mt(x,{});var u=S(x,2);Q(u,{children:(d,g)=>{xa(d,{class:"flex items-center gap-2",children:(_,k)=>{var D=Va(),M=B(D);Pa(M,{class:"h-4 w-4"});var C=S(M,2),l=f(C);m(C),F(()=>G(l,`Annotation ${a.annotationIndex+1} of ${e()??""}`)),p(_,D)},$$slots:{default:!0}})},$$slots:{default:!0}}),p(n,y)},$$slots:{default:!0}})},$$slots:{default:!0}}),H(),c()}var Xa=Jt("<image></image><g><!></g>",1),Ya=P('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Qa=P('<div class="flex h-full w-full items-center justify-center"><!></div>'),te=P('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function ae(v,a){T(a,!0);const[o,c]=K(),e=()=>j(t(k),"$annotationResp",o),s=()=>j(N,"$selectedSampleAnnotationCropIds",o),r=()=>j($,"$isHidden",o),I=()=>j(E,"$isEditingMode",o),{toggleSampleAnnotationCropSelection:n,selectedSampleAnnotationCropIds:N,clearReversibleActionsByGroupId:y,addReversibleAction:w}=ht(),{isHidden:$,handleKeyEvent:h}=sa(),{settingsStore:b}=ia(),A=" ",x=_t(b).key_go_back,u=()=>{var L;(L=a.sample)!=null&&L.dataset_id?tt(z.toAnnotations(a.sample.dataset_id)):tt("/")},d=L=>{switch(L.key){case x:u();break;case A:L.preventDefault(),n(a.annotationId);break}h(L)},g=R.data.datasetId,_=i(()=>at({datasetId:g,annotationId:a.annotationId})),k=i(()=>t(_).annotation),D=i(()=>t(_).updateAnnotation),M="bbox-change-annotation-details";ua(()=>{y(M)});const C=L=>{if(t(l)){const V={annotation_id:t(l).annotation_id,dataset_id:t(l).dataset_id,bounding_box:L},it=gt(t(l)),At=async()=>{const J={annotation_id:t(l).annotation_id,dataset_id:t(l).dataset_id,bounding_box:it};await t(D)(J)};(async()=>{try{await t(D)(V),w({id:`bbox-change-${t(l).annotation_id}-${Date.now()}`,description:`Revert bounding box change for annotation ${t(l).annotation_id}`,execute:At,timestamp:new Date,groupId:M})}catch(J){ca.error("Failed to update annotations:"+J.message)}})()}};let l=i(()=>e().data),q=i(()=>{var L,V;return Aa(((V=(L=t(l))==null?void 0:L.sample)==null?void 0:V.sample_id)||"")}),et=i(()=>t(l)?gt(t(l)):void 0);const{isEditingMode:E}=R.data.globalStorage;var nt=te();pt("keydown",ft,d),pt("keyup",ft,h);var ot=f(nt),Dt=f(ot);Za(Dt,{get dataset(){return a.dataset},get annotationIndex(){return a.annotationIndex}}),m(ot);var bt=S(ot,2);va(bt,{class:"mb-4 bg-border-hard"});var xt=S(bt,2),st=f(xt),Lt=f(st);Nt(Lt,{className:"h-full",children:(L,V)=>{Ct(L,{className:"h-full",children:(it,At)=>{var rt=Z(),J=B(rt);{var Et=W=>{var U=Ya(),Y=f(U),dt=f(Y),Tt=f(dt);const Ht=i(()=>s().has(a.annotationId));ra(Tt,{onSelect:()=>n(a.annotationId),get isSelected(){return t(Ht)}}),m(dt);var wt=S(dt,2);Ba(wt,{});var Ut=S(wt,2);Ia(Ut,{get width(){return t(l).sample.width},get height(){return t(l).sample.height},get boundingBox(){return t(et)},zoomableContent:(zt,lt)=>{let Ft=()=>lt==null?void 0:lt().scale;var St=Xa(),yt=B(St),ct=S(yt);let $t;var Ot=f(ct);da(Ot,()=>e().dataUpdatedAt,ut=>{const Wt=i(()=>({x:0,y:0,width:t(l).sample.width,height:t(l).sample.height}));_a(ut,{get annotation(){return t(l)},showLabel:!0,get scale(){return Ft()},get imageWidth(){return t(l).sample.width},get isResizable(){return I()},onBoundingBoxChanged:C,get constraintBox(){return t(Wt)}})}),m(ct),F(ut=>{X(yt,"href",t(q)),$t=la(ct,0,"",null,$t,ut)},[()=>({invisible:r()})]),p(zt,St)},$$slots:{zoomableContent:!0}}),m(Y),m(U),p(W,U)},Rt=W=>{var U=Qa(),Y=f(U);Bt(Y,{size:"large",align:"center"}),m(U),p(W,U)};O(J,W=>{t(l)?W(Et):W(Rt,!1)})}p(it,rt)},$$slots:{default:!0}})},$$slots:{default:!0}}),m(st);var It=S(st,2),jt=f(It);Wa(jt,{get annotationId(){return a.annotationId}}),m(It),m(xt),m(nt),p(v,nt),H(),c()}var ee=P('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="annotation-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function $e(v,a){T(a,!0);const[o,c]=K(),e=()=>j(t(y),"$sample",o),s=i(()=>a.data.annotationId),r=i(()=>a.data.dataset),I=i(()=>a.data.annotationIndex),{sampleId:n}=R.params,N=i(()=>wa({sampleId:n,datasetId:t(r).dataset_id})),y=i(()=>t(N).sample);var w=ee(),$=f(w),h=f($);{var b=A=>{ae(A,{get annotationId(){return t(s)},get annotationIndex(){return t(I)},get dataset(){return t(r)},get sample(){return e().data}})};O(h,A=>{e().data&&t(s)&&t(r)&&A(b)})}m($),m(w),p(v,w),H(),c()}export{$e as component,ye as universal};
