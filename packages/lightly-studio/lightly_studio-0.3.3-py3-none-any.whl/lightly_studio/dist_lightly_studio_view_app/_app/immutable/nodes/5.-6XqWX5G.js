import"../chunks/CWj6FrbW.js";import{p as ft,f as A,n as ce,a as ht,ax as Ot,g as t,d as s,s as c,c as m,r as u,t as gt,l as Mt,u as Re,J as h,a7 as it,$ as oe}from"../chunks/CH6P3X75.js";import{c as dt,a as o,t as C,d as se,n as Et}from"../chunks/RmD8FzRo.js";import{i as H,a as Z,s as Lt}from"../chunks/DA6bFLPR.js";import{s as Dt}from"../chunks/CCx7Ho51.js";import{p as wt}from"../chunks/keKYsoph.js";import{I as ue,l as j,p as ve,z as me,B as He,C as Ne,D as Te,E as Gt,i as Ue,F as ge,_ as Fe,H as kt,J as fe,K as he,S as Xe,j as Zt,n as _e,y as ze,M as Ye,N as je,O as re,P as Ve,c as Oe,k as le,Q as Ze,R as Ke,T as Ge,U as Je,V as We,W as Qe}from"../chunks/DQe_kdRt.js";import{u as pe}from"../chunks/6t3IJ0vQ.js";import{a as qe,g as ta}from"../chunks/DEgUu98i.js";import"../chunks/8NsknIT2.js";import"../chunks/CxFKfZ9T.js";import"../chunks/69_IOA4Y.js";import{e as ie}from"../chunks/D4whDBUi.js";import{s as be,r as xe,a as at,b as ea,p as de}from"../chunks/DQXoLcsF.js";import{S as aa}from"../chunks/CR2upx_Q.js";import{r as Bt}from"../chunks/H7C68rOM.js";import{S as na,s as oa,d as sa,R as ra}from"../chunks/D6r9vr07.js";import{s as Kt}from"../chunks/DGTPl6Gk.js";import{B as la,a as ia,b as Ct,c as jt,H as da,d as Vt,D as ca,e as ua,u as we,Z as va,g as ma,S as ga}from"../chunks/DcY4jgG3.js";import{a as fa,b as ha,d as _a}from"../chunks/CWPZrTTJ.js";import{T as pa,P as ba}from"../chunks/V-MnMC1X.js";function xa(g,e){ft(e,!0);let i=xe(e,["$$slots","$$events","$$legacy"]);ue(g,be({name:"file-image"},()=>i,{iconNode:[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["circle",{cx:"10",cy:"12",r:"2"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"}]],children:(v,a)=>{var r=dt(),N=A(r);Dt(N,()=>e.children??ce),o(v,r)},$$slots:{default:!0}})),ht()}function wa(g,e){ft(e,!0);let i=xe(e,["$$slots","$$events","$$legacy"]);ue(g,be({name:"images"},()=>i,{iconNode:[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18"}],["circle",{cx:"12",cy:"8",r:"2"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2"}]],children:(v,a)=>{var r=dt(),N=A(r);Dt(N,()=>e.children??ce),o(v,r)},$$slots:{default:!0}})),ht()}var ya=C('<!> <span class="hidden sm:inline">Home</span>',1),Sa=C('<!> <span class="max-w-[150px] truncate"> </span>',1),Aa=C('<!> <span class="hidden sm:inline">Samples</span>',1),$a=C('<!> <span class="max-w-[200px] truncate"><!></span>',1),Ia=C("<!> <!> <!> <!> <!> <!> <!>",1);function Pa(g,e){ft(e,!0);const[i,b]=Lt(),v=()=>Z(a,"$samplesTotalCount",i),{samplesTotalCount:a}=pe();la(g,{class:"mb-2","data-testid":"sample-details-breadcrumb",children:(r,N)=>{ia(r,{children:(V,K)=>{var P=Ia(),G=A(P);Ct(G,{children:(x,ot)=>{const E=s(()=>Bt.toHome());jt(x,{get href(){return t(E)},class:"flex items-center gap-2",children:($,T)=>{var l=ya(),w=A(l);da(w,{class:"h-4 w-4"}),Ot(2),o($,l)},$$slots:{default:!0}})},$$slots:{default:!0}});var B=c(G,2);Vt(B,{});var M=c(B,2);Ct(M,{children:(x,ot)=>{const E=s(()=>Bt.toSamples(e.dataset.dataset_id));jt(x,{get href(){return t(E)},class:"flex items-center gap-2",get title(){return e.dataset.directory},children:($,T)=>{var l=Sa(),w=A(l);ca(w,{class:"h-4 w-4"});var f=c(w,2),k=m(f,!0);u(f),gt(()=>{j(f,"title",e.dataset.directory),Kt(k,e.dataset.name)}),o($,l)},$$slots:{default:!0}})},$$slots:{default:!0}});var U=c(M,2);Vt(U,{});var J=c(U,2);Ct(J,{children:(x,ot)=>{const E=s(()=>Bt.toSamples(e.dataset.dataset_id));jt(x,{get href(){return t(E)},class:"flex items-center gap-2",children:($,T)=>{var l=Aa(),w=A(l);wa(w,{class:"h-4 w-4"}),Ot(2),o($,l)},$$slots:{default:!0}})},$$slots:{default:!0}});var W=c(J,2);Vt(W,{});var nt=c(W,2);Ct(nt,{children:(x,ot)=>{ua(x,{class:"flex items-center gap-2",children:(E,$)=>{var T=$a(),l=A(T);xa(l,{class:"h-4 w-4"});var w=c(l,2),f=m(w);{var k=X=>{var p=se();gt(()=>Kt(p,`Sample ${e.sampleIndex+1} of ${v()??""}`)),o(X,p)},F=X=>{var p=se("Sample");o(X,p)};H(f,X=>{e.sampleIndex!==void 0?X(k):X(F,!1)})}u(w),o(E,T)},$$slots:{default:!0}})},$$slots:{default:!0}}),o(V,P)},$$slots:{default:!0}})},$$slots:{default:!0}}),ht(),b()}function ka(g,e){ft(e,!0);const[i,b]=Lt(),v=()=>Z(t(P),"$annotationResp",i),a=()=>Z(t(J),"$sample",i),r=()=>Z(V,"$showAnnotationTextLabelsStore",i),N=()=>Z(M,"$isEditingMode",i),{showAnnotationTextLabelsStore:V}=ve(),K=s(()=>Te({datasetId:e.datasetId,annotationId:e.annotationId})),P=s(()=>t(K).annotation),G=s(()=>t(K).updateAnnotation);let B=s(()=>v().data);const{isEditingMode:M}=wt.data.globalStorage,U=s(()=>we({sampleId:e.sampleId,datasetId:e.datasetId})),J=s(()=>t(U).sample);let W=s(()=>v().data?me(v().data):void 0);const nt=$=>{(async()=>{try{await t(G)({annotation_id:e.annotationId,dataset_id:e.datasetId,bounding_box:$})}catch(l){console.error("Failed to update annotation:",l.message)}})()};var x=dt(),ot=A(x);{var E=$=>{var T=dt(),l=A(T);He(l,()=>t(W),w=>{Ne(w,{get groupId(){return t(B).annotation_id},get onSelect(){return e.toggleAnnotationSelection},get box(){return t(W)},get isSelected(){return e.isSelected},children:(f,k)=>{const F=s(()=>({x:0,y:0,width:a().data.width,height:a().data.height}));na(f,{get annotation(){return t(B)},get showLabel(){return r()},get imageWidth(){return a().data.width},get constraintBox(){return t(F)},get isResizable(){return N()},onBoundingBoxChanged:nt})},$$slots:{default:!0}})}),o($,T)};H(ot,$=>{t(B)&&a().data&&t(W)&&$(E)})}o(g,x),ht(),b()}const Ca=({datasetId:g})=>{const e=Gt(fa());return e.subscribe(()=>{}),{createAnnotation:b=>new Promise((v,a)=>{Mt(e).mutate({path:{dataset_id:g},body:b},{onSuccess:r=>{v(r)},onError:r=>{a(r)}})})}},Ba=()=>{const g=Gt(ha());return g.subscribe(()=>{}),{createLabel:i=>new Promise((b,v)=>{Mt(g).mutate({body:i},{onSuccess:a=>{b(a)},onError:a=>{v(a)}})})}},Ma=({datasetId:g})=>{const e=Gt(_a());return e.subscribe(()=>{}),{deleteAnnotation:b=>new Promise((v,a)=>{Mt(e).mutate({path:{dataset_id:g,annotation_id:b}},{onSuccess:()=>{v()},onError:r=>{a(r)}})})}};var Ea=Et('<rect class="select-none" fill="transparent" role="button" style="outline: 0;cursor: crosshair;" tabindex="0"></rect>'),La=Et('<line x1="0" stroke-width="1" vector-effect="non-scaling-stroke" stroke-dasharray="5,5" opacity="0.6"></line><line y1="0" vector-effect="non-scaling-stroke" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"></line>',1),Da=Et("<!><g><!><!><!></g>",1),Ra=Et("<image></image><!>",1),Ha=C('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Na=C('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function Ta(g,e){ft(e,!0);const[i,b]=Lt(),v=()=>Z(E,"$labels",i),a=()=>Z(t(nt),"$sample",i),r=()=>Z(V,"$selectedSampleIds",i),N=()=>Z(G,"$isHidden",i),{selectedSampleIds:V,toggleSampleSelection:K}=pe(),P=e.dataset.dataset_id,{isHidden:G,handleKeyEvent:B}=Ue(),{settingsStore:M}=ve(),{deleteAnnotation:U}=Ma({datasetId:P}),J=()=>{ta(Bt.toSamples(P))},W=s(()=>we({sampleId:e.sampleId,datasetId:P})),nt=s(()=>t(W).sample),x=s(()=>t(W).refetch),{createAnnotation:ot}=Ca({datasetId:P}),E=ge(),{createLabel:$}=Ba(),T=async({x:n,y:d,width:D,height:O,labelName:y})=>{if(!v().data)return;let Y=v().data.find(R=>R.annotation_label_name===y);Y||(Y=await $({annotation_label_name:y}));try{const R=await ot({sample_id:e.sampleId,annotation_type:"object_detection",x:Math.round(n),y:Math.round(d),width:Math.round(D),height:Math.round(O),annotation_label_id:Y.annotation_label_id});return t(x)(),h(f,at(R.annotation_id)),kt.success("Annotation created successfully"),R}catch(R){kt.error("Failed to create annotation. Please try again."),console.error("Error creating annotation:",R);return}},l=n=>{switch(n.key){case Mt(M).key_go_back:J();break;case" ":n.preventDefault(),K(e.sampleId);break}B(n)};let w=s(()=>ma(e.sampleId)),f=it(void 0);qe(()=>{h(f,void 0),h(F,void 0)});const k=n=>{t(f)===n?h(f,void 0):h(f,at(n))};let F=it(void 0);const X=n=>{if(a().data.annotations){const d=a().data.annotations.find(D=>D.annotation_id===n);d&&h(F,at(me(d)))}};let p=it(!1);const _t=()=>{h(p,!t(p))};let Q=it(!1),I=it(null),L=it(null),_=it(null);const ct=()=>{h(Q,!1),h(I,null),h(_,null)};let q=it(!1);const yt=10,Rt=()=>{if(!t(L))return;const n=oa(t(L));let d=null;const D=sa().on("start",O=>{if(!t(q))return;h(Q,!0);const y=t(L).getBoundingClientRect(),Y=O.sourceEvent.clientX,R=O.sourceEvent.clientY,rt=(Y-y.left)/y.width*a().data.width,tt=(R-y.top)/y.height*a().data.height;d={x:rt,y:tt},h(I,at({x:rt,y:tt,width:0,height:0})),h(_,at({x:rt,y:tt}))}).on("drag",O=>{if(!t(I)||!t(Q)||!d)return;const y=t(L).getBoundingClientRect(),Y=O.sourceEvent.clientX,R=O.sourceEvent.clientY,rt=(Y-y.left)/y.width*a().data.width,tt=(R-y.top)/y.height*a().data.height,Tt=Math.min(d.x,rt),Ut=Math.min(d.y,tt),mt=Math.abs(rt-d.x),bt=Math.abs(tt-d.y);h(I,at({x:Tt,y:Ut,width:mt,height:bt})),h(_,at({x:rt,y:tt}))}).on("end",()=>{!t(I)||!t(Q)||(t(I).width>yt&&t(I).height>yt&&t(z)&&T({x:t(I).x,y:t(I).y,width:t(I).width,height:t(I).height,labelName:t(z).label}),ct(),d=null)});return n.call(D),n.on("mousemove",ut),()=>{D.on("start",null).on("drag",null).on("end",null)}},Ht=n=>{if(!t(L)||t(Q))return;const d=t(L).getBoundingClientRect(),D=n.clientX,O=n.clientY,y=(D-d.left)/d.width*a().data.width,Y=(O-d.top)/d.height*a().data.height;h(_,at({x:y,y:Y})),n.stopPropagation(),n.preventDefault()},ut=Fe.throttle(Ht,50);Re(()=>{Rt()});let z=it(void 0);const pt=s(()=>{if(!a().data)return[];let n=Ye(a().data);return t(p)&&(n=n.filter(d=>d.annotation_id===t(f))),n}),vt=s(()=>t(z)?je(t(z).label,1).color:"blue"),St=async n=>{if(!a().data)return;(async()=>{try{await U(n),kt.success("Annotation deleted successfully"),t(x)(),t(f)===n&&h(f,void 0)}catch(D){kt.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",D)}})()};var st=dt();ie("keydown",oe,l),ie("keyup",oe,B);var xt=A(st);{var Nt=n=>{var d=Na(),D=m(d),O=m(D);Pa(O,{get dataset(){return e.dataset},get sampleIndex(){return e.sampleIndex}}),u(D);var y=c(D,2);aa(y,{class:"mb-4 bg-border-hard"});var Y=c(y,2),R=m(Y),rt=m(R);fe(rt,{className:"h-full",children:(mt,bt)=>{he(mt,{className:"h-full",children:(Se,Ka)=>{var Ft=Ha(),Jt=m(Ft),Xt=m(Jt),Ae=m(Xt);const $e=s(()=>r().has(e.sampleId));Xe(Ae,{onSelect:()=>K(e.sampleId),get isSelected(){return t($e)}}),u(Xt);var Wt=c(Xt,2);{var Ie=At=>{var $t=dt(),It=A($t);Dt(It,()=>e.children),o(At,$t)};H(Wt,At=>{e.children&&At(Ie)})}var Pe=c(Wt,2);const ke=s(()=>t(q)?"crosshair":"auto");va(Pe,{get width(){return a().data.width},get height(){return a().data.height},get cursor(){return t(ke)},get boundingBox(){return t(F)},zoomableContent:$t=>{var It=Ra(),Qt=A(It),Ce=c(Qt);{var Be=zt=>{var qt=Da(),te=A(qt);{var Me=S=>{var et=Ea();ea(et,lt=>h(L,lt),()=>t(L)),gt(()=>{j(et,"width",a().data.width),j(et,"height",a().data.height)}),o(S,et)};H(te,S=>{t(q)&&S(Me)})}var Yt=c(te);let ee;var ae=m(Yt);Zt(ae,17,()=>t(pt),S=>S.annotation_id,(S,et)=>{const lt=s(()=>t(f)===t(et).annotation_id);ka(S,{get annotationId(){return t(et).annotation_id},get sampleId(){return e.sampleId},datasetId:P,get isSelected(){return t(lt)},toggleAnnotationSelection:k})});var ne=c(ae);{var Ee=S=>{ra(S,{get bbox(){return t(I)},get colorStroke(){return t(vt)},colorFill:"rgba(0, 123, 255, 0.1)",style:"outline: 0;",opacity:.8,scale:1})};H(ne,S=>{t(I)&&t(Q)&&t(z)&&S(Ee)})}var Le=c(ne);{var De=S=>{var et=La(),lt=A(et),Pt=c(lt);gt(()=>{j(lt,"y1",t(_).y),j(lt,"x2",a().data.width),j(lt,"y2",t(_).y),j(lt,"stroke",t(vt)),j(Pt,"x1",t(_).x),j(Pt,"x2",t(_).x),j(Pt,"y2",a().data.height),j(Pt,"stroke",t(vt))}),o(S,et)};H(Le,S=>{t(_)&&t(q)&&S(De)})}u(Yt),gt(S=>ee=_e(Yt,0,"",null,ee,S),[()=>({invisible:N()})]),o(zt,qt)};H(Ce,zt=>{a().data&&zt(Be)})}gt(()=>j(Qt,"href",t(w))),o($t,It)},$$slots:{zoomableContent:!0}}),u(Jt),u(Ft),o(Se,Ft)},$$slots:{default:!0}})},$$slots:{default:!0}}),u(R);var tt=c(R,2),Tt=m(tt);{var Ut=mt=>{Oa(mt,{get sample(){return a().data},get selectedAnnotationId(){return t(f)},get hideUnselected(){return t(p)},toggleHideUnselected:_t,onAnnotationClick:k,onClickCenterIcon:X,onDeleteAnnotation:St,get onUpdate(){return t(x)},get addAnnotationEnabled(){return t(q)},set addAnnotationEnabled(bt){h(q,at(bt))},get addAnnotationLabel(){return t(z)},set addAnnotationLabel(bt){h(z,at(bt))}})};H(Tt,mt=>{a().data&&mt(Ut)})}u(tt),u(Y),u(d),o(n,d)},ye=n=>{ze(n,{})};H(xt,n=>{a().data?n(Nt):n(ye,!1)})}o(g,st),ht(),b()}var Ua=C("<div> </div>"),Fa=C('<div class="flex gap-1"></div>'),Xa=C("<!> Add annotation",1),za=C('<label class="flex w-full flex-col gap-3 text-muted-foreground"><div class="text-sm">Select a label to create new annotation.</div> <!></label>'),Ya=C('<div class="items-left mb-2 flex flex-col justify-between space-y-2 bg-muted p-2"><div class="mb-2 w-full"><!></div> <!></div>'),ja=C('<div class="flex flex-col gap-3 space-y-4"><!> <div class="mb-2 flex items-center justify-between"><div class="space-y-2"><!></div></div> <div class="flex flex-col gap-2"></div></div>'),Va=C('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-y-auto dark:[color-scheme:dark]"><!> <!> <!></div>');function Oa(g,e){ft(e,!0);const[i,b]=Lt(),v=()=>Z(G,"$annotationLabels",i),a=()=>Z(P,"$isEditingMode",i);let r=de(e,"addAnnotationEnabled",15,!1),N=de(e,"addAnnotationLabel",15,void 0);const V=e.sample.tags,K=s(()=>e.sample.annotations?[...e.sample.annotations].sort((M,U)=>M.annotation_label.annotation_label_name.localeCompare(U.annotation_label.annotation_label_name)):[]),{isEditingMode:P}=wt.data.globalStorage,G=ge(),B=s(()=>Qe(v().data||[]));fe(g,{className:"h-full",children:(M,U)=>{he(M,{className:"h-full flex flex-col",children:(J,W)=>{var nt=Va(),x=m(nt);{var ot=l=>{re(l,{title:"Tags",icon:pa,children:(w,f)=>{var k=Fa();Zt(k,21,()=>V,le,(F,X)=>{var p=Ua(),_t=m(p,!0);u(p),gt(Q=>{_e(p,1,Q),Kt(_t,t(X).name)},[()=>Ve(Oe("inline rounded-lg bg-card px-2 py-2 text-xs"))]),o(F,p)}),u(k),o(w,k)}})};H(x,l=>{V&&V.length>0&&l(ot)})}var E=c(x,2);{var $=l=>{re(l,{title:"Annotations",children:(w,f)=>{var k=ja(),F=m(k);{var X=L=>{var _=Ya(),ct=m(_),q=m(ct);const yt=s(()=>r()?"default":"outline");Ge(q,{title:"Add annotation",get variant(){return t(yt)},"data-testid":"create-rectangle",class:"w-full",onclick:()=>{r(!r())},children:(ut,z)=>{var pt=Xa(),vt=A(pt);ba(vt,{class:"h-4 w-4"}),Ot(),o(ut,pt)},$$slots:{default:!0}}),u(ct);var Rt=c(ct,2);{var Ht=ut=>{var z=za(),pt=c(m(z),2);const vt=s(()=>t(B).find(St=>{var st;return St.value===((st=N())==null?void 0:st.value)}));Je(pt,{get items(){return t(B)},get selectedItem(){return t(vt)},name:"annotation-label",label:"Choose a label",className:"w-full",placeholder:"Select a label",onSelect:st=>{N(st)},notFound:(st,xt)=>{let Nt=()=>xt==null?void 0:xt().inputValue;We(st,{get label(){return Nt()}})},$$slots:{notFound:!0}}),u(z),o(ut,z)};H(Rt,ut=>{r()&&ut(Ht)})}u(_),o(L,_)};H(F,L=>{a()&&L(X)})}var p=c(F,2),_t=m(p),Q=m(_t);Ze(Q,{name:"hide-unselected",label:"Hide unselected annotations",get isChecked(){return e.hideUnselected},get onCheckedChange(){return e.toggleHideUnselected}}),u(_t),u(p);var I=c(p,2);Zt(I,21,()=>t(K),le,(L,_)=>{const ct=s(()=>e.selectedAnnotationId===t(_).annotation_id);Ke(L,{get annotation(){return t(_)},get isSelected(){return t(ct)},onClick:()=>e.onAnnotationClick(t(_).annotation_id),onDeleteAnnotation:()=>e.onDeleteAnnotation(t(_).annotation_id),onClickCenterIcon:q=>{q.stopPropagation(),e.onClickCenterIcon(t(_).annotation_id)},get onUpdate(){return e.onUpdate}})}),u(I),u(k),o(w,k)}})};H(E,l=>{t(K).length>0&&l($)})}var T=c(E,2);ga(T,{get sample(){return e.sample}}),u(nt),o(J,nt)},$$slots:{default:!0}})},$$slots:{default:!0}}),ht(),b()}var Za=C('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="sample-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function _n(g,e){ft(e,!0);const i=s(()=>wt.params.sampleId),b=wt.data.dataset,v=s(()=>Number(wt.params.sampleIndex));var a=Za(),r=m(a),N=m(r);Ta(N,{get sampleId(){return t(i)},dataset:b,get sampleIndex(){return t(v)},children:(V,K)=>{var P=dt(),G=A(P);{var B=M=>{var U=dt(),J=A(U);Dt(J,()=>e.children),o(M,U)};H(G,M=>{e.children&&M(B)})}o(V,P)},$$slots:{default:!0}}),u(r),u(a),o(g,a),ht()}export{_n as component};
