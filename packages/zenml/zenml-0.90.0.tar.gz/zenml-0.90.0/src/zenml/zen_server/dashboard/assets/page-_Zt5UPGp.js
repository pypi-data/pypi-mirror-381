import{j as t,r as p}from"./@radix-3bj3otF9.js";import{c as D}from"./helper-BXlR2ZLp.js";import{E as w,H as v,J as C,K as P,a6 as m,B as j,L as b,O as N,Q as T,R as _,U as k,a7 as A,V as h,a8 as R,r as i,a1 as x,a9 as B,T as F,a2 as E,aa as I,ab as O,ac as U,e as f,a4 as L,z as l,a5 as M}from"./index-Cs2FY84s.js";import{c as H,b as g}from"./@tanstack-CByuvRcg.js";import{u as Q}from"./bulk-delete-2w7wPalO.js";import{S as q}from"./refresh-BaK7e0kN.js";import{S as z}from"./SearchField-Bd1JmJXg.js";import{B as G}from"./button-group-basic-z1namEya.js";import{P as J}from"./Pagination-Du1A_aqP.js";import{S as K}from"./terminal-square-Bg7ZPM8R.js";import{D as $}from"./deployment-status-tag-7j1Qxmk2.js";import{L as c,f as V,a as W}from"./@react-router-Ct_TgVUW.js";import{S as X}from"./trash-B0fyghWi.js";import{D as Y,a as Z}from"./DeleteAlertDialog-8-J1PO_I.js";import"./@reactflow-CwWcBchH.js";import"./index-FwZ5fdjO.js";import"./chevron-right-double-BuLe9bCa.js";import"./zod-36FJuF1H.js";import"./index.esm-DnoyTjte.js";async function ee({payload:s,snapshotId:e}){const a=v(P.pipeline_snapshots.detail(e)),n=await w(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){const r=await n.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Failed to update snapshot ${e}`);throw new C({status:n.status,statusText:n.statusText,message:r})}return n.json()}function te(s){return H({...s,mutationFn:async({payload:e,snapshotId:a})=>ee({payload:e,snapshotId:a})})}const{ContextProvider:se,useContext:u}=D();function S(){const{setRowSelection:s}=u(),{mutateAsync:e}=te();async function a(n){await e({snapshotId:n,payload:{name:!1}})}return Q({deleteFn:a,queryKeyToInvalidate:m.all,setRowSelection:s})}function ae(){const{selectedRowCount:s,selectedRowIDs:e}=u(),{bulkDelete:a}=S();async function n(){await a(e)}return t.jsx(G,{itemName:"Pipeline Snapshot",selectedItemCount:s,onDeleteSelected:n})}function ne({params:s}){const{refetch:e}=g({...m.list(s),throwOnError:!0}),{selectedRowCount:a}=u();return t.jsxs("div",{className:"flex items-center justify-between",children:[a?t.jsx(ae,{}):t.jsx(z,{searchParams:s}),t.jsxs(j,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>e(),children:[t.jsx(q,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})]})}function re({deleteHandler:s}){return t.jsx(Y,{title:"Delete Pipeline Snapshots",handleDelete:s,children:t.jsxs(Z,{children:[t.jsx("p",{children:"Are you sure?"}),t.jsx("p",{children:"This action cannot be undone."})]})})}function oe({deleteHandler:s,open:e,setOpen:a}){return t.jsx(b,{open:e,onOpenChange:a,children:t.jsx(re,{deleteHandler:s})})}function ie({snapshotId:s}){const[e,a]=p.useState(!1),{bulkDelete:n}=S();async function r(){await n([s]),a(!1)}return t.jsxs(t.Fragment,{children:[t.jsx(oe,{deleteHandler:r,open:e,setOpen:a}),t.jsxs(N,{children:[t.jsx(T,{asChild:!0,children:t.jsx(j,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:t.jsx(_,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),t.jsx(k,{align:"end",sideOffset:7,children:t.jsxs(A,{onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[t.jsx(X,{className:"h-3 w-3 fill-neutral-400"}),t.jsx("p",{children:"Delete"})]})})]})]})}function le(){return p.useMemo(()=>[{id:"check",header:({table:s})=>t.jsx(h,{id:"check-all",checked:s.getIsAllRowsSelected(),onCheckedChange:e=>s.toggleAllRowsSelected(e==="indeterminate"?!0:e)}),meta:{width:"1%"},cell:({row:s})=>t.jsx(h,{id:s.id,checked:s.getIsSelected(),onCheckedChange:s.getToggleSelectedHandler(),className:"h-3 w-3"})},{id:"name",header:"Snapshot",accessorFn:s=>s.name,cell:({row:s})=>{const e=s.original.name,a=s.original.id;return t.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[t.jsx(R,{className:"h-5 w-5 fill-primary-400"}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(c,{to:i.projects.snapshots.detail.overview(a),className:"flex items-center gap-1",children:t.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:e??"Unnamed"})}),t.jsx(x,{copyText:e??""})]}),t.jsxs(c,{to:i.projects.snapshots.detail.overview(a),className:"flex items-center gap-1",children:[t.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:B(a)}),t.jsx(x,{copyText:a})]})]})]})}},{id:"deployment",header:"Deployment",accessorFn:s=>{var e,a;return(a=(e=s.resources)==null?void 0:e.deployment)==null?void 0:a.id},cell:({row:s})=>{var r,o;const e=(r=s.original.resources)==null?void 0:r.deployment,a=(o=e==null?void 0:e.body)==null?void 0:o.status,n=e==null?void 0:e.id;return!a||!n?null:t.jsx(c,{to:i.projects.deployments.detail.overview(n),children:t.jsx($,{status:a})})}},{id:"latest-run",header:"Latest Run",accessorFn:s=>{var e;return(e=s.resources)==null?void 0:e.latest_triggered_run_id},cell:({row:s})=>{var n,r;const e=(n=s.original.resources)==null?void 0:n.latest_run_id,a=(r=s.original.resources)==null?void 0:r.latest_run_status;return!e||!a?t.jsx("div",{children:"No run"}):t.jsx(c,{to:i.projects.runs.detail(e),children:t.jsxs(F,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:E(a),children:[t.jsx(K,{className:`h-3 w-3 ${I(a)}`}),e==null?void 0:e.split("-")[0]]})})}},{id:"latest-run-author",header:"Latest Run Author",accessorFn:s=>{var e;return(e=s.resources)==null?void 0:e.latest_run_author},cell:({row:s})=>{var a,n,r;const e=(a=s.original.resources)==null?void 0:a.user;return e?t.jsx(O,{username:e.name,isServiceAccount:!!((n=e.body)!=null&&n.is_service_account),avatarUrl:((r=e.body)==null?void 0:r.avatar_url)??void 0}):null}},{id:"created",header:"Created at",accessorFn:s=>{var e;return{date:(e=s.body)==null?void 0:e.created}},cell:({getValue:s})=>{const{date:e}=s();return t.jsx(U,{dateString:e})}},{id:"admin_actions",header:"",accessorFn:s=>s.id,cell:({row:s})=>{const e=s.original.id;return t.jsx(ie,{snapshotId:e})}}],[])}function ce({params:s}){const{rowSelection:e,setRowSelection:a}=u(),n=le(),r=g({...m.list(s),throwOnError:!0});if(r.isPending)return t.jsxs("div",{className:"flex flex-col items-center gap-5",children:[t.jsx("div",{className:"w-full",children:t.jsx(f,{className:"h-[500px] w-full"})}),t.jsx(f,{className:"h-[36px] w-[300px]"})]});if(r.isError)return t.jsx("p",{children:"Error fetching snapshots"});const o=r.data;return t.jsxs("div",{className:"flex flex-col items-center gap-5",children:[t.jsx("div",{className:"w-full",children:t.jsx(L,{columns:n,data:o.items,rowSelection:e,onRowSelectionChange:a,getRowId:y=>y.id})}),o.total_pages>1&&t.jsx(J,{searchParams:s,paginate:o})]})}const d=1,ue=l.object({page:l.coerce.number().min(d).optional().default(d).catch(d),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function de(){const[s]=V(),{page:e,name:a,operator:n}=ue.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:e,name:a,logical_operator:n}}function pe(){const{pipelineId:s}=W(),e=de(),a={pipeline:s,named_only:!0,...e,sort_by:"desc:updated"};return t.jsxs(t.Fragment,{children:[t.jsx(ne,{params:a}),t.jsx(ce,{params:a})]})}function me(s){const{setBreadcrumbs:e}=M();p.useEffect(()=>{},[e,s])}function Be(){return me(),t.jsx("div",{className:"space-y-5",children:t.jsx(se,{children:t.jsx(pe,{})})})}export{Be as default};
