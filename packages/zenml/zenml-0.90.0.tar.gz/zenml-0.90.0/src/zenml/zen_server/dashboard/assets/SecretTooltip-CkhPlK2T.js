import{j as e,r as A}from"./@radix-3bj3otF9.js";import{S as $}from"./eye-vFb-iYpN.js";import{S as Q}from"./plus-Cewn_igr.js";import{S as z}from"./trash-B0fyghWi.js";import{q as T,c as L,b as B,h as O}from"./@tanstack-CByuvRcg.js";import{H as j,K as g,ag as G,E as w,ai as b,J as N,z as c,bd as H,be as J,D as M,x as U,I as f,B as h,bh as _,bi as R,bj as Y,Y as Z,Z as W,_ as X,aB as I,a0 as ee}from"./index-Cs2FY84s.js";import{t as se}from"./zod-36FJuF1H.js";import{u as te,b as ae,C as p}from"./index.esm-DnoyTjte.js";import{C as re}from"./CodeSnippet-C2p1JJEZ.js";async function ie({params:t}){const i=j(g.secrets.all+"?"+G(t)),s=await w(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&b(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to fetch secrets");throw new N({status:s.status,statusText:s.statusText,message:l})}return s.json()}async function le(t){const i=j(g.secrets.detail(t)),s=await w(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&b(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Failed to fetch secret ${t}`);throw new N({status:s.status,statusText:s.statusText,message:l})}return s.json()}const y={all:["secrets"],secretList:t=>T({queryKey:[...y.all,t],queryFn:async()=>ie({params:t})}),secretDetail:t=>T({queryKey:[...y.all,t],queryFn:async()=>le(t)})};async function ne(t,i){const s=j(g.secrets.detail(t)),l=await w(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status===404&&b(),!l.ok)throw new N({message:"Error updating secret",status:l.status,statusText:l.statusText});return l.json()}function oe(t){return L({mutationFn:async({id:i,body:s})=>ne(i,s),...t})}const ce=c.object({secretName:c.string().min(1,"Secret Name is required"),keysValues:c.array(c.object({key:c.string().min(1,"Key is required"),value:c.string().min(1,"Value is required"),showPassword:c.boolean().optional()}))});function we({secretId:t,isSecretNameEditable:i,dialogTitle:s}){return e.jsxs(H,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(J,{children:e.jsx(M,{children:s})}),e.jsx(ue,{secretId:t,isSecretNameEditable:i})]})}function ue({secretId:t,isSecretNameEditable:i}){const{data:s,isLoading:l,isError:n}=B({...y.secretDetail(t)}),{handleSubmit:C,control:u,setValue:m,watch:v,formState:{isValid:V}}=te({resolver:se(ce),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:x,append:E,remove:D}=ae({control:u,name:"keysValues"});A.useEffect(()=>{var a;s&&(m("secretName",s.name),m("keysValues",Object.entries(((a=s.body)==null?void 0:a.values)||{}).map(([r,o])=>({key:r,value:String(o)}))))},[s,m]);const q=()=>{E({key:"",value:"",showPassword:!1})},{toast:k}=U(),S=O(),{mutate:F}=oe({onError(a){Y(a)&&k({status:"error",emphasis:"subtle",description:a.message,rounded:!0})},onSuccess(){k({status:"success",emphasis:"subtle",description:"Secret updated successfull",rounded:!0}),S.invalidateQueries({queryKey:["secrets"]}),S.invalidateQueries({queryKey:["secretDetail",t]})}}),P=a=>{const r={name:a.secretName,values:a.keysValues.reduce((o,d)=>(d.key&&d.value&&(o[d.key]=d.value),o),{})};F({id:t,body:r})},K=a=>{const r=v(`keysValues.${a}.showPassword`);m(`keysValues.${a}.showPassword`,!r)};return l?e.jsx("p",{children:"Loading..."}):n?e.jsx("p",{children:"Error fetching secret details."}):e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"edit-secret-form",className:"gap-5 p-5",onSubmit:C(P),children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(p,{name:"secretName",control:u,render:({field:a})=>e.jsx(f,{...a,className:"mb-3 w-full",required:!0,disabled:!i})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),x.map((a,r)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(p,{name:`keysValues.${r}.key`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{name:`keysValues.${r}.value`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:v(`keysValues.${r}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>K(r),className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx($,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[r===x.length-1&&e.jsx(h,{intent:"primary",emphasis:"subtle",onClick:q,className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(Q,{className:"flex-shrink-0 fill-primary-600"})}),r!==x.length-1&&e.jsx(h,{intent:"secondary",emphasis:"minimal",onClick:()=>D(r),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(z,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},a.id))]})}),e.jsxs(_,{className:"gap-[10px]",children:[e.jsx(R,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"primary",type:"submit",form:"edit-secret-form",disabled:!V,children:"Save Secret"})]})]})}function be({code:t}){return e.jsx(Z,{children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(I,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})}),e.jsxs(ee,{className:"z-50 flex max-w-[480px] flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{className:"text-md text-theme-text-primary",children:"To use your secret in a step, you can use the following code:"}),e.jsx(re,{highlightCode:!0,wrap:!0,codeClasses:"break-words",code:t}),e.jsx("a",{className:"link w-fit text-primary-400",target:"_blank",href:"https://docs.zenml.io/how-to/interact-with-secrets#accessing-registered-secrets",children:"Learn More"})]})]})})}export{we as E,be as S,y as a,ce as s,oe as u};
