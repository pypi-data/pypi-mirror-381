import{r as c,j as e}from"./@radix-3bj3otF9.js";import{c as R}from"./helper-BXlR2ZLp.js";import{H as k,J as A,K as _,p as D,L as O,M as E,B as v,N as P,O as I,Q as B,R as F,U as z,V as f,W as L,X as $,r as m,Y as M,Z as H,_ as Q,$ as q,a0 as G,a1 as j,T as K,a2 as U,a3 as J,z as d,a4 as V,e as w}from"./index-Cs2FY84s.js";import{c as W,b as X}from"./@tanstack-CByuvRcg.js";import{u as Y}from"./bulk-delete-2w7wPalO.js";import{S as Z}from"./refresh-BaK7e0kN.js";import{P as ee}from"./Pagination-Du1A_aqP.js";import{S as te}from"./SearchField-Bd1JmJXg.js";import{S as se}from"./alert-triangle-BvW2I3qT.js";import{S}from"./trash-B0fyghWi.js";import{D as y,a as C}from"./DeleteAlertDialog-8-J1PO_I.js";import{L as h,f as ne}from"./@react-router-Ct_TgVUW.js";import{A as ae}from"./AlertDialogDropdownItem-WCI5zz6Q.js";import"./@reactflow-CwWcBchH.js";import"./chevron-right-double-BuLe9bCa.js";import"./index-FwZ5fdjO.js";import"./zod-36FJuF1H.js";import"./index.esm-DnoyTjte.js";async function re({pipelineId:t}){const s=k(_.pipelines.detail(t)),n=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(r=>r.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new A({status:n.status,statusText:n.statusText,message:a})}return n.json()}function ie(t){return W({mutationFn:re,...t})}const{ContextProvider:le,useContext:u}=R();function b(){const{setRowSelection:t}=u(),{mutateAsync:s}=ie();async function n(a){await s({pipelineId:a})}return Y({deleteFn:n,queryKeyToInvalidate:D.all,setRowSelection:t})}function oe(){const[t,s]=c.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=u(),{bulkDelete:r}=b();async function l(){await r(a),s(!1)}const i=P(n,"Pipeline"),p=`Delete ${i}`;return e.jsxs(O,{open:t,onOpenChange:s,children:[e.jsx(E,{asChild:!0,children:e.jsxs(v,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(S,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(y,{title:p,handleDelete:l,children:e.jsxs(C,{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]}),e.jsx("div",{className:"space-y-3 rounded-md border border-warning-300 bg-warning-50 px-2 py-1 text-warning-900",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[e.jsx(se,{width:24,height:24,className:"shrink-0 fill-warning-700"}),e.jsxs("p",{children:["This will also delete all runs and snapshots associated with the ",i,"."]})]})})]})})]})}function ce(){const{selectedRowCount:t}=u(),s=P(t,"Pipeline");return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} ${s} selected`}),e.jsx(oe,{})]})}function de({id:t}){const[s,n]=c.useState(!1),[a,r]=c.useState(!1),l=c.useRef(null),i=c.useRef(null),{bulkDelete:p}=b();async function N(){await p([t]),g(!1)}function T(){i.current=l.current}function g(o){if(o===!1){r(!1),setTimeout(()=>{n(o)},200);return}n(o)}return e.jsxs(I,{onOpenChange:r,open:a,children:[e.jsx(B,{ref:l,children:e.jsx(F,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(z,{hidden:s,onCloseAutoFocus:o=>{i.current&&(i.current.focus(),i.current=null,o.preventDefault())},align:"end",sideOffset:7,children:e.jsx(ae,{onSelect:T,open:s,onOpenChange:g,triggerChildren:"Delete",icon:e.jsx(S,{fill:"red"}),children:e.jsx(y,{title:"Delete Pipeline",handleDelete:N,children:e.jsxs(C,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})})]})}function ue(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(f,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(f,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>{var s,n,a;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(L,{className:`h-5 w-5 ${$((s=t.original.resources)==null?void 0:s.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{to:m.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(M,{children:e.jsxs(H,{children:[e.jsx(Q,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(q,{status:(n=t.original.resources)==null?void 0:n.latest_run_status})}),e.jsx(G,{className:"z-20 capitalize",children:(a=t.original.resources)==null?void 0:a.latest_run_status})]})}),e.jsx(j,{copyText:t.original.name})]}),e.jsxs(h,{to:m.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(j,{copyText:t.original.id})]})]})]})}},{id:"latest-run",header:"Latest Run",accessorFn:t=>{var s,n;return{status:(s=t.resources)==null?void 0:s.latest_run_status,runId:(n=t.resources)==null?void 0:n.latest_run_id}},cell:({getValue:t})=>{const{runId:s,status:n}=t();return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(h,{to:m.projects.runs.detail(s),children:e.jsxs(K,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:U(n),children:[e.jsx(J,{className:"h-3 w-3 fill-current"}),s==null?void 0:s.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(de,{id:t.original.id})}]}const x=1,pe=d.object({page:d.coerce.number().min(x).optional().default(x).catch(x),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function me(){const[t]=ne(),{page:s,name:n,operator:a}=pe.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:n,logical_operator:a}}function he(){const t=me(),{selectedRowCount:s,rowSelection:n,setRowSelection:a}=u(),{data:r,refetch:l}=X({...D.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[s?e.jsx(ce,{}):e.jsx(te,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(v,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>l(),children:[e.jsx(Z,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(V,{rowSelection:n,onRowSelectionChange:a,getRowId:i=>i.id,columns:ue(),data:r.items}):e.jsx(w,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(ee,{searchParams:t,paginate:r}):e.jsx(w,{className:"h-[36px] w-[300px]"})]})]})}function Oe(){return e.jsx(le,{children:e.jsx(he,{})})}export{Oe as default};
