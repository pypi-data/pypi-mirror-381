import{j as e,r as u}from"./@radix-3bj3otF9.js";import{E as p,H as f,J as y,K as j,bb as g,bd as v,aC as N,B as l,al as m,bt as d,bs as b,e as w,C,q as k,t as S,v as D,y as E}from"./index-Cs2FY84s.js";import{S as P}from"./chevron-down-smmnLxYI.js";import{I as _}from"./Infobox-D2Qx_9-M.js";import{c as F,b as R}from"./@tanstack-CByuvRcg.js";import{a as T}from"./@react-router-Ct_TgVUW.js";import{F as z}from"./icon-BIBS1559.js";import"./@reactflow-CwWcBchH.js";import"./alert-triangle-BvW2I3qT.js";async function O({connectorId:s}){const t=f(j.serviceConnectors.verifyExisting(s)),n=await p(t,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().then(a=>Array.isArray(a.detail)?a.detail[1]:a.detail).catch(()=>"Failed to verify connector");throw new y({status:n.status,statusText:n.statusText,message:r})}return n.json()}function V(s){return F({...s,mutationFn:async({connectorId:t})=>O({connectorId:t})})}const B="/assets/connectivity-4UKGMYnr.webp";function I({open:s,isLoading:t,isError:n,onClose:r,onSuccess:a,data:c}){const i=!!(c!=null&&c.error),o=(c==null?void 0:c.error)??void 0;return e.jsx(g,{open:s,children:e.jsx(v,{onPointerDownOutside:x=>t?x.preventDefault():r==null?void 0:r(),onEscapeKeyDown:x=>t?x.preventDefault():r==null?void 0:r(),className:"max-w-[540px] p-8",children:e.jsxs("div",{className:"flex w-full flex-col items-center justify-center space-y-5",children:[t&&!c&&e.jsx(A,{onClose:r}),!t&&!n&&!i&&e.jsx(K,{onSuccess:a}),!t&&(n||i)&&e.jsx(Q,{error:o,onClose:r})]})})})}function A({onClose:s}){return e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Verifying your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["Please wait while we check your connection ",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Cancel"})]})}function K({onSuccess:s}){return e.jsxs(e.Fragment,{children:[e.jsx(m,{width:180,height:180,className:"fill-theme-text-success"}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Connection verified successfully!"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Ready to show your available resources"})]}),e.jsx(l,{size:"md",onClick:s,className:"mt-4",children:"Display Resources"})]})}function Q({onClose:s,error:t}){return e.jsxs(e.Fragment,{children:[e.jsx("img",{src:B,alt:"Connectivity",width:180,height:180}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"We couldn't verify your connection"}),t&&e.jsx("p",{className:"max-h-[250px] overflow-auto rounded-md border border-theme-border-moderate bg-theme-surface-secondary p-1 text-left font-mono",children:t}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Please try again to list your resources"})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Close"})]})}function h({children:s}){const{setResources:t}=d(),{connectorId:n}=T(),r=R({...b.serviceConnectorDetail(n),throwOnError:!0}),[a,c]=u.useState(!1),i=V();if(r.isPending)return e.jsx(w,{className:"h-7 w-[150px]"});if(r.isError)return null;const o=()=>{c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{data:i.data,open:a,isLoading:i.isPending,isError:i.isError,onClose:o,onSuccess:()=>{i.data&&(t(i.data),c(!1))}}),e.jsxs(l,{disabled:i.isPending&&a,onClick:()=>{c(!0),i.mutate({connectorId:n})},className:"gap-1",size:"md",children:[e.jsx(m,{width:24,height:24,className:"size-5 shrink-0 fill-white"}),s]})]})}function H(){var n;const{resources:s}=d();if(!s)return null;const t=s.connector_type;return!t||typeof t=="string"?null:e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{children:e.jsx("span",{children:"Reverify now"})})}),(n=s.resources)==null?void 0:n.map(r=>{var a,c;return e.jsx(M,{title:(a=t.resource_types.find(i=>i.resource_type===r.resource_type))==null?void 0:a.name,logoUrl:((c=t.resource_types.find(i=>i.resource_type===r.resource_type))==null?void 0:c.logo_url)??void 0,resource:r},r.resource_type)})]})}function M({resource:s,title:t,logoUrl:n}){const[r,a]=u.useState(!0),c=s.error,i=s.resource_ids??[];return e.jsxs(C,{open:r,onOpenChange:a,children:[e.jsx(k,{className:"flex items-center gap-[10px]",children:e.jsxs(S,{className:"flex w-full items-center gap-[10px] text-text-lg",children:[e.jsx(P,{className:` ${r?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),t||s.resource_type]})}),e.jsx(D,{className:"space-y-5 border-t border-theme-border-moderate bg-theme-surface-primary",children:c?e.jsx("div",{className:"p-5",children:e.jsx(_,{intent:"error",children:c})}):e.jsx("ul",{className:"divide-y divide-theme-border-moderate",children:i.map(o=>e.jsxs("li",{className:"flex items-center space-x-2 py-3 pl-8",children:[!!n&&e.jsx("img",{width:24,height:24,src:n,alt:t,className:"size-5 shrink-0"}),e.jsx("span",{children:o})]},o))})})]})}function U(){return e.jsx("div",{className:"p-9",children:e.jsxs("div",{className:"flex flex-col items-center space-y-5",children:[e.jsx(z,{icon:e.jsx(E,{className:"h-[36px] w-[36px] fill-primary-400"})}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Please verify your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["We'll check your connection and load available resources.",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(h,{children:e.jsx("span",{children:"Verify now"})})]})})}function ee(){const{resources:s}=d();return s===null?e.jsx(U,{}):e.jsx(H,{})}export{ee as default};
