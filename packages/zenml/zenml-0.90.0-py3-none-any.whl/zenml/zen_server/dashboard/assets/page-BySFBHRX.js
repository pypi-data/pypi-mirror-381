import{r as h,j as e}from"./@radix-3bj3otF9.js";import{bb as D,bc as C,a7 as H,E as k,H as E,ai as U,J as T,K as P,bd as F,be as O,D as A,I as j,bh as V,bi as I,B as p,O as J,Q as G,R as W,U as X,bl as Y,r as v,a1 as w,ab as Z,ac as ee,z as f,u as se,e as N,x as te,bj as re,a4 as ae,l as ne}from"./index-Cs2FY84s.js";import{P as ie}from"./Pagination-Du1A_aqP.js";import{S as le}from"./SearchField-Bd1JmJXg.js";import{E as ce,S as oe,s as de,a as me}from"./SecretTooltip-CkhPlK2T.js";import{c as _,h as q,b as ue}from"./@tanstack-CByuvRcg.js";import{S as xe}from"./Lock-CYxsr3Z1.js";import{c as he}from"./code-snippets-Cro2ORGr.js";import{L as b,f as pe}from"./@react-router-Ct_TgVUW.js";import{S as L}from"./trash-B0fyghWi.js";import{S as fe}from"./eye-vFb-iYpN.js";import{S as R}from"./plus-Cewn_igr.js";import{t as je}from"./zod-36FJuF1H.js";import{u as ge,b as ye,C as g}from"./index.esm-DnoyTjte.js";import"./@reactflow-CwWcBchH.js";import"./chevron-right-double-BuLe9bCa.js";import"./index-FwZ5fdjO.js";import"./CodeSnippet-C2p1JJEZ.js";const S=h.forwardRef((t,s)=>{const{triggerChildren:r,children:a,onSelect:n,onOpenChange:i,icon:d,open:u,...x}=t;return e.jsxs(D,{open:u,onOpenChange:i,children:[e.jsx(C,{asChild:!0,children:e.jsx(H,{...x,className:"hover:cursor-pointer",icon:t.icon,ref:s,onSelect:m=>{m.preventDefault(),n&&n()},children:r})}),a]})});S.displayName="DialogItem";async function Ne(t){const s=E(P.secrets.detail(t)),r=await k(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(r.status===404&&U(),!r.ok)throw new T({message:"Error deleting secret",status:r.status,statusText:r.statusText});return r.json()}function Se(t){return _({mutationFn:async s=>Ne(s),...t})}function ve({secretId:t}){const s=q(),{mutate:r}=Se({onSuccess(){s.invalidateQueries({queryKey:["secrets"]})}}),[a,n]=h.useState("");function i(){r(t)}function d(u){n(u.target.value)}return e.jsxs(F,{children:[e.jsx(O,{children:e.jsx(A,{children:"Delete secret"})}),e.jsxs("div",{className:"gap-5 p-5",children:[e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"Are you sure you want to delete this secret?"}),e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"This action cannot be undone."}),e.jsx("h3",{className:"font-inter text-sm mb-1 mt-4 text-left font-medium leading-5",children:"Please type DELETE to confirm"}),e.jsx(j,{name:"key",onChange:d,className:"w-full",required:!0,value:a})]}),e.jsxs(V,{className:"gap-[10px]",children:[e.jsx(I,{asChild:!0,children:e.jsx(p,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(p,{intent:"danger",type:"submit",form:"edit-secret-form",onClick:i,disabled:a!=="DELETE",children:"Delete"})]})]})}function we({secretId:t}){const[s,r]=h.useState(!1),[a,n]=h.useState(!1),i=h.useRef(null),d=h.useRef(null);function u(){d.current=i.current}function x(m){if(m===!1){r(!1),setTimeout(()=>{n(m)},200);return}n(m)}return e.jsxs(J,{onOpenChange:r,open:s,children:[e.jsx(G,{ref:i,children:e.jsx(W,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsxs(X,{hidden:a,onCloseAutoFocus:m=>{d.current&&(d.current.focus(),d.current=null,m.preventDefault())},align:"end",sideOffset:7,children:[e.jsx(S,{onSelect:u,onOpenChange:x,triggerChildren:"Edit ",icon:e.jsx(Y,{}),children:e.jsx(ce,{secretId:t,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsx(S,{onSelect:u,onOpenChange:x,triggerChildren:"Delete ",icon:e.jsx(L,{}),children:e.jsx(ve,{secretId:t})})]})]})}const be=[{id:"secret",header:"Secret",accessorFn:t=>t.name,cell:({getValue:t,row:s})=>{const r=he(s.original.name);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-5 w-5 flex-shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(b,{className:"text-text-md font-semibold text-theme-text-primary",to:v.settings.secrets.detail(s.original.id),children:s.original.name}),e.jsx(oe,{code:r})]}),e.jsx(w,{copyText:t()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{to:v.settings.secrets.detail(s.original.id),className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:s.original.id.slice(0,8)}),e.jsx(w,{copyText:s.original.id})]})]})]})}},{id:"author",header:"Author",accessorFn:t=>{var s,r;return(r=(s=t.resources)==null?void 0:s.user)==null?void 0:r.name},cell:({row:t})=>{var r,a,n;const s=(r=t.original.resources)==null?void 0:r.user;return s?e.jsx(Z,{avatarUrl:((a=s.body)==null?void 0:a.avatar_url)??void 0,username:s.name,isServiceAccount:!!((n=s.body)!=null&&n.is_service_account)}):null}},{id:"created_at",header:"Created At",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(ee,{dateString:t()})})},{id:"admin_actions",header:"",accessorFn:t=>String(t.id),cell:({row:t,getValue:s})=>{var a,n,i;const r=s();return(i=(n=(a=t.original.resources)==null?void 0:a.user)==null?void 0:n.body)!=null&&i.is_admin?e.jsx(we,{secretId:r}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}],y=1,De=f.object({page:f.coerce.number().min(y).optional().default(y).catch(y),name:f.string().optional(),operator:f.enum(["and","or"]).optional()});function Ce(){const[t]=pe(),{page:s,name:r,operator:a}=De.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:r,logical_operator:a}}async function ke(t){const s=E(P.secrets.all),r=await k(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const a=await r.json().then(n=>n.detail).catch(()=>"Failed to create Secret");throw new T({status:r.status,statusText:r.statusText,message:a})}return r.json()}function Ee(t){return _({mutationFn:async s=>ke(s),...t})}function Te(){const[t,s]=h.useState(!1),r=se();if(r.isPending)return e.jsx(N,{className:"h-7 w-full"});if(r.isError)return e.jsx("div",{children:"Error loading user"});const a=r.data.id;return e.jsxs(D,{open:t,onOpenChange:s,children:[e.jsx(C,{asChild:!0,children:e.jsxs(p,{size:"md",className:"shrink-0",intent:"primary",children:[e.jsx(R,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Secret"})]})}),e.jsxs(F,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(O,{children:e.jsx(A,{children:"Register New Secret"})}),e.jsx(Pe,{userId:a,setOpen:s})]})]})}function Pe({userId:t,setOpen:s}){const{handleSubmit:r,control:a,watch:n,setValue:i,formState:{isValid:d},reset:u}=ge({resolver:je(de),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:x,append:m,remove:M}=ye({control:a,name:"keysValues"}),{toast:Q}=te(),z=q(),{mutate:K}=Ee({onError(l){re(l)&&Q({status:"error",emphasis:"subtle",description:l.message,rounded:!0})},onSuccess(){z.invalidateQueries({queryKey:["secrets"]}),s(!1),u()}}),$=l=>{K({user:t,name:l.secretName,values:l.keysValues.reduce((c,o)=>(o.key&&o.value&&(c[o.key]=o.value),c),{})})},B=l=>{$(l)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:r(B),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(g,{name:"secretName",control:a,render:({field:l})=>e.jsx(j,{...l,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),x.map((l,c)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(g,{name:`keysValues.${c}.key`,control:a,render:({field:o})=>e.jsx(j,{...o,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{name:`keysValues.${c}.value`,control:a,render:({field:o})=>e.jsx(j,{...o,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:n(`keysValues.${c}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>{const o=n(`keysValues.${c}.showPassword`);i(`keysValues.${c}.showPassword`,!o)},className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[c===x.length-1&&e.jsx(p,{intent:"primary",emphasis:"subtle",onClick:()=>m({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(R,{className:"flex-shrink-0 fill-primary-600"})}),c!==x.length-1&&e.jsx(p,{intent:"secondary",emphasis:"minimal",onClick:()=>M(c),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(L,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},l.id))]})}),e.jsxs(V,{className:"gap-[10px]",children:[e.jsx(I,{asChild:!0,children:e.jsx(p,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(p,{intent:"primary",disabled:!d,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function Fe(){const t=Ce(),{data:s}=ue({...me.secretList({...t,sort_by:"desc:created"}),throwOnError:!0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(le,{searchParams:t}),e.jsx(Te,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(ae,{columns:be,data:s.items}):e.jsx(N,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(ie,{searchParams:t,paginate:s}):e.jsx(N,{className:"h-[36px] w-[300px]"})]})]})}function We(){return e.jsxs(ne,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your pipeline secrets and configurations."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"link text-primary-400",children:"Learn More"})]})]}),e.jsx(Fe,{})]})}export{We as default};
