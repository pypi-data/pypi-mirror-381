[tox]
min_version = 4.8
env_list = py311, py312, py313, pg, ruff, black
isolated_build = true
skip_missing_interpreters = true

# Default: unit tests that DON'T need a DB
[testenv]
description = Run unit tests (no DB extras)
extras = dev
pass_env = PG_DSN, POSTGRES_DSN, DATABASE_URL
set_env = PYTHONDONTWRITEBYTECODE=1
commands = pytest -q -m "not pg"

# Integration tests that DO need PostgreSQL extras and a DSN
[testenv:pg]
description = Run tests that require PostgreSQL extras
extras = dev,postgresql
pass_env = PG_DSN, POSTGRES_DSN, DATABASE_URL
commands = pytest -q -m pg

# Ruff lint
[testenv:ruff]
description = Ruff lint
skip_install = true
deps = ruff>=0.6.0
commands = ruff check src tests

# Black formatting check
[testenv:black]
description = Black formatting check
skip_install = true
deps = black
commands = black --check src tests

[flake8]
max-line-length = 100
exclude = __pycache__,.tox,.git,build,dist,.venv