{
  "title": "Visium analysis template",
  "description": "Assay by visium analysis submission.",
  "prism_template_root_object_schema": "assays/visium_analysis.json",
  "prism_template_root_object_pointer": "/analysis/visium_analysis/0",
  "properties": {
    "worksheets": {
      "Visium Analysis": {
        "preamble_rows": {
          "protocol identifier": {
            "merge_pointer": "3/protocol_identifier",
            "type_ref": "clinical_trial.json#properties/protocol_identifier"
          },
          "folder": {
            "do_not_merge": true,
            "type": "string",
            "allow_empty": true
          },
          "batch id": {
            "merge_pointer": "0/batch_id",
            "type_ref": "assays/scrnaseq_assay.json#properties/batch_id"
          },
          "samples metadata csv": {
            "merge_pointer": "0/samples_metadata_csv",
            "type_ref": "assays/components/local_file.json#properties/file_path",
            "gcs_uri_format": "{protocol identifier}/visium_analysis/samples_metadata.csv",
            "is_artifact": 1
          },
          "config yaml": {
            "merge_pointer": "0/config_yaml",
            "type_ref": "assays/components/local_file.json#properties/file_path",
            "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/config.yaml",
            "is_artifact": 1
          },
          "r package versions": {
            "merge_pointer": "0/r_package_versions",
            "type_ref": "assays/components/local_file.json#properties/file_path",
            "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/R_package_versions.csv",
            "is_artifact": 1
          },
          "merged rds": {
            "merge_pointer": "0/merged_rds",
            "type_ref": "assays/components/local_file.json#properties/file_path",
            "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/merged.rds",
            "is_artifact": 1
          }
        },
        "prism_data_object_pointer": "/records/-",
        "data_columns": {
          "visium Runs": {
            "cimac id": {
              "merge_pointer": "/cimac_id",
              "type_ref": "sample.json#properties/cimac_id",
              "process_as": [
                {
                  "parse_through": "lambda id: f'{folder or \"\"}spatial_variable_features/{id}_spatial_variable_features.rds'",
                  "merge_pointer": "0/spatial_variable_features_rds",
                  "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/{cimac id}/spatial_variable_features.rds",
                  "type_ref": "assays/components/local_file.json#properties/file_path",
                  "is_artifact": 1
                },
                {
                  "parse_through": "lambda id: f'{folder or \"\"}report/{id}_report.html'",
                  "merge_pointer": "0/report_html",
                  "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/{cimac id}/report.html",
                  "type_ref": "assays/components/local_file.json#properties/file_path",
                  "is_artifact": 1
                },
                {
                  "parse_through": "lambda id: f'{folder or \"\"}{id}_spaceranger.zip'",
                  "merge_pointer": "0/visium_spaceranger_output_zip",
                  "gcs_uri_format": "{protocol identifier}/visium_analysis/{batch id}/{cimac id}/visium_spaceranger_output.zip",
                  "type_ref": "assays/components/local_file.json#properties/file_path",
                  "is_artifact": 1
                }
              ]
            },
            "comments": {
              "type_ref": "assays/scrnaseq_analysis.json#definitions/entry/properties/comments",
              "merge_pointer": "0/comments",
              "allow_empty": true
            }
          }
        }
      },
      "Excluded Samples": {
        "prism_data_object_pointer": "/excluded_samples/-",
        "data_columns": {
          "Samples Excluded From Analysis": {
            "cimac id": {
              "type_ref": "sample.json#properties/cimac_id",
              "merge_pointer": "0/cimac_id"
            },
            "reason": {
              "type_ref": "assays/components/excluded_samples.json#items/properties/reason_excluded",
              "merge_pointer": "0/reason_excluded"
            }
          }
        }
      }
    }
  }
}
