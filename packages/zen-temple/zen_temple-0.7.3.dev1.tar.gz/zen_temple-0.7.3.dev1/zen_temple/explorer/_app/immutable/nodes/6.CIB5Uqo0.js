import"../chunks/DsnmJJEf.js";import{o as qe,s as Ae}from"../chunks/CfPWzxx9.js";import{p as pt,u as Be,e as tt,s as O,b as be,d as b,g as e,l as ne,k as ot,h as oe,aZ as st,m as ae,c as Ie,f as ie,a as R,a_ as nt,v as xe,r as Z,i as Y,j as _t,t as wt,n as Et}from"../chunks/XfyNEFST.js";import{p as Ct,i as de,b as Nt}from"../chunks/CyI3pj5p.js";import{F as $t,n as Fe,r as Ot,b as Ke,S as Bt,c as Tt,t as St,f as Dt}from"../chunks/C0T7Jkdw.js";import{e as We,i as Xe,u as Rt,g as It,b as it}from"../chunks/BvtU7qVU.js";import{A as lt}from"../chunks/DnOfo-ZS.js";import{D as Lt}from"../chunks/CZmx3lfa.js";import{s as P,c as kt}from"../chunks/CvUL_eGA.js";import{s as Mt}from"../chunks/5DMf3Tuo.js";import{d as At,e as Je}from"../chunks/B8ie1dNX.js";import{s as ut}from"../chunks/fAgV3R1g.js";import{d as zt,n as jt,s as Re,a as ct,b as Pt,c as Qe,e as et,y as Yt,p as rt,i as ft,f as Ft,T as Ht}from"../chunks/BxLhXNcl.js";import{u as dt}from"../chunks/gMw3n3N4.js";class J{entries;constructor(a){this.entries=a}static fromRows(a){return new J(a.map(r=>{const l={},o=[];return Object.entries(r).forEach(([h,g])=>{if(isNaN(g)){l[h]=g;return}else o.push(Number(g))}),{index:l,data:o}}))}filterByCriteria(a){const r=this.entries.filter(l=>Object.entries(a).every(([o,h])=>Object.keys(l.index).includes(o)?h.includes(l.index[o]):!0));return new J(r)}groupBy(a){const r={},l={};return this.entries.forEach(o=>{const h=Object.fromEntries(a.map(d=>[d,o.index[d]])),g=Object.values(h).join("_");l[g]||(l[g]=h),r[g]?o.data.forEach((d,v)=>{r[g][v]+=Number(d)}):r[g]=o.data}),new J(Object.entries(r).map(([o,h])=>({index:l[o],data:h})))}dump(){return console.table(this.entries.map(a=>({...a.index,...Object.fromEntries(a.data.map((r,l)=>[l.toString(),r]))}))),this}*[Symbol.iterator](){return this.entries[Symbol.iterator]()}forEach(a){return this.entries.forEach(a),this}reduce(a,r){return this.entries.reduce(a,r)}find(a){return this.entries.find(a)}filter(a){return new J(this.entries.filter(a))}get length(){return this.entries.length}get(a){return this.entries[a]}toArray(){return this.entries}}const ze=140,gt=16,Ut=200,Wt=140,Xt=32,He=5,Ve=20,ht=-10,vt=2,De=16;let F=[],Te=[];function je(n,a){return n.reduce((r,l)=>r+a(l),0)}function Vt(){F.forEach(n=>{n.linksOut=Te.filter(a=>a.source===n),n.linksIn=Te.filter(a=>a.target===n)})}function Gt(){F.forEach(n=>{n.value=Math.max(je(n.linksIn,a=>a.value),je(n.linksOut,a=>a.value))})}function Zt(){F=F.filter(n=>n.linksIn.length>0||n.linksOut.length>0)}function qt(){let n=0,a=[];Te.forEach(r=>{xt(r.source,r.target,a)?(r.causesCycle=!0,r.cycleIndex=++n):(r.causesCycle=!1,a.push(r))})}function xt(n,a,r){let l=r.filter(o=>o.source===a);return r.length==0||l.length==0?!1:l.some(o=>o.target===n||xt(n,o.target,r))}function Kt(){let n=F,a=[],r=0;for(;n.length;)a=[],n.forEach(l=>{l.x=r,l.linksOut.forEach(o=>{o.causesCycle||a.push(o.target)})}),n=a,r++;for(n=F;n.length;)a=[],n.forEach(l=>{if(l.linksOut.length>0){const o=l.linksOut.filter(h=>!h.causesCycle).map(h=>h.target.x);o.length>0&&(l.x=Math.max(l.x,Math.min(...o)-1))}l.linksIn.forEach(o=>{o.causesCycle||a.push(o.source)})}),n=a;Jt(Wt+ze)}function Jt(n){F.forEach(a=>{a.x*=n})}function Qt(){let n={};return F.forEach(a=>{const r=a.x;n[r]||(n[r]=[]),n[r].push(a)}),Object.values(n).sort((a,r)=>a[0].x-r[0].x)}function Ge(n){return n.y+n.dy/2}function er(){let n=Qt();a(),o();for(let g=1,d=0;d<Xt;++d,g*=.99)l(g),o(),r(g),o();h();function a(){const g=Math.min(...F.map(d=>d.value>1e-6?Ut/d.value:1/0));n.forEach(d=>{let v=0;d.forEach(y=>{y.y=v,y.dy=y.value*g,v+=y.dy+gt})}),Te.forEach(d=>{d.dy=d.value*g})}function r(g){n.forEach(d=>{d.forEach(v=>{if(v.linksIn.length==0)return;const y=je(v.linksIn,m=>Ge(m.source)*m.value)/je(v.linksIn,m=>m.value);v.y+=(y-Ge(v))*g})})}function l(g){n.slice().reverse().forEach(d=>{d.forEach(v=>{if(v.linksOut.length==0)return;const y=je(v.linksOut,m=>Ge(m.target)*m.value)/je(v.linksOut,m=>m.value);v.y+=(y-Ge(v))*g})})}function o(){n.forEach(g=>{let d=g[0],v,y=0,m=g.length,se;for(g.sort((L,ge)=>L.y-ge.y),se=0;se<m;++se)d=g[se],v=y-d.y,v>0&&(d.y+=v),y=d.y+d.dy+gt})}function h(){let g=Math.min(...F.map(d=>d.y));F.forEach(d=>{d.y-=g})}}function bt(){let n=a=>(r,l)=>r.causesCycle&&l.causesCycle?r.cycleIndex-l.cycleIndex:r.causesCycle?-1:l.causesCycle?1:r[a].y-l[a].y;F.forEach(a=>{a.linksIn.sort(n("source")),a.linksOut.sort(n("target"))}),F.forEach(a=>{let r=0,l=0;a.linksOut.forEach(o=>{o.sy=r,r+=o.dy}),a.linksIn.forEach(o=>{o.ty=l,l+=o.dy})})}function tr(n,a){F=n,Te=a,Vt(),Gt(),Zt(),qt(),Kt(),er(),bt()}function rr(n,a){n<0||n>=F.length||(F[n].y=a,bt())}function mt(){const n=F.map(r=>({label:r.label,color:r.color,value:r.value,unit:r.unit,x:r.x,y:r.y,dy:r.dy,linksIn:Te.map((l,o)=>l.target===r?o:-1).filter(l=>l>=0),linksOut:Te.map((l,o)=>l.source===r?o:-1).filter(l=>l>=0)})),a=Te.map(r=>({source:n[F.indexOf(r.source)],target:n[F.indexOf(r.target)],value:r.value,color:r.color,unit:r.unit,causesCycle:r.causesCycle,cycleIndex:r.cycleIndex,dy:r.dy,sy:r.sy,ty:r.ty}));return[n,a]}const Ze=n=>()=>n;function at(n,{sourceEvent:a,subject:r,target:l,identifier:o,active:h,x:g,y:d,dx:v,dy:y,dispatch:m}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:l,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:h,enumerable:!0,configurable:!0},x:{value:g,enumerable:!0,configurable:!0},y:{value:d,enumerable:!0,configurable:!0},dx:{value:v,enumerable:!0,configurable:!0},dy:{value:y,enumerable:!0,configurable:!0},_:{value:m}})}at.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function ar(n){return!n.ctrlKey&&!n.button}function nr(){return this.parentNode}function or(n,a){return a??{x:n.x,y:n.y}}function sr(){return navigator.maxTouchPoints||"ontouchstart"in this}function ir(){var n=ar,a=nr,r=or,l=sr,o={},h=zt("start","drag","end"),g=0,d,v,y,m,se=0;function L(s){s.on("mousedown.drag",ge).filter(l).on("touchstart.drag",he).on("touchmove.drag",Ce,jt).on("touchend.drag touchcancel.drag",Ne).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function ge(s,N){if(!(m||!n.call(this,s,N))){var D=ce(this,a.call(this,s,N),s,N,"mouse");D&&(Re(s.view).on("mousemove.drag",we,ct).on("mouseup.drag",Ee,ct),Pt(s.view),Qe(s),y=!1,d=s.clientX,v=s.clientY,D("start",s))}}function we(s){if(et(s),!y){var N=s.clientX-d,D=s.clientY-v;y=N*N+D*D>se}o.mouse("drag",s)}function Ee(s){Re(s.view).on("mousemove.drag mouseup.drag",null),Yt(s.view,y),et(s),o.mouse("end",s)}function he(s,N){if(n.call(this,s,N)){var D=s.changedTouches,S=a.call(this,s,N),U=D.length,Q,fe;for(Q=0;Q<U;++Q)(fe=ce(this,S,s,N,D[Q].identifier,D[Q]))&&(Qe(s),fe("start",s,D[Q]))}}function Ce(s){var N=s.changedTouches,D=N.length,S,U;for(S=0;S<D;++S)(U=o[N[S].identifier])&&(et(s),U("drag",s,N[S]))}function Ne(s){var N=s.changedTouches,D=N.length,S,U;for(m&&clearTimeout(m),m=setTimeout(function(){m=null},500),S=0;S<D;++S)(U=o[N[S].identifier])&&(Qe(s),U("end",s,N[S]))}function ce(s,N,D,S,U,Q){var fe=h.copy(),W=rt(Q||D,N),ee,te,pe;if((pe=r.call(s,new at("beforestart",{sourceEvent:D,target:L,identifier:U,active:g,x:W[0],y:W[1],dx:0,dy:0,dispatch:fe}),S))!=null)return ee=pe.x-W[0]||0,te=pe.y-W[1]||0,function $(k,$e,Le){var Se=W,Oe;switch(k){case"start":o[U]=$,Oe=g++;break;case"end":delete o[U],--g;case"drag":W=rt(Le||$e,N),Oe=g;break}fe.call(k,s,new at(k,{sourceEvent:$e,subject:pe,target:L,identifier:U,active:Oe,x:W[0]+ee,y:W[1]+te,dx:W[0]-Se[0],dy:W[1]-Se[1],dispatch:fe}),S)}}return L.filter=function(s){return arguments.length?(n=typeof s=="function"?s:Ze(!!s),L):n},L.container=function(s){return arguments.length?(a=typeof s=="function"?s:Ze(s),L):a},L.subject=function(s){return arguments.length?(r=typeof s=="function"?s:Ze(s),L):r},L.touchable=function(s){return arguments.length?(l=typeof s=="function"?s:Ze(!!s),L):l},L.on=function(){var s=h.on.apply(h,arguments);return s===h?L:s},L.clickDistance=function(s){return arguments.length?(se=(s=+s)*s,L):Math.sqrt(se)},L}function lr(n,a){let r;return function(...l){clearTimeout(r),r=setTimeout(()=>n(...l),a)}}function yt(n,a){let r=0;for(let l of n)(l=+l)&&(r+=l);return r}var ur=nt('<path class="cycle-link svelte-1wzhsk8"></path>'),cr=nt('<path class="link svelte-1wzhsk8"></path>'),fr=nt('<g class="node svelte-1wzhsk8"><rect class="svelte-1wzhsk8"></rect><text text-anchor="middle"> </text></g>'),dr=oe('<div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><svg width="12" height="12" class="svelte-1wzhsk8"><rect width="12" height="12"></rect></svg> </div>'),gr=oe('<div class="fw-bold mt-1 fs-7 px-2 svelte-1wzhsk8">Inflows:</div> <!> <div><strong>Total:</strong> </div>',1),hr=oe('<div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><svg width="12" height="12" class="svelte-1wzhsk8"><rect width="12" height="12"></rect></svg> </div>'),vr=oe('<div class="fw-bold mt-1 fs-7 px-2 svelte-1wzhsk8">Outflows:</div> <!> <div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><strong>Total:</strong> </div>',1),mr=oe('<div class="fw-bold fs-7 px-2 svelte-1wzhsk8"> </div> <!> <!>',1),yr=oe('<div class="position-relative border rounded"><svg class="svelte-1wzhsk8"><g><g class="links"></g><g class="nodes"></g></g></svg> <div class="position-absolute top-0 end-0 m-2"><button class="btn btn-secondary"><i class="bi bi-house"></i> <div class="visually-hidden">Reset zoom</div></button></div> <!></div>');function pr(n,a){pt(a,!0);let r=O(936),l=800,o=O(void 0),h=Ct(a,"id",3,"diagram"),g=lr(L,100);Be(()=>{a.nodes.length&&tt(()=>{se(a.nodes,a.links),g()})});let d=[],v=[],y=O(be([])),m=O(be([]));function se(t,i){d=t.map(f=>({label:f.label??"Unnamed",color:f.color??"#ccc",id:f.id??"",value:0,unit:f.unit??"",linksIn:[],linksOut:[],x:0,y:0,dy:0})),v=i.flatMap(f=>{let p=d.find(_=>_.id===f.source.id&&_.label===f.source.label),x=d.find(_=>_.id===f.target.id&&_.label===f.target.label);return!p||!x?(console.warn("Link refers to unknown node",f),[]):[{source:p,target:x,value:f.value,color:f.color,unit:f.unit,causesCycle:!1,cycleIndex:0,dy:0,sy:0,ty:0}]})}function L(){tr(d,v),(t=>{var i=ot(t,2);b(y,i[0],!0),b(m,i[1],!0)})(mt())}function ge(t,i){return f=>t*(1-f)+i*f}function we(t){if(t.causesCycle){const C=He,w=t.source.x+ze,M=t.source.y+t.sy+t.dy,T=t.target.x,A=t.target.y,X=w+Ve,G=M,u=X,E=ht-t.cycleIndex*(C+vt),I=T-Ve,q=E,ve=I,ue=A+t.ty+t.dy,K=De/2-He;return`M${w},${M}L${X},${G}C${X+De},${G} ${u+De},${E} ${u},${E}H${I-C}C${I-De},${q} ${ve-De},${ue} ${ve},${ue}H${T}V${A+t.ty}H${ve}C${ve-K},${A} ${I-K},${q+C} ${I},${q+C}H${u-C}C${u+K},${E+C} ${X+K},${G-t.dy} ${X},${G-t.dy}L${w},${M-t.dy}`}const i=t.source.x+ze,f=t.target.x,x=ge(i,f)(.5),_=t.source.y+t.sy+t.dy/2,B=t.target.y+t.ty+t.dy/2;return`M${i},${_} C${x},${_} ${x},${B} ${f},${B}`}let Ee=ne(()=>{if(!e(m).length)return 0;const t=Math.max(...e(m).map(i=>i.cycleIndex));return t==0?0:ht-t*(He+vt)}),he=ne(()=>e(y).length&&e(y).some(t=>t.x===0&&t.linksIn.length>0)?-Ve-He-De:0),Ce=ne(()=>{if(!e(y).length)return e(r);const t=Math.max(...e(y).map(i=>i.x+ze));return e(y).some(i=>i.x===t&&i.linksOut.length>0)?t+Ve+He+De-e(he):t-e(he)}),Ne=ne(()=>e(y).length?Math.max(...e(y).map(t=>t.y+t.dy)):l);function ce(t,i=6){const f=10**i;return Math.round(t*f)/f}function s(t){let i,f,p,x=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/;const _=t.match(x);if(_)i=parseInt(_[1],10),f=parseInt(_[2],10),p=parseInt(_[3],10);else return!1;return .299*i+.587*f+.114*p<85}function N(){if(!e(o))return;const{width:t}=e(o).parentElement.getBoundingClientRect();b(r,t,!0),g()}qe(N);let D=O(be(ft.toString())),S=Ft().scaleExtent([1,1/0]).on("zoom",t=>{b(D,t.transform.toString(),!0),$e()}).on("end",()=>{$e()});Be(()=>{S=S.translateExtent([[e(he)-5,e(Ee)-5],[e(Ce)+5,e(Ne)+5]])}),qe(()=>{e(o)&&Re(e(o)).call(S)});function U(){e(o)&&Re(e(o)).call(S.transform,ft)}let Q=ir().on("start",function(){this.parentNode&&this.parentNode.appendChild(this)}).on("drag",function(t){const i=Number(this.dataset.idx);isNaN(i)||(fe(t,i),ee(t))});Be(()=>{e(y),e(o)&&Re(e(o)).selectAll(".node").call(Q)});function fe(t,i){if(t.clientY===0||i<0||i>=e(y).length)return;const f=e(y)[i].y+t.dy,p=Math.max(0,Math.min(l-e(y)[i].dy,f));rr(i,p),(x=>{var _=ot(x,2);b(y,_[0],!0),b(m,_[1],!0)})(mt())}let W=O(null);function ee(t){e(o)&&b(W,rt(t,e(o).parentElement),!0)}let te=O(null);function pe(){e(o)&&b(te,e(o).getBoundingClientRect(),!0)}qe(pe);let $=ne(()=>{if(!e(W)||!e(o))return null;let[t,i]=e(W),f=e(o).getBoundingClientRect(),p=Re(e(o)).selectAll(".node").nodes().findLast(_=>{let B=_.getBoundingClientRect(),C=B.left-f.left,w=B.top-f.top;return t>=C&&t<=C+B.width&&i>=w&&i<=w+B.height});if(!p)return null;let x=Number(p.dataset.idx);return isNaN(x)||x<0||x>=e(y).length?null:e(y)[x]}),k=O(null);function $e(){if(e($)===null||!e(o))return;const t=e(y).findIndex(f=>f===e($));if(t===-1)return;const i=Re(e(o)).selectAll(`.node[data-idx="${t}"]`).nodes()[0];i&&b(k,i.getBoundingClientRect(),!0)}Be($e);let Le=ne(()=>e(k)===null||e(te)===null?0:e(k).left-e(te).left+e(k).width/2),Se=ne(()=>e(k)===null||e(te)===null?0:e(k).top-e(te).top+e(k).height/2),Oe=ne(()=>e(k)===null?0:e(k).height/2),Ue=ne(()=>e(k)===null||e(te)===null?!1:e(k).top-e(te).top>l/2);var Pe=yr();Je("resize",st,N),Je("scroll",st,pe);var le=ae(Pe);P(le,"height",l),le.__mousemove=ee;var Ye=ae(le),c=ae(Ye);We(c,21,()=>e(m).toSorted((t,i)=>i.value-t.value),Xe,(t,i)=>{var f=Ie(),p=ie(f);{var x=B=>{var C=ur();let w;xe((M,T)=>{P(C,"d",M),w=ut(C,"",w,T)},[()=>we(e(i)),()=>({fill:e(i).color})]),R(B,C)},_=B=>{var C=cr();let w;xe((M,T)=>{P(C,"d",M),w=ut(C,"",w,T)},[()=>we(e(i)),()=>({stroke:e(i).color,"stroke-width":Math.max(1,e(i).dy)})]),R(B,C)};de(p,B=>{e(i).causesCycle?B(x):B(_,!1)})}R(t,f)}),Z(c);var z=Y(c);We(z,21,()=>e(y),Xe,(t,i,f)=>{var p=fr();P(p,"data-idx",f);var x=ae(p),_=Y(x),B=ae(_,!0);Z(_),Z(p),xe((C,w)=>{P(x,"x",e(i).x),P(x,"y",e(i).y+1),P(x,"width",ze),P(x,"height",C),P(x,"fill",e(i).color),P(_,"x",e(i).x+ze/2),P(_,"y",e(i).dy>16?e(i).y+e(i).dy/2:e(i).y-2),P(_,"dominant-baseline",e(i).dy>16?"middle":"auto"),P(_,"fill",w),Ae(B,e(i).label)},[()=>Math.max(.1,e(i).dy-2),()=>e(i).dy>16&&s(e(i).color)?"#fff":"#000"]),R(t,p)}),Z(z),Z(Ye),Z(le),Nt(le,t=>b(o,t),()=>e(o));var re=Y(le,2),H=ae(re);H.__click=U,Z(re);var j=Y(re,2);{var V=t=>{Ht(t,{get x(){return e(Le)},get y(){return e(Se)},get yOffset(){return e(Oe)},get isOnTop(){return e(Ue)},content:f=>{var p=mr(),x=ie(p),_=ae(x,!0);Z(x);var B=Y(x,2);{var C=T=>{var A=gr(),X=Y(ie(A),2);We(X,17,()=>e($).linksIn,Xe,(E,I)=>{var q=Ie(),ve=ie(q);{var ue=K=>{var me=dr(),ye=ae(me),ke=ae(ye);Z(ye);var Me=Y(ye);Z(me),xe(_e=>{P(ke,"fill",e(m)[e(I)].source.color),Ae(Me,` ${e(m)[e(I)].source.label??""}: ${_e??""}
								${e(m)[e(I)].unit??""}`)},[()=>ce(e(m)[e(I)].value)]),R(K,me)};de(ve,K=>{e(m)[e(I)]&&K(ue)})}R(E,q)});var G=Y(X,2),u=Y(ae(G));Z(G),xe(E=>{Mt(G,1,kt(["fs-8 px-2 text-no-break",e($).linksOut.length>0&&"border-bottom border-secondary pb-1"]),"svelte-1wzhsk8"),Ae(u,` ${E??""}
						${e($).unit??""}`)},[()=>ce(yt(e($).linksIn.map(E=>e(m)[E]?.value||0)))]),R(T,A)};de(B,T=>{e($).linksIn.length>0&&T(C)})}var w=Y(B,2);{var M=T=>{var A=vr(),X=Y(ie(A),2);We(X,17,()=>e($).linksOut,Xe,(E,I)=>{var q=Ie(),ve=ie(q);{var ue=K=>{var me=hr(),ye=ae(me),ke=ae(ye);Z(ye);var Me=Y(ye);Z(me),xe(_e=>{P(ke,"fill",e(m)[e(I)].target.color),Ae(Me,` ${e(m)[e(I)].target.label??""}: ${_e??""}
								${e(m)[e(I)].unit??""}`)},[()=>ce(e(m)[e(I)].value)]),R(K,me)};de(ve,K=>{e(m)[e(I)]&&K(ue)})}R(E,q)});var G=Y(X,2),u=Y(ae(G));Z(G),xe(E=>Ae(u,` ${E??""}
						${e($).unit??""}`),[()=>ce(yt(e($).linksOut.map(E=>e(m)[E]?.value||0)))]),R(T,A)};de(w,T=>{e($).linksOut.length>0&&T(M)})}xe(()=>Ae(_,e($).label)),R(f,p)},$$slots:{content:!0}})};de(j,t=>{e($)!==null&&t(V)})}Z(Pe),xe(()=>{P(le,"id",h()),P(le,"width",e(r)),P(le,"viewBox",`${e(he)-1} ${e(Ee)} ${e(Ce)+4} ${e(Ne)}`),P(Ye,"transform",e(D))}),Je("mouseleave",le,()=>b(W,null)),R(n,Pe),_t()}At(["mousemove","click"]);var _r=oe("<!> <!>",1),xr=oe("<!> <!> <!>",1),br=oe('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),wr=oe('<div class="text-center">No solution selected</div>'),Er=oe('<div class="text-center">No carriers selected</div>'),Cr=oe('<div class="text-center">No nodes selected</div>'),Nr=oe('<div class="text-center">No data available for the selected filters</div>'),$r=oe('<h1 class="mt-2 mb-4">The Energy System</h1> <!> <h2 class="visually-hidden">Sankey Diagram</h2> <div class="plot my-4"><!></div>',1);function Yr(n,a){pt(a,!0);let r=O(be([])),l=O(!1),o=O(!1),h=O(null),g=O(be([])),d=O(be([])),v=O(null),y=null,m=null,se="",L="",ge="",we=O(null),Ee=O(null),he=O(null),Ce=O(null),Ne=O(null),ce=O(null),s=O(null),N=O(null),D=O(null),S=O(null),U=O(be([])),Q=O(be([])),fe=O(be([]));function W(){pe()}let ee=ne(()=>e(h)?e(h).detail.system.set_carriers.slice().sort():[]),te=ne(()=>e(h)?e(h).detail.system.set_nodes.slice().sort():[]);Be(()=>{if(!e(r).length){b(v,null);return}ge&&e(r).includes(Number(ge))?b(v,ge,!0):b(v,e(r)[0].toString(),!0)}),Be(()=>{e(v)&&(ge=e(v))}),dt(()=>e(ee),()=>!!e(h),()=>se,()=>y,c=>b(g,c,!0),c=>se=c,c=>y=c),dt(()=>e(te),()=>!!e(h),()=>L,()=>m,c=>b(d,c,!0),c=>L=c,c=>m=c),Be(()=>{e(g),e(d),e(v),tt(()=>{Le()})}),Be(()=>{e(v),e(g),e(d),wt().then(()=>{tt(()=>{Rt({year:e(v),car:e(g).map(c=>e(ee).indexOf(c)).join("~")||null,nodes:e(d).map(c=>e(te).indexOf(c)).join("~")||null})})})}),qe(()=>{b(v,It("year"),!0),y=it("car"),m=it("nodes")});async function pe(){if(!e(h))return;b(o,!0);let c=await Dt(e(h).solution_name,["flow_conversion_input","flow_conversion_output","flow_storage_charge","flow_storage_discharge","flow_import","flow_export","demand","shed_demand","flow_storage_inflow","flow_storage_spillage"],e(h).scenario_name,"demand");b(we,J.fromRows(c.flow_conversion_input?.data??[])),b(Ee,J.fromRows(c.flow_conversion_output?.data??[]),!0),b(he,J.fromRows(c.flow_storage_charge?.data??[]),!0),b(Ce,J.fromRows(c.flow_storage_discharge?.data??[]),!0),b(Ne,J.fromRows(c.flow_import?.data??[]),!0),b(ce,J.fromRows(c.flow_export?.data??[]),!0),b(s,J.fromRows(c.demand?.data??[]),!0),b(N,J.fromRows(c.shed_demand?.data??[]),!0),b(D,J.fromRows(c.flow_storage_inflow?.data??[]),!0),b(S,J.fromRows(c.flow_storage_spillage?.data??[]),!0),b(U,c.unit?.data||[],!0),b(o,!1),Le()}function $(c){let z=e(U).find(re=>re.carrier===c)||{};return z[0]||z.units||""}function k(c){return e(h)&&e(h).detail.reference_carrier[c]||""}function $e(c){return e(h)?e(h).detail.system.set_technologies.filter(z=>{const re=e(h)?.detail.carriers_input[z]||[],H=e(h)?.detail.carriers_output[z]||[],j=e(h)?.detail.reference_carrier[z];return[...re,...H].some(V=>c.includes(V))||j&&c.includes(j)}):[]}function Le(){if(!e(h)||!e(we)||!e(Ee)||!e(he)||!e(Ce)||!e(Ne)||!e(ce)||!e(s)||!e(N)||!e(D)||!e(S))return[];const c="rgb(180,180,180)",z=e(h)?.detail.system.set_storage_technologies||[],re=e(h)?.detail.system.set_conversion_technologies||[];function H(u,E,I,q){return{id:u,label:E,color:I,unit:q}}Ot();const j=e(ee).map(u=>H(u,u+" ["+$(u)+"]",Fe(),$(u))),V=re.map(u=>H(u,u,c,$(k(u)))),t=z.map(u=>H(u,u,c,$(k(u)))),i=z.map(u=>H(u,u+"_inflow",c,$(k(u)))),f=z.map(u=>H(u,u+"_spillage",c,$(k(u))));let p=Fe();const x=e(ee).map(u=>H(u,u+"_import",p,$(u)));p=Fe();const _=e(ee).map(u=>H(u,u+"_export",p,$(u)));p=Fe();const B=e(ee).map(u=>H(u,u+"_shed_demand",p,$(u)));p=Fe();const C=e(ee).map(u=>H(u,u+"_demand ["+$(u)+"]",p,$(u))),w={carrier:e(g),node:e(d),technology:$e(e(g))},M=e(r).indexOf(Number(e(v)));if(M===-1)return;const T=[];function A(u,E,I,q,ve=0){return ue=>{const K=ue.data[M]-ve;if(Math.abs(K)<1e-6)return;const me=u.find(_e=>_e.id===ue.index[E]),ye=I.find(_e=>_e.id===ue.index[q]);if(!me||!ye)return;let ke=c;const Me=j.find(_e=>_e.id===ue.index.carrier);Me&&(ke=Me.color||c),T.push({source:me,target:ye,value:K,color:ke,unit:$(ue.index.carrier)})}}function X(u){const E=k(u.index.technology);E&&(u.index.carrier=E)}e(we).filterByCriteria(w).groupBy(["technology","carrier"]).forEach(A(j,"carrier",V,"technology")),e(Ee).filterByCriteria(w).groupBy(["technology","carrier"]).forEach(A(V,"technology",j,"carrier")),e(he).filterByCriteria(w).groupBy(["technology"]).forEach(u=>{const E=k(u.index.technology);E&&(u.index.carrier=E)}).forEach(A(j,"carrier",t,"technology")),e(Ce).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(t,"technology",j,"carrier")),e(D).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(i,"technology",t,"technology")),e(S).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(t,"technology",f,"technology")),e(Ne).filterByCriteria(w).groupBy(["carrier"]).forEach(A(x,"carrier",j,"carrier")),e(ce).filterByCriteria(w).groupBy(["carrier"]).forEach(A(j,"carrier",_,"carrier"));const G=e(N).filterByCriteria(w).groupBy(["carrier"]);G.forEach(A(B,"carrier",C,"carrier")),e(s).filterByCriteria(w).groupBy(["carrier"]).forEach(u=>{const E=G.find(q=>q.index.carrier===u.index.carrier),I=E?E.data[M]:0;A(j,"carrier",C,"carrier",I)(u)}),b(Q,[...j,...V,...t,...i,...f,...x,..._,...B,...C],!0),b(fe,T,!0)}var Se=$r(),Oe=Y(ie(Se),2);$t(Oe,{children:(c,z)=>{var re=xr(),H=ie(re);Ke(H,{title:"Solution Selection",children:(t,i)=>{{let f=ne(()=>e(o)||e(l));Bt(t,{solution_selected:W,get disabled(){return e(f)},get years(){return e(r)},set years(p){b(r,p,!0)},get selected_solution(){return e(h)},set selected_solution(p){b(h,p,!0)},get loading(){return e(l)},set loading(p){b(l,p,!0)}})}}});var j=Y(H,2);Ke(j,{title:"Carrier Selection",children:(t,i)=>{lt(t,{label:"Carriers",get elements(){return e(ee)},get value(){return e(g)},set value(f){b(g,f,!0)}})}});var V=Y(j,2);Ke(V,{title:"Data Selection",children:(t,i)=>{var f=_r(),p=ie(f);Tt(p,{label:"Year",content:(B,C=Et)=>{{let w=ne(()=>St(e(r).map(T=>T.toString()))),M=ne(()=>e(o)||e(l));Lt(B,{get formId(){return C()},get options(){return e(w)},get disabled(){return e(M)},get value(){return e(v)},set value(T){b(v,T,!0)}})}}});var x=Y(p,2);lt(x,{label:"Nodes",get elements(){return e(te)},get value(){return e(d)},set value(_){b(d,_,!0)}}),R(t,f)}}),R(c,re)}});var Ue=Y(Oe,4),Pe=ae(Ue);{var le=c=>{var z=br();R(c,z)},Ye=c=>{var z=Ie(),re=ie(z);{var H=V=>{var t=wr();R(V,t)},j=V=>{var t=Ie(),i=ie(t);{var f=x=>{var _=Er();R(x,_)},p=x=>{var _=Ie(),B=ie(_);{var C=M=>{var T=Cr();R(M,T)},w=M=>{var T=Ie(),A=ie(T);{var X=u=>{var E=Nr();R(u,E)},G=u=>{pr(u,{get nodes(){return e(Q)},get links(){return e(fe)}})};de(A,u=>{e(Q).length===0?u(X):u(G,!1)},!0)}R(M,T)};de(B,M=>{e(d).length===0?M(C):M(w,!1)},!0)}R(x,_)};de(i,x=>{e(g).length===0?x(f):x(p,!1)},!0)}R(V,t)};de(re,V=>{e(h)?V(j,!1):V(H)},!0)}R(c,z)};de(Pe,c=>{e(l)||e(o)?c(le):c(Ye,!1)})}Z(Ue),R(n,Se),_t()}export{Yr as component};
