import"../chunks/DsnmJJEf.js";import{s as we,o as et}from"../chunks/CfPWzxx9.js";import{p as Me,c as re,f as D,a as _,j as Te,h as k,m as F,r as R,i as h,g as e,l,v as Ue,s as y,b as U,u as Le,e as tt,t as rt,d,n as Ae}from"../chunks/XfyNEFST.js";import{i as W}from"../chunks/CyI3pj5p.js";import{u as ot,g as at,a as Ee,b as Fe,e as nt,i as st}from"../chunks/BvtU7qVU.js";import{s as Re}from"../chunks/CvUL_eGA.js";import{B as ye,C as lt}from"../chunks/xV1gGuCK.js";import{F as it,e as dt,b as se,S as ut,c as Be,r as ct,i as _t,f as vt,t as ft,h as gt}from"../chunks/C0T7Jkdw.js";import{A as de}from"../chunks/DnOfo-ZS.js";import{D as mt}from"../chunks/CZmx3lfa.js";import{T as be}from"../chunks/Dsl-dlBH.js";import{u as ue}from"../chunks/gMw3n3N4.js";var ht=k('<div class="text-center text-muted">Click on a bar to see a production and consumption breakdown.</div>'),pt=k('<div class="row"><div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div> <div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div></div>');function bt(ce,P){Me(P,!0);let B=l(()=>{if(P.year==null)return[];const n=P.labels.findIndex(o=>o===P.year);return P.datasets.map(o=>({data:o.data.find((N,O)=>O===n),color:o.backgroundColor,label:o.label}))});function z(n){return{animation:{duration:0},responsive:!0,plugins:{tooltip:{callbacks:{label:o=>{const N=Number(o.raw||0),O=o.dataset.data.map(p=>Number(p||0)).reduce((p,b)=>p+b,0),G=(N*100/O).toFixed(2);return`${o.dataset.label}: ${o.formattedValue}${P.tooltipSuffix} (${G}%)`}}},legend:{position:"top"}}}}function J(n,o){if(P.year==null)return[];const N=e(B).filter(p=>p.data&&n(Number(p.data))),O=N.map(p=>p.data),G=N.map(p=>p.color);return[{label:o,data:O,backgroundColor:G}]}function oe(n){return P.year==null?[]:e(B).filter(o=>o.data&&n(Number(o.data))).map(o=>o.label||"")}let V=l(()=>J(n=>n>1e-6,"Production")),a=l(()=>oe(n=>n>1e-6)),c=l(()=>z()),Y=l(()=>J(n=>n<-1e-6,"Consumption")),$=l(()=>oe(n=>n<-1e-6)),le=l(()=>z());var M=re(),K=D(M);{var q=n=>{var o=ht();_(n,o)},Q=n=>{var o=pt(),N=F(o),O=F(N),G=F(O);R(O);var p=h(O,2);ye(p,{type:"pie",get datasets(){return e(V)},get labels(){return e(a)},get options(){return e(c)},downloadable:!1}),R(N);var b=h(N,2),x=F(b),_e=F(x);R(x);var ie=h(x,2);ye(ie,{type:"pie",get datasets(){return e(Y)},get labels(){return e($)},get options(){return e(le)},downloadable:!1}),R(b),R(o),Ue(()=>{we(G,`Breakdown of Production for ${P.year??""}`),we(_e,`Breakdown of Consumption for ${P.year??""}`)}),_(n,o)};W(K,n=>{P.year==null?n(q):n(Q,!1)})}_(ce,M),Te()}var wt=k('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),yt=k('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),xt=k("<!> <!>",1),Ct=k("<!> <!> <!>",1),St=k("<!> <!> <!> <!>",1),Pt=k("<!> <!>",1),kt=k('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Nt=k("<div></div>"),Ot=k('<div class="text-center">No carriers with this selection.</div>'),jt=k('<div class="text-center">No data with this selection.</div>'),Dt=k('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <h2 class="visually-hidden">Plots</h2> <div class="plot mt-4"><!></div> <div class="my-4"><!></div>',1);function Vt(ce,P){Me(P,!0);let B=y(null),z=y(U([])),J=y(U([])),oe=y(U([])),V=U([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),a=y(null),c=y(null),Y=y(U([])),$=y(U([])),le=l(()=>[...e(Y),...e($)]),M=y(!1),K=y(U([])),q=y(U([])),Q=y(null),n=null,o=null,N="",O="",G="",p="",b=y(!1),x=y(!1),_e=l(()=>{if(!e(a)?.solution_name||!e(c))return"";let t=e(a).solution_name.split(".");return[t[t?.length-1],e(a).scenario_name,e(c)].join("_")}),ie=y(U([])),xe=l(()=>{let t=null;return!t&&e(c)&&(t=e(ie).find(r=>r.carrier==e(c))),t&&(t[0]||t.units)||""}),Ce=l(()=>e(q).map(t=>t.toString())),Se=l(()=>e(M)?"":` ${e(xe)}`),We=l(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>e(Q)&&t.chart.data.labels[t.dataIndex]==e(Q)?5:0,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(M)?"":` [${e(xe)}]`)},max:e(M)?1:void 0,suggestedMin:e(M)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(Se)}`,labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y)>1e-6,borderWidth:0},legend:{labels:{generateLabels:t=>{const r=t.data.datasets;return r.length?r.map((i,u)=>({text:i.label||"",fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:0,hidden:!t.isDatasetVisible(u),datasetIndex:u,fontColor:lt.defaults.color})):[]}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),X=l(()=>e(a)?e(a).detail.system.set_carriers.slice().sort():[]),ve=l(()=>e(a)?dt(Object.entries(e(a).detail.carriers_input).concat(Object.entries(e(a).detail.carriers_output)).filter(t=>e(c)&&t[1].includes(e(c))).map(t=>t[0])):[]),fe=l(()=>e(a)?e(a).detail.system.set_storage_technologies.filter(t=>e(a)?.detail.reference_carrier[t]==e(c)):[]);Le(()=>{e(X),tt(()=>{e(a)&&e(X).length>0&&(!e(c)||e(c)&&!e(X).includes(e(c)))&&d(c,e(X)[0],!0)})}),ue(()=>e(ve),()=>!!e(a),()=>N,()=>n,t=>d(Y,t,!0),t=>N=t,t=>n=t),ue(()=>e(fe),()=>!!e(a),()=>O,()=>o,t=>d($,t,!0),t=>O=t,t=>o=t),ue(()=>e(J),()=>!!e(a),()=>G,()=>null,t=>d(K,t,!0),t=>G=t,()=>{}),ue(()=>e(z),()=>!!e(a),()=>p,()=>null,t=>d(q,t,!0),t=>p=t,()=>{}),et(()=>{d(c,at("car")||null,!0),V.forEach(t=>{t.show=Ee(t.short_id,t.show),t.subdivision=Ee(t.short_id+"_sub",t.subdivision)}),n=Fe("conv_tech"),o=Fe("stor_tech")}),Le(()=>{e(c),V.forEach(t=>{t.show,t.subdivision}),e(Y),e($),rt().then(()=>{let t={car:e(c),conv_tech:e(Y).map(r=>e(ve).indexOf(r)).join("~"),stor_tech:e($).map(r=>e(fe).indexOf(r)).join("~")};V.forEach(r=>{t[r.short_id]=r.show?"1":"0",t[r.short_id+"_sub"]=r.subdivision?"1":"0"}),ot(t)})});async function ze(){await Ye()}function Ve(t){t&&d(Q,e(Q)!==t?t:null,!0)}async function Ye(){if(e(a)===null)return;d(x,!0),d(B,null);const t=await vt(e(a).solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","shed_demand","demand"],e(a).scenario_name,"demand");d(B,V.flatMap(r=>[t[r.positive]||null,t[r.negative]||null]),!0),t.unit?.data&&d(ie,t.unit.data,!0),d(x,!1)}function $e(t,r,i){return r.subdivision?t:Object.entries(t.reduce((u,C)=>{const v=C.node,g=C.technology;if(i&&!i.includes(g))return u;let I=Object.fromEntries(Object.entries(C).filter(([w])=>!isNaN(Number(w))).map(([w,s])=>[w,Number(s)]));return u[v]=u[v]||{technology:r.title,data:{}},u[v].data=Object.fromEntries(Object.entries(I).map(([w,s])=>[w,(s||0)+(u[v].data[w]||0)])),u},{})).map(([u,C])=>({...C.data,technology:C.technology,node:u}))}function Pe(t,r,i,u,C,v){if(t===null)return[];let g={technology:[...e(le),r.title]},I={node:e(K)};const w=$e(t.data.filter(S=>S.carrier===void 0||S.carrier==e(c)),r,r.filter_by_technologies?e(le):void 0);let s=gt(w,g,I,i,!1,void 0,C||"").map(S=>({...S,borderColor:"rgb(0, 0, 0)"}));return v!==void 0&&(s=s.map(v)),!r.subdivision&&s.length>0&&(s[0].label=u),s}let ge=l(()=>{if(e(K).length==0||e(q).length==0||!e(B)||e(B).length==0)return[];let t=e(z).filter(i=>!e(q).includes(i));ct();let r=V.flatMap((i,u)=>{if(!i.show||!e(B))return[];let C=Pe(e(B)[2*u],i,t,i.positive_label,i.positive_suffix,void 0),v=Pe(e(B)[2*u+1],i,t,i.negative_label,i.negative_suffix,g=>({...g,data:Object.values(g.data).map(I=>-Number(I))}));return[...C,...v]});return e(M)?_t(r):r});var ke=Dt(),Ne=h(D(ke),2);it(Ne,{children:(t,r)=>{var i=Pt(),u=D(i);se(u,{title:"Solution Selection",children:(g,I)=>{{let w=l(()=>e(x)||e(b));ut(g,{solution_selected:ze,get disabled(){return e(w)},get selected_solution(){return e(a)},set selected_solution(s){d(a,s,!0)},get years(){return e(z)},set years(s){d(z,s,!0)},get nodes(){return e(J)},set nodes(s){d(J,s,!0)},get edges(){return e(oe)},set edges(s){d(oe,s,!0)},get loading(){return e(b)},set loading(s){d(b,s,!0)}})}}});var C=h(u,2);{var v=g=>{var I=St(),w=D(I);se(w,{title:"Carrier Selection",children:(L,te)=>{var m=re(),A=D(m);{var H=f=>{Be(f,{label:"Carrier",content:(T,j=Ae)=>{{let ae=l(()=>ft(e(X))),Z=l(()=>e(b)||e(x));mt(T,{get formId(){return j()},get options(){return e(ae)},get disabled(){return e(Z)},get value(){return e(c)},set value(pe){d(c,pe,!0)}})}}})};W(A,f=>{e(X).length>0&&f(H)})}_(L,m)}});var s=h(w,2);se(s,{title:"Production Component Selection",children:(L,te)=>{var m=re(),A=D(m);nt(A,17,()=>V,st,(H,f,E)=>{var T=yt(),j=F(T);Re(j,"for","variables"+E);var ae=F(j,!0);R(j);var Z=h(j,2),pe=F(Z);be(pe,{formId:"variables"+E,get value(){return e(f).show},set value(ne){e(f).show=ne}}),R(Z);var Ke=h(Z,2);{var Qe=ne=>{var je=wt(),De=D(je);Re(De,"for","subdivision"+E);var Ie=h(De,2),Xe=F(Ie);be(Xe,{formId:"subdivision"+E,get value(){return e(f).subdivision},set value(Ze){e(f).subdivision=Ze}}),R(Ie),_(ne,je)};W(Ke,ne=>{e(f).show&&e(f).show_subdivision&&ne(Qe)})}R(T),Ue(()=>we(ae,e(f).title)),_(H,T)}),_(L,m)}});var S=h(s,2);se(S,{title:"Technology Selection",children:(L,te)=>{var m=xt(),A=D(m);{let f=l(()=>e(b)||e(x));de(A,{label:"Conversion",get elements(){return e(ve)},get disabled(){return e(f)},get value(){return e(Y)},set value(E){d(Y,E,!0)}})}var H=h(A,2);{let f=l(()=>e(b)||e(x));de(H,{label:"Storage",get elements(){return e(fe)},get disabled(){return e(f)},get value(){return e($)},set value(E){d($,E,!0)}})}_(L,m)}});var ee=h(S,2);{var he=L=>{se(L,{title:"Data Selection",children:(te,m)=>{var A=Ct(),H=D(A);Be(H,{label:"Normalization",content:(j,ae=Ae)=>{be(j,{get formId(){return ae()},get value(){return e(M)},set value(Z){d(M,Z,!0)}})}});var f=h(H,2);{let T=l(()=>e(b)||e(x));de(f,{label:"Nodes",get elements(){return e(J)},get disabled(){return e(T)},get value(){return e(K)},set value(j){d(K,j,!0)}})}var E=h(f,2);{let T=l(()=>e(b)||e(x));de(E,{label:"Years",get elements(){return e(z)},get disabled(){return e(T)},get value(){return e(q)},set value(j){d(q,j,!0)}})}_(te,A)}})};W(ee,L=>{!e(x)&&e(c)!=null&&L(he)})}_(g,I)};W(C,g=>{!e(b)&&e(a)&&g(v)})}_(t,i)}});var me=h(Ne,4),qe=F(me);{var Ge=t=>{var r=kt();_(t,r)},He=t=>{var r=re(),i=D(r);{var u=v=>{var g=Nt();_(v,g)},C=v=>{var g=re(),I=D(g);{var w=S=>{var ee=Ot();_(S,ee)},s=S=>{var ee=re(),he=D(ee);{var L=m=>{var A=jt();_(m,A)},te=m=>{ye(m,{type:"bar",get options(){return e(We)},get labels(){return e(Ce)},get datasets(){return e(ge)},get plot_name(){return e(_e)},onclick:Ve})};W(he,m=>{e(ge).length==0?m(L):m(te,!1)},!0)}_(S,ee)};W(I,S=>{e(X).length==0?S(w):S(s,!1)},!0)}_(v,g)};W(i,v=>{e(a)==null?v(u):v(C,!1)},!0)}_(t,r)};W(qe,t=>{e(b)||e(x)?t(Ge):t(He,!1)})}R(me);var Oe=h(me,2),Je=F(Oe);bt(Je,{get datasets(){return e(ge)},get labels(){return e(Ce)},get year(){return e(Q)},get tooltipSuffix(){return e(Se)}}),R(Oe),_(ce,ke),Te()}export{Vt as component};
