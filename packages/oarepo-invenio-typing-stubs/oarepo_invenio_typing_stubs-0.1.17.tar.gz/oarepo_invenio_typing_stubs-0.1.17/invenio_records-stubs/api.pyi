from __future__ import annotations

from collections.abc import Iterable
from datetime import datetime
from typing import Any, ClassVar, Dict, List, Optional, Self, Union
from uuid import UUID

from invenio_records.dumpers import Dumper
from invenio_records.dumpers.search import SearchDumper
from invenio_records.models import RecordMetadata
from jsonschema._format import FormatChecker  # type: ignore[import-untyped]

class RecordBase(dict[str, Any]):
    # class vars
    model_cls: ClassVar[type[RecordMetadata]]
    format_checker: ClassVar[Any]
    validator: ClassVar[Any]
    dumper: ClassVar[Dumper]
    enable_jsonref: ClassVar[bool]
    _extensions: ClassVar[list[Any]]

    # instance attrs
    model: Optional[RecordMetadata]

    def __init__(self, data: Any, model: Optional[RecordMetadata] = ..., **kwargs): ...
    @property
    def id(self) -> Optional[UUID]: ...
    @property
    def revision_id(self) -> Optional[int]: ...
    @property
    def created(self) -> Optional[datetime]: ...
    @property
    def updated(self) -> Optional[datetime]: ...
    @property
    def is_deleted(self) -> Optional[bool]: ...
    def validate(
        self,
        format_checker: Optional[FormatChecker] = ...,
        validator: Any | None = ...,
        **kwargs: Any,
    ) -> None: ...
    def _validate(
        self,
        format_checker: Optional[FormatChecker] = ...,
        validator: Any | None = ...,
        use_model: bool = ...,
    ) -> Dict[str, Any]: ...
    def replace_refs(self) -> Union[Self, Dict[str, Any]]: ...
    def clear_none(self, key: Optional[str] = ...): ...
    def dumps(
        self, dumper: Optional[Dumper | SearchDumper] = ...
    ) -> Dict[str, Any]: ...
    @classmethod
    def loads(
        cls, data: Dict[str, Any], loader: Optional[Dumper | SearchDumper] = ...
    ) -> Self: ...

class Record(RecordBase):
    # class var
    send_signals: ClassVar[bool]

    @classmethod
    def create(
        cls, data: Dict[str, Any], id_: Optional[UUID] = ..., **kwargs: Any
    ) -> Self: ...
    @classmethod
    def get_record(cls, id_: Union[UUID, str], with_deleted: bool = ...) -> Self: ...
    @classmethod
    def get_records(cls, ids: List[UUID], with_deleted: bool = ...) -> List[Self]: ...
    def patch(self, patch: List[Dict[str, Any]]) -> Self: ...
    def commit(
        self,
        format_checker: Optional[FormatChecker] = ...,
        validator: Any | None = ...,
        **kwargs: Any,
    ) -> Self: ...
    def delete(self, force: bool = ...) -> Self: ...
    def undelete(self) -> Self: ...
    def revert(self, revision_id: int) -> Self: ...
    @property
    def revisions(self) -> RevisionsIterator: ...

class RecordRevision(RecordBase):
    def __init__(self, model: Any): ...

class RevisionsIterator:
    def __init__(self, model: Any): ...
    def __len__(self) -> int: ...
    def __iter__(self) -> Self: ...
    def __next__(self) -> RecordRevision: ...
    def __getitem__(self, revision_id: int) -> RecordRevision: ...
    def __contains__(self, revision_id: int) -> bool: ...
    def __reversed__(self) -> Iterable[RecordRevision]: ...
