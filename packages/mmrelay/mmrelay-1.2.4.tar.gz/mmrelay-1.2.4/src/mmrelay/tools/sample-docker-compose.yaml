services:
  mmrelay:
    build: .
    container_name: mmrelay # Updated for consistent branding
    restart: unless-stopped
    stop_grace_period: 30s
    user: "${UID:-1000}:${GID:-1000}"
    environment:
      - TZ=UTC # Set timezone (PYTHONUNBUFFERED and MPLCONFIGDIR are set in Dockerfile)

    volumes:
      # Mount your config directory - create ~/.mmrelay/config.yaml first
      # Run 'make config' to set up the files
      # For non-SELinux systems (most common):
      - ${MMRELAY_HOME:-$HOME}/.mmrelay/config.yaml:/app/config.yaml:ro
      - ${MMRELAY_HOME:-$HOME}/.mmrelay:/app/data
      # For SELinux systems (RHEL/CentOS/Fedora), add :Z flag to prevent permission denied errors:
      # - ${MMRELAY_HOME:-$HOME}/.mmrelay/config.yaml:/app/config.yaml:ro,Z
      # - ${MMRELAY_HOME:-$HOME}/.mmrelay:/app/data:Z

      # For BLE connections, uncomment these lines (Linux only):
      # - /var/run/dbus:/var/run/dbus:ro

    # For BLE connections, uncomment these options (Linux only). See DOCKER.md for alternatives.
    # network_mode: host
    # security_opt:
    #   - apparmor=unconfined # Recommended for BLE to allow DBus communication
    # privileged: true # Alternative if apparmor=unconfined is not acceptable

    # Tip: For correct permissions and paths, ensure UID, GID, and MMRELAY_HOME are set in a .env file or exported
