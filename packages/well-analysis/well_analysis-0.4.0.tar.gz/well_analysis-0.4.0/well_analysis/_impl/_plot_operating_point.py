from._logger import logger
from sixgill.definitions import SystemVariables,ProfileVariables,Parameters,Constants
from._plot_utility import NA_plot
def plot_operating_point(self,thp=None):
	P='main_well';O=False;B=self
	try:
		if thp is not None:B.thp=thp*.980665+1.01325
		Q=[SystemVariables.PRESSURE,SystemVariables.TEMPERATURE,SystemVariables.VOLUME_FLOWRATE_LIQUID_STOCKTANK,SystemVariables.VOLUME_FLOWRATE_OIL_STOCKTANK,SystemVariables.VOLUME_FLOWRATE_WATER_STOCKTANK,SystemVariables.VOLUME_FLOWRATE_GAS_STOCKTANK,SystemVariables.GOR_STOCKTANK,SystemVariables.WATER_CUT_STOCKTANK,SystemVariables.VOLUME_FLOWRATE_GAS_STOCKTANK,SystemVariables.WATER_CUT_INSITU,SystemVariables.WELLHEAD_VOLUME_FLOWRATE_FLUID_INSITU,SystemVariables.OUTLET_VOLUME_FLOWRATE_GAS_STOCKTANK,SystemVariables.OUTLET_VOLUME_FLOWRATE_OIL_STOCKTANK,SystemVariables.OUTLET_VOLUME_FLOWRATE_WATER_STOCKTANK,SystemVariables.SYSTEM_OUTLET_TEMPERATURE,SystemVariables.BOTTOM_HOLE_PRESSURE,SystemVariables.OUTLET_GLR_STOCKTANK,SystemVariables.OUTLET_WATER_CUT_STOCKTANK];R=[ProfileVariables.TEMPERATURE,ProfileVariables.PRESSURE,ProfileVariables.ELEVATION];S={Parameters.NodalAnalysisSimulation.LIMITINFLOW:O,Parameters.NodalAnalysisSimulation.LIMITOUTFLOW:True,Parameters.NodalAnalysisSimulation.OUTFLOWPOINTS:50,Parameters.NodalAnalysisSimulation.INFLOWPOINTS:50,Parameters.NodalAnalysisSimulation.MAXFLOWRATETYPE:Constants.FlowRateType.LIQUIDFLOWRATE,Parameters.NodalAnalysisSimulation.MAXLIQUIDRATE:(B.q_oil+B.q_water)*5,Parameters.NodalAnalysisSimulation.MAXOUTFLOWPRESSURE:B.reservoir_pressure,Parameters.NodalAnalysisSimulation.OUTLETPRESSURE:B.thp,Parameters.NodalAnalysisSimulation.MAXGASRATE:B.q_gas*2};T={P:{Parameters.Boundary.PRESSURE:B.reservoir_pressure,Parameters.Boundary.TEMPERATURE:B.reservoir_temperature,Parameters.Boundary.USEGASRATIO:Constants.GasRatioOption.GOR,Parameters.Boundary.GOR:B.gor,Parameters.Boundary.USEWATERRATIO:Constants.WaterRatioOption.WATERCUT,Parameters.Boundary.WATERCUT:B.wc}};U={Parameters.NodalPoint.NODALTYPE:Constants.NodalPointType.DOWNHOLE,Parameters.NodalPoint.DEPTH:B.perforation_depth,Parameters.NodalPoint.WELLSTRINGTYPE:Constants.TubingSectionType.CASING,Parameters.NodalPoint.NAME:'NodalPoint'};A=B.model.tasks.nodalanalysis.run(producer=P,parameters=S,nodal_point_settings=U,inlet_conditions=T,system_variables=Q,profile_variables=R)
		if B.gas_well==O:C=A.operating_points[0].point_data[SystemVariables.NODAL_POINT_PRESSURE];V=A.operating_points[0].point_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_LIQUID_STOCKTANK];D=A.inflow_curves[0].curve_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_LIQUID_STOCKTANK];E=A.inflow_curves[0].curve_data[SystemVariables.NODAL_POINT_PRESSURE];F=A.outflow_curves[0].curve_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_LIQUID_STOCKTANK];G=A.outflow_curves[0].curve_data[SystemVariables.NODAL_POINT_PRESSURE];H=A.operating_envelope;I=A.operating_envelope.max_drawdown[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATEPRESSURE];J=A.operating_envelope.reservoir_pressure[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATEPRESSURE];K=A.operating_envelope.erosional_velocity[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATE];L=A.operating_envelope.aofp[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATE];M=A.operating_envelope.inversion_point[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATE];N=A.operating_envelope.liquid_loading[Parameters.NodalOperatingEnvelopePlot.LIQUIDFLOWRATE];NA_plot(E,D,G,F,C,V,H,gas_well=B.gas_well,well_name=B.well_name);W=I[0],J[0],K[0],L[0],M[0],N[0]
		else:C=A.operating_points[0].point_data[SystemVariables.NODAL_POINT_PRESSURE];X=A.operating_points[0].point_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_GAS_STOCKTANK];D=A.inflow_curves[0].curve_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_GAS_STOCKTANK];E=A.inflow_curves[0].curve_data[SystemVariables.NODAL_POINT_PRESSURE];F=A.outflow_curves[0].curve_data[SystemVariables.NODAL_POINT_VOLUME_FLOWRATE_GAS_STOCKTANK];G=A.outflow_curves[0].curve_data[SystemVariables.NODAL_POINT_PRESSURE];H=A.operating_envelope;I=A.operating_envelope.max_drawdown[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATEPRESSURE];J=A.operating_envelope.reservoir_pressure[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATEPRESSURE];K=A.operating_envelope.erosional_velocity[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATE];L=A.operating_envelope.aofp[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATE];M=A.operating_envelope.inversion_point[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATE];N=A.operating_envelope.liquid_loading[Parameters.NodalOperatingEnvelopePlot.GASFLOWRATE];NA_plot(E,D,G,F,C,X,H,gas_well=B.gas_well,well_name=B.well_name);W=I[0],J[0],K[0],L[0],M[0],N[0]
	except:logger.error('Nodal analysis failed.')