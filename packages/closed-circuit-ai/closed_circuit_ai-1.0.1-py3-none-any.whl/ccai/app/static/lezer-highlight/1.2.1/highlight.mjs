import{NodeProp as V}from"@lezer/common";var G=0,p=class s{constructor(t,a,i,n){this.name=t,this.set=a,this.base=i,this.modified=n,this.id=G++}toString(){let{name:t}=this;for(let a of this.modified)a.name&&(t=`${a.name}(${t})`);return t}static define(t,a){let i=typeof t=="string"?t:"?";if(t instanceof s&&(a=t),a?.base)throw new Error("Can not derive from a modified tag");let n=new s(i,[],null,[]);if(n.set.push(n),a)for(let o of a.set)n.set.push(o);return n}static defineModifier(t){let a=new E(t);return i=>i.modified.indexOf(a)>-1?i:E.get(i.base||i,i.modified.concat(a).sort((n,o)=>n.id-o.id))}},L=0,E=class s{constructor(t){this.name=t,this.instances=[],this.id=L++}static get(t,a){if(!a.length)return t;let i=a[0].instances.find(r=>r.base==t&&P(a,r.modified));if(i)return i;let n=[],o=new p(t.name,n,t,a);for(let r of a)r.instances.push(o);let g=Q(a);for(let r of t.set)if(!r.modified.length)for(let d of g)n.push(s.get(r,d));return o}};function P(s,t){return s.length==t.length&&s.every((a,i)=>a==t[i])}function Q(s){let t=[[]];for(let a=0;a<s.length;a++)for(let i=0,n=t.length;i<n;i++)t.push(t[i].concat(s[a]));return t.sort((a,i)=>i.length-a.length)}function _(s){let t=Object.create(null);for(let a in s){let i=s[a];Array.isArray(i)||(i=[i]);for(let n of a.split(" "))if(n){let o=[],g=2,r=n;for(let h=0;;){if(r=="..."&&h>0&&h+3==n.length){g=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!f)throw new RangeError("Invalid path: "+n);if(o.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),h+=f[0].length,h==n.length)break;let m=n[h++];if(h==n.length&&m=="!"){g=0;break}if(m!="/")throw new RangeError("Invalid path: "+n);r=n.slice(h)}let d=o.length-1,c=o[d];if(!c)throw new RangeError("Invalid path: "+n);let b=new M(i,g,d>0?o.slice(0,d):null);t[c]=b.sort(t[c])}}return z.add(t)}var z=new V,M=class{constructor(t,a,i,n){this.tags=t,this.mode=a,this.context=i,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}};M.empty=new M([],2,null);function U(s,t){let a=Object.create(null);for(let o of s)if(!Array.isArray(o.tag))a[o.tag.id]=o.class;else for(let g of o.tag)a[g.id]=o.class;let{scope:i,all:n=null}=t||{};return{style:o=>{let g=n;for(let r of o)for(let d of r.set){let c=a[d.id];if(c){g=g?g+" "+c:c;break}}return g},scope:i}}function W(s,t){let a=null;for(let i of s){let n=i.style(t);n&&(a=a?a+" "+n:n)}return a}function X(s,t,a,i=0,n=s.length){let o=new B(i,Array.isArray(t)?t:[t],a);o.highlightRange(s.cursor(),i,n,"",o.highlighters),o.flush(n)}function tt(s,t,a,i,n,o=0,g=s.length){let r=o;function d(c,b){if(!(c<=r)){for(let h=s.slice(r,c),f=0;;){let m=h.indexOf(`
`,f),R=m<0?h.length:m;if(R>f&&i(h.slice(f,R),b),m<0)break;n(),f=m+1}r=c}}X(t,a,(c,b,h)=>{d(c,""),d(b,h)},o,g),d(g,"")}var B=class{constructor(t,a,i){this.at=t,this.highlighters=a,this.span=i,this.class=""}startSpan(t,a){a!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=a)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,a,i,n,o){let{type:g,from:r,to:d}=t;if(r>=i||d<=a)return;g.isTop&&(o=this.highlighters.filter(m=>!m.scope||m.scope(g)));let c=n,b=Y(t)||M.empty,h=W(o,b.tags);if(h&&(c&&(c+=" "),c+=h,b.mode==1&&(n+=(n?" ":"")+h)),this.startSpan(Math.max(a,r),c),b.opaque)return;let f=t.tree&&t.tree.prop(V.mounted);if(f&&f.overlay){let m=t.node.enter(f.overlay[0].from+r,1),R=this.highlighters.filter(v=>!v.scope||v.scope(f.tree.type)),H=t.firstChild();for(let v=0,S=r;;v++){let O=v<f.overlay.length?f.overlay[v]:null,K=O?O.from+r:d,$=Math.max(a,S),T=Math.min(i,K);if($<T&&H)for(;t.from<T&&(this.highlightRange(t,$,T,n,o),this.startSpan(Math.min(T,t.to),c),!(t.to>=K||!t.nextSibling())););if(!O||K>i)break;S=O.to+r,S>a&&(this.highlightRange(m.cursor(),Math.max(a,O.from+r),Math.min(i,S),"",R),this.startSpan(Math.min(i,S),c))}H&&t.parent()}else if(t.firstChild()){f&&(n="");do if(!(t.to<=a)){if(t.from>=i)break;this.highlightRange(t,a,i,n,o),this.startSpan(Math.min(i,t.to),c)}while(t.nextSibling());t.parent()}}};function Y(s){let t=s.type.prop(z);for(;t&&t.context&&!s.matchContext(t.context);)t=t.next;return t||null}var e=p.define,C=e(),N=e(),F=e(N),J=e(N),x=e(),I=e(x),j=e(x),y=e(),w=e(y),u=e(),k=e(),D=e(),A=e(D),q=e(),l={comment:C,lineComment:e(C),blockComment:e(C),docComment:e(C),name:N,variableName:e(N),typeName:F,tagName:e(F),propertyName:J,attributeName:e(J),className:e(N),labelName:e(N),namespace:e(N),macroName:e(N),literal:x,string:I,docString:e(I),character:e(I),attributeValue:e(I),number:j,integer:e(j),float:e(j),bool:e(x),regexp:e(x),escape:e(x),color:e(x),url:e(x),keyword:u,self:e(u),null:e(u),atom:e(u),unit:e(u),modifier:e(u),operatorKeyword:e(u),controlKeyword:e(u),definitionKeyword:e(u),moduleKeyword:e(u),operator:k,derefOperator:e(k),arithmeticOperator:e(k),logicOperator:e(k),bitwiseOperator:e(k),compareOperator:e(k),updateOperator:e(k),definitionOperator:e(k),typeOperator:e(k),controlOperator:e(k),punctuation:D,separator:e(D),bracket:A,angleBracket:e(A),squareBracket:e(A),paren:e(A),brace:e(A),content:y,heading:w,heading1:e(w),heading2:e(w),heading3:e(w),heading4:e(w),heading5:e(w),heading6:e(w),contentSeparator:e(y),list:e(y),quote:e(y),emphasis:e(y),strong:e(y),link:e(y),monospace:e(y),strikethrough:e(y),inserted:e(),deleted:e(),changed:e(),invalid:e(),meta:q,documentMeta:e(q),annotation:e(q),processingInstruction:e(q),definition:p.defineModifier("definition"),constant:p.defineModifier("constant"),function:p.defineModifier("function"),standard:p.defineModifier("standard"),local:p.defineModifier("local"),special:p.defineModifier("special")};for(let s in l){let t=l[s];t instanceof p&&(t.name=s)}var et=U([{tag:l.link,class:"tok-link"},{tag:l.heading,class:"tok-heading"},{tag:l.emphasis,class:"tok-emphasis"},{tag:l.strong,class:"tok-strong"},{tag:l.keyword,class:"tok-keyword"},{tag:l.atom,class:"tok-atom"},{tag:l.bool,class:"tok-bool"},{tag:l.url,class:"tok-url"},{tag:l.labelName,class:"tok-labelName"},{tag:l.inserted,class:"tok-inserted"},{tag:l.deleted,class:"tok-deleted"},{tag:l.literal,class:"tok-literal"},{tag:l.string,class:"tok-string"},{tag:l.number,class:"tok-number"},{tag:[l.regexp,l.escape,l.special(l.string)],class:"tok-string2"},{tag:l.variableName,class:"tok-variableName"},{tag:l.local(l.variableName),class:"tok-variableName tok-local"},{tag:l.definition(l.variableName),class:"tok-variableName tok-definition"},{tag:l.special(l.variableName),class:"tok-variableName2"},{tag:l.definition(l.propertyName),class:"tok-propertyName tok-definition"},{tag:l.typeName,class:"tok-typeName"},{tag:l.namespace,class:"tok-namespace"},{tag:l.className,class:"tok-className"},{tag:l.macroName,class:"tok-macroName"},{tag:l.propertyName,class:"tok-propertyName"},{tag:l.operator,class:"tok-operator"},{tag:l.comment,class:"tok-comment"},{tag:l.meta,class:"tok-meta"},{tag:l.invalid,class:"tok-invalid"},{tag:l.punctuation,class:"tok-punctuation"}]);export{p as Tag,et as classHighlighter,Y as getStyleTags,tt as highlightCode,X as highlightTree,_ as styleTags,U as tagHighlighter,l as tags};
