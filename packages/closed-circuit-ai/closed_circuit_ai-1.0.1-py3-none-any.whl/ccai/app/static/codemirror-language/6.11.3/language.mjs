import{NodeProp as S,IterMode as ht,Tree as b,TreeFragment as V,Parser as Ee,NodeType as K,NodeSet as ft}from"@lezer/common";import{StateEffect as Z,StateField as de,Facet as T,EditorState as N,countColumn as ut,combineConfig as Fe,RangeSet as Ue,RangeSetBuilder as pe,Prec as We}from"@codemirror/state";import{ViewPlugin as Q,logException as ct,EditorView as y,Decoration as m,WidgetType as je,gutter as dt,GutterMarker as pt,Direction as $}from"@codemirror/view";import{tags as u,tagHighlighter as mt,highlightTree as gt,styleTags as kt}from"@lezer/highlight";var we=typeof Symbol>"u"?"__\u037C":Symbol.for("\u037C"),Y=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},D=class{constructor(e,t){this.rules=[];let{finish:r}=t||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function i(o,a,l,h){let f=[],c=/^@(\w+)\b/.exec(o[0]),g=c&&c[1]=="keyframes";if(c&&a==null)return l.push(o[0]+";");for(let d in a){let k=a[d];if(/&/.test(d))i(d.split(/,\s*/).map(v=>o.map(I=>v.replace(/&/,I))).reduce((v,I)=>v.concat(I)),k,l);else if(k&&typeof k=="object"){if(!c)throw new RangeError("The value of a property ("+d+") should be a primitive value.");i(s(d),k,f,g)}else k!=null&&f.push(d.replace(/_.*/,"").replace(/[A-Z]/g,v=>"-"+v.toLowerCase())+": "+k+";")}(f.length||g)&&l.push((r&&!c&&!h?o.map(r):o).join(", ")+" {"+f.join(" ")+"}")}for(let o in e)i(s(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=ve[we]||1;return ve[we]=e+1,"\u037C"+e.toString(36)}static mount(e,t,r){let s=e[Y],i=r&&r.nonce;s?i&&s.setNonce(i):s=new ee(e,i),s.mount(Array.isArray(t)?t:[t],e)}},Se=new Map,ee=class{constructor(e,t){let r=e.ownerDocument||e,s=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let i=Se.get(r);if(i)return e[Y]=i;this.sheet=new s.CSSStyleSheet,Se.set(r,this)}else this.styleTag=r.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[Y]=this}mount(e,t){let r=this.sheet,s=0,i=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<i&&l>-1&&(this.modules.splice(l,1),i--,l=-1),l==-1){if(this.modules.splice(i++,0,a),r)for(let h=0;h<a.rules.length;h++)r.insertRule(a.rules[h],s++)}else{for(;i<l;)s+=this.modules[i++].rules.length;s+=a.rules.length,i++}}if(r)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=t.head||t;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}};var te,A=new S;function Ve(n){return T.define({combine:n?e=>e.concat(n):void 0})}var bt=new S,p=class{constructor(e,t,r=[],s=""){this.data=e,this.name=s,N.prototype.hasOwnProperty("tree")||Object.defineProperty(N.prototype,"tree",{get(){return w(this)}}),this.parser=t,this.extension=[x.of(this),N.languageData.of((i,o,a)=>{let l=Te(i,o,a),h=l.type.prop(A);if(!h)return[];let f=i.facet(h),c=l.type.prop(bt);if(c){let g=l.resolve(o-l.from,a);for(let d of c)if(d.test(g,i)){let k=i.facet(d.facet);return d.type=="replace"?k:k.concat(f)}}return f})].concat(r)}isActiveAt(e,t,r=-1){return Te(e,t,r).type.prop(A)==this.data}findRegions(e){let t=e.facet(x);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],s=(i,o)=>{if(i.prop(A)==this.data){r.push({from:o,to:o+i.length});return}let a=i.prop(S.mounted);if(a){if(a.tree.prop(A)==this.data){if(a.overlay)for(let l of a.overlay)r.push({from:l.from+o,to:l.to+o});else r.push({from:o,to:o+i.length});return}else if(a.overlay){let l=r.length;if(s(a.tree,a.overlay[0].from+o),r.length>l)return}}for(let l=0;l<i.children.length;l++){let h=i.children[l];h instanceof b&&s(h,i.positions[l]+o)}};return s(w(e),0),r}get allowsNesting(){return!0}};p.setState=Z.define();function Te(n,e,t){let r=n.facet(x),s=w(n).topNode;if(!r||r.allowsNesting)for(let i=s;i;i=i.enter(e,t,ht.ExcludeBuffers))i.type.isTop&&(s=i);return s}var xe=class n extends p{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=Ve(e.languageData);return new n(t,e.parser.configure({props:[A.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new n(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}};function w(n){let e=n.field(p.state,!1);return e?e.tree:b.empty}function yt(n,e,t=50){var r;let s=(r=n.field(p.state,!1))===null||r===void 0?void 0:r.context;if(!s)return null;let i=s.viewport;s.updateViewport({from:0,to:e});let o=s.isDone(e)||s.work(t,e)?s.tree:null;return s.updateViewport(i),o}function pn(n,e=n.doc.length){var t;return((t=n.field(p.state,!1))===null||t===void 0?void 0:t.context.isDone(e))||!1}function mn(n,e=n.viewport.to,t=100){let r=yt(n.state,e,t);return r!=w(n.state)&&n.dispatch({}),!!r}function gn(n){var e;return((e=n.plugin($e))===null||e===void 0?void 0:e.isWorking())||!1}var se=class{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}},O=null,B=class n{constructor(e,t,r=[],s,i,o,a,l){this.parser=e,this.state=t,this.fragments=r,this.tree=s,this.treeLen=i,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new n(e,t,[],b.empty,0,r,[],null)}startParse(){return this.parser.startParse(new se(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=b.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(V.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(V.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=O;O=this;try{return e()}finally{O=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Ce(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:s,treeLen:i,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((h,f,c,g)=>l.push({fromA:h,toA:f,fromB:c,toB:g})),r=V.applyChanges(r,l),s=b.empty,i=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let h of this.skipped){let f=e.mapPos(h.from,1),c=e.mapPos(h.to,-1);f<c&&a.push({from:f,to:c})}}}return new n(this.parser,t,r,s,i,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:s,to:i}=this.skipped[r];s<e.to&&i>e.from&&(this.fragments=Ce(this.fragments,s,i),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Ee{createParse(t,r,s){let i=s[0].from,o=s[s.length-1].to;return{parsedPos:i,advance(){let l=O;if(l){for(let h of s)l.tempSkipped.push(h);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new b(K.none,[],[],o-i)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return O}};function Ce(n,e,t){return V.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}var R=class n{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new n(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=B.create(e.facet(x).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new n(r)}};p.state=de.define({create:R.init,update(n,e){for(let t of e.effects)if(t.is(p.setState))return t.value;return e.startState.facet(x)!=e.state.facet(x)?R.init(e.state):n.apply(e)}});var He=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(He=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});var ne=typeof navigator<"u"&&(!((te=navigator.scheduling)===null||te===void 0)&&te.isInputPending)?()=>navigator.scheduling.isInputPending():null,$e=Q.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(p.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(p.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=He(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:s}}=this.view,i=r.field(p.state);if(i.tree==i.context.tree&&i.context.isDone(s+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!ne?Math.max(25,e.timeRemaining()-5):1e9),a=i.context.treeLen<s&&r.doc.length>s+1e3,l=i.context.work(()=>ne&&ne()||Date.now()>o,s+(a?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(i.context.takeTree(),this.view.dispatch({effects:p.setState.of(new R(i.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(i.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ct(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),x=T.define({combine(n){return n.length?n[0]:null},enables:n=>[p.state,$e,y.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]}),Ae=class{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}},Pe=class n{constructor(e,t,r,s,i,o=void 0){this.name=e,this.alias=t,this.extensions=r,this.filename=s,this.loadFunc=i,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:r}=e;if(!t){if(!r)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(r)}return new n(e.name,(e.alias||[]).concat(e.name).map(s=>s.toLowerCase()),e.extensions||[],e.filename,t,r)}static matchFilename(e,t){for(let s of e)if(s.filename&&s.filename.test(t))return s;let r=/\.([^.]+)$/.exec(t);if(r){for(let s of e)if(s.extensions.indexOf(r[1])>-1)return s}return null}static matchLanguageName(e,t,r=!0){t=t.toLowerCase();for(let s of e)if(s.alias.some(i=>i==t))return s;if(r)for(let s of e)for(let i of s.alias){let o=t.indexOf(i);if(o>-1&&(i.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+i.length])))return s}return null}},wt=T.define(),ze=T.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function z(n){let e=n.facet(ze);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function _e(n,e){let t="",r=n.tabSize,s=n.facet(ze)[0];if(s=="	"){for(;e>=r;)t+="	",e-=r;s=" "}for(let i=0;i<e;i++)t+=s;return t}function qe(n,e){n instanceof N&&(n=new L(n));for(let r of n.state.facet(wt)){let s=r(n,e);if(s!==void 0)return s}let t=w(n.state);return t.length>=e?vt(n,t,e):null}function bn(n,e,t){let r=Object.create(null),s=new L(n,{overrideIndentation:o=>{var a;return(a=r[o])!==null&&a!==void 0?a:-1}}),i=[];for(let o=e;o<=t;){let a=n.doc.lineAt(o);o=a.to+1;let l=qe(s,a.from);if(l==null)continue;/\S/.test(a.text)||(l=0);let h=/^\s*/.exec(a.text)[0],f=_e(n,l);h!=f&&(r[a.from]=l,i.push({from:a.from,to:a.from+h.length,insert:f}))}return n.changes(i)}var L=class{constructor(e,t={}){this.state=e,this.options=t,this.unit=z(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:i}=this.options;return s!=null&&s>=r.from&&s<=r.to?i&&s==e?{text:"",from:e}:(t<0?s<e:s<=e)?{text:r.text.slice(s-r.from),from:s}:{text:r.text.slice(0,s-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:s}=this.lineAt(e,t);return r.slice(e-s,Math.min(r.length,e+100-s))}column(e,t=1){let{text:r,from:s}=this.lineAt(e,t),i=this.countColumn(r,e-s),o=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return o>-1&&(i+=o-this.countColumn(r,r.search(/\S|$/))),i}countColumn(e,t=e.length){return ut(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:s}=this.lineAt(e,t),i=this.options.overrideIndentation;if(i){let o=i(s);if(o>-1)return o}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},Ge=new S;function vt(n,e,t){let r=e.resolveStack(t),s=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(s!=r.node){let i=[];for(let o=s;o&&!(o.from<r.node.from||o.to>r.node.to||o.from==r.node.from&&o.type==r.node.type);o=o.parent)i.push(o);for(let o=i.length-1;o>=0;o--)r={node:i[o],next:r}}return Je(r,n,t)}function Je(n,e,t){for(let r=n;r;r=r.next){let s=Tt(r.node);if(s)return s(ie.create(e,t,r))}return 0}function St(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function Tt(n){let e=n.type.prop(Ge);if(e)return e;let t=n.firstChild,r;if(t&&(r=t.type.prop(S.closedBy))){let s=n.lastChild,i=s&&r.indexOf(s.name)>-1;return o=>Ke(o,!0,1,void 0,i&&!St(o)?s.from:void 0)}return n.parent==null?xt:null}function xt(){return 0}var ie=class n extends L{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new n(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(Ct(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return Je(this.context.next,this.base,this.pos)}};function Ct(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function At(n){let e=n.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let s=n.options.simulateBreak,i=n.state.doc.lineAt(t.from),o=s==null||s<=i.from?i.to:Math.min(i.to,s);for(let a=t.to;;){let l=e.childAfter(a);if(!l||l==r)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let h=/^ */.exec(i.text.slice(t.to-i.from))[0].length;return{from:t.from,to:t.to+h}}a=l.to}}function yn({closing:n,align:e=!0,units:t=1}){return r=>Ke(r,e,t,n)}function Ke(n,e,t,r,s){let i=n.textAfter,o=i.match(/^\s*/)[0].length,a=r&&i.slice(o,o+r.length)==r||s==n.pos+o,l=e?At(n):null;return l?a?n.column(l.from):n.column(l.to):n.baseIndent+(a?0:n.unit*t)}var wn=n=>n.baseIndent;function vn({except:n,units:e=1}={}){return t=>{let r=n&&n.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}var Pt=200;function Sn(){return N.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:r}=n.newSelection.main,s=t.lineAt(r);if(r>s.from+Pt)return n;let i=t.sliceString(s.from,r);if(!e.some(h=>h.test(i)))return n;let{state:o}=n,a=-1,l=[];for(let{head:h}of o.selection.ranges){let f=o.doc.lineAt(h);if(f.from==a)continue;a=f.from;let c=qe(o,f.from);if(c==null)continue;let g=/^\s*/.exec(f.text)[0],d=_e(o,c);g!=d&&l.push({from:f.from,to:f.from+g.length,insert:d})}return l.length?[n,{changes:l,sequential:!0}]:n})}var It=T.define(),Dt=new S;function Tn(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function Ot(n,e,t){let r=w(n);if(r.length<t)return null;let s=r.resolveStack(t,1),i=null;for(let o=s;o;o=o.next){let a=o.node;if(a.to<=t||a.from>t)continue;if(i&&a.from<e)break;let l=a.type.prop(Dt);if(l&&(a.to<r.length-50||r.length==n.doc.length||!Nt(a))){let h=l(a,n);h&&h.from<=t&&h.from>=e&&h.to>t&&(i=h)}}return i}function Nt(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function E(n,e,t){for(let r of n.facet(It)){let s=r(n,e,t);if(s)return s}return Ot(n,e,t)}function Ze(n,e){let t=e.mapPos(n.from,1),r=e.mapPos(n.to,-1);return t>=r?void 0:{from:t,to:r}}var W=Z.define({map:Ze}),P=Z.define({map:Ze});function me(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(r=>r.from<=t&&r.to>=t)||e.push(n.lineBlockAt(t));return e}var C=de.define({create(){return m.none},update(n,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,r)=>n=Ie(n,t,r)),n=n.map(e.changes);for(let t of e.effects)if(t.is(W)&&!Mt(n,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(ke),s=r?m.replace({widget:new oe(r(e.state,t.value))}):De;n=n.update({add:[s.range(t.value.from,t.value.to)]})}else t.is(P)&&(n=n.update({filter:(r,s)=>t.value.from!=r||t.value.to!=s,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(n=Ie(n,e.selection.main.head)),n},provide:n=>y.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(r,s)=>{t.push(r,s)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let r=n[t++],s=n[t++];if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid JSON for fold state");e.push(De.range(r,s))}return m.set(e,!0)}});function Ie(n,e,t=e){let r=!1;return n.between(e,t,(s,i)=>{s<t&&i>e&&(r=!0)}),r?n.update({filterFrom:e,filterTo:t,filter:(s,i)=>s>=t||i<=e}):n}function xn(n){return n.field(C,!1)||Ue.empty}function F(n,e,t){var r;let s=null;return(r=n.field(C,!1))===null||r===void 0||r.between(e,t,(i,o)=>{(!s||s.from>i)&&(s={from:i,to:o})}),s}function Mt(n,e,t){let r=!1;return n.between(e,e,(s,i)=>{s==e&&i==t&&(r=!0)}),r}function ge(n,e){return n.field(C,!1)?e:e.concat(Z.appendConfig.of(Qe()))}var Bt=n=>{for(let e of me(n)){let t=E(n.state,e.from,e.to);if(t)return n.dispatch({effects:ge(n.state,[W.of(t),_(n,t)])}),!0}return!1},Rt=n=>{if(!n.state.field(C,!1))return!1;let e=[];for(let t of me(n)){let r=F(n.state,t.from,t.to);r&&e.push(P.of(r),_(n,r,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function _(n,e,t=!0){let r=n.state.doc.lineAt(e.from).number,s=n.state.doc.lineAt(e.to).number;return y.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${r} ${n.state.phrase("to")} ${s}.`)}var Lt=n=>{let{state:e}=n,t=[];for(let r=0;r<e.doc.length;){let s=n.lineBlockAt(r),i=E(e,s.from,s.to);i&&t.push(W.of(i)),r=(i?n.lineBlockAt(i.to):s).to+1}return t.length&&n.dispatch({effects:ge(n.state,t)}),!!t.length},Et=n=>{let e=n.state.field(C,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(r,s)=>{t.push(P.of({from:r,to:s}))}),n.dispatch({effects:t}),!0};function Ft(n,e){for(let t=e;;){let r=E(n.state,t.from,t.to);if(r&&r.to>e.from)return r;if(!t.from)return null;t=n.lineBlockAt(t.from-1)}}var Cn=n=>{let e=[];for(let t of me(n)){let r=F(n.state,t.from,t.to);if(r)e.push(P.of(r),_(n,r,!1));else{let s=Ft(n,t);s&&e.push(W.of(s),_(n,s))}}return e.length>0&&n.dispatch({effects:ge(n.state,e)}),!!e.length},An=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Bt},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:Rt},{key:"Ctrl-Alt-[",run:Lt},{key:"Ctrl-Alt-]",run:Et}],Ut={placeholderDOM:null,preparePlaceholder:null,placeholderText:"\u2026"},ke=T.define({combine(n){return Fe(n,Ut)}});function Qe(n){let e=[C,jt];return n&&e.push(ke.of(n)),e}function Xe(n,e){let{state:t}=n,r=t.facet(ke),s=o=>{let a=n.lineBlockAt(n.posAtDOM(o.target)),l=F(n.state,a.from,a.to);l&&n.dispatch({effects:P.of(l)}),o.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(n,s,e);let i=document.createElement("span");return i.textContent=r.placeholderText,i.setAttribute("aria-label",t.phrase("folded code")),i.title=t.phrase("unfold"),i.className="cm-foldPlaceholder",i.onclick=s,i}var De=m.replace({widget:new class extends je{toDOM(n){return Xe(n,null)}}}),oe=class extends je{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return Xe(e,this.value)}},Wt={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1},M=class extends pt{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}};function Pn(n={}){let e={...Wt,...n},t=new M(e,!0),r=new M(e,!1),s=Q.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(x)!=o.state.facet(x)||o.startState.field(C,!1)!=o.state.field(C,!1)||w(o.startState)!=w(o.state)||e.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let a=new pe;for(let l of o.viewportLineBlocks){let h=F(o.state,l.from,l.to)?r:E(o.state,l.from,l.to)?t:null;h&&a.add(l.from,l.from,h)}return a.finish()}}),{domEventHandlers:i}=e;return[s,dt({class:"cm-foldGutter",markers(o){var a;return((a=o.plugin(s))===null||a===void 0?void 0:a.markers)||Ue.empty},initialSpacer(){return new M(e,!1)},domEventHandlers:{...i,click:(o,a,l)=>{if(i.click&&i.click(o,a,l))return!0;let h=F(o.state,a.from,a.to);if(h)return o.dispatch({effects:P.of(h)}),!0;let f=E(o.state,a.from,a.to);return f?(o.dispatch({effects:W.of(f)}),!0):!1}}}),Qe()]}var jt=y.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),q=class n{constructor(e,t){this.specs=e;let r;function s(a){let l=D.newName();return(r||(r=Object.create(null)))["."+l]=a,l}let i=typeof t.all=="string"?t.all:t.all?s(t.all):void 0,o=t.scope;this.scope=o instanceof p?a=>a.prop(A)==o.data:o?a=>a==o:void 0,this.style=mt(e.map(a=>({tag:a.tag,class:a.class||s(Object.assign({},a,{tag:null}))})),{all:i}).style,this.module=r?new D(r):null,this.themeType=t.themeType}static define(e,t){return new n(e,t||{})}},le=T.define(),Ye=T.define({combine(n){return n.length?[n[0]]:null}});function H(n){let e=n.facet(le);return e.length?e:n.facet(Ye)}function In(n,e){let t=[Vt],r;return n instanceof q&&(n.module&&t.push(y.styleModule.of(n.module)),r=n.themeType),e?.fallback?t.push(Ye.of(n)):r?t.push(le.computeN([y.darkTheme],s=>s.facet(y.darkTheme)==(r=="dark")?[n]:[])):t.push(le.of(n)),t}function Dn(n,e,t){let r=H(n),s=null;if(r){for(let i of r)if(!i.scope||t&&i.scope(t)){let o=i.style(e);o&&(s=s?s+" "+o:o)}}return s}var ae=class{constructor(e){this.markCache=Object.create(null),this.tree=w(e.state),this.decorations=this.buildDeco(e,H(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=w(e.state),r=H(e.state),s=r!=H(e.startState),{viewport:i}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<i.to&&!s&&t.type==this.tree.type&&o>=i.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=i.to)}buildDeco(e,t){if(!t||!this.tree.length)return m.none;let r=new pe;for(let{from:s,to:i}of e.visibleRanges)gt(this.tree,t,(o,a,l)=>{r.add(o,a,this.markCache[l]||(this.markCache[l]=m.mark({class:l})))},s,i);return r.finish()}},Vt=We.high(Q.fromClass(ae,{decorations:n=>n.decorations})),On=q.define([{tag:u.meta,color:"#404740"},{tag:u.link,textDecoration:"underline"},{tag:u.heading,textDecoration:"underline",fontWeight:"bold"},{tag:u.emphasis,fontStyle:"italic"},{tag:u.strong,fontWeight:"bold"},{tag:u.strikethrough,textDecoration:"line-through"},{tag:u.keyword,color:"#708"},{tag:[u.atom,u.bool,u.url,u.contentSeparator,u.labelName],color:"#219"},{tag:[u.literal,u.inserted],color:"#164"},{tag:[u.string,u.deleted],color:"#a11"},{tag:[u.regexp,u.escape,u.special(u.string)],color:"#e40"},{tag:u.definition(u.variableName),color:"#00f"},{tag:u.local(u.variableName),color:"#30a"},{tag:[u.typeName,u.namespace],color:"#085"},{tag:u.className,color:"#167"},{tag:[u.special(u.variableName),u.macroName],color:"#256"},{tag:u.definition(u.propertyName),color:"#00c"},{tag:u.comment,color:"#940"},{tag:u.invalid,color:"#f00"}]),Ht=y.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),et=1e4,tt="()[]{}",nt=T.define({combine(n){return Fe(n,{afterCursor:!0,brackets:tt,maxScanDistance:et,renderMatch:_t})}}),$t=m.mark({class:"cm-matchingBracket"}),zt=m.mark({class:"cm-nonmatchingBracket"});function _t(n){let e=[],t=n.matched?$t:zt;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}var qt=de.define({create(){return m.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],r=e.state.facet(nt);for(let s of e.state.selection.ranges){if(!s.empty)continue;let i=j(e.state,s.head,-1,r)||s.head>0&&j(e.state,s.head-1,1,r)||r.afterCursor&&(j(e.state,s.head,1,r)||s.head<e.state.doc.length&&j(e.state,s.head+1,-1,r));i&&(t=t.concat(r.renderMatch(i,e.state)))}return m.set(t,!0)},provide:n=>y.decorations.from(n)}),Gt=[qt,Ht];function Nn(n={}){return[nt.of(n),Gt]}var Jt=new S;function he(n,e,t){let r=n.prop(e<0?S.openedBy:S.closedBy);if(r)return r;if(n.name.length==1){let s=t.indexOf(n.name);if(s>-1&&s%2==(e<0?1:0))return[t[s+e]]}return null}function fe(n){let e=n.type.prop(Jt);return e?e(n.node):n}function j(n,e,t,r={}){let s=r.maxScanDistance||et,i=r.brackets||tt,o=w(n),a=o.resolveInner(e,t);for(let l=a;l;l=l.parent){let h=he(l.type,t,i);if(h&&l.from<l.to){let f=fe(l);if(f&&(t>0?e>=f.from&&e<f.to:e>f.from&&e<=f.to))return Kt(n,e,t,l,f,h,i)}}return Zt(n,e,t,o,a.type,s,i)}function Kt(n,e,t,r,s,i,o){let a=r.parent,l={from:s.from,to:s.to},h=0,f=a?.cursor();if(f&&(t<0?f.childBefore(r.from):f.childAfter(r.to)))do if(t<0?f.to<=r.from:f.from>=r.to){if(h==0&&i.indexOf(f.type.name)>-1&&f.from<f.to){let c=fe(f);return{start:l,end:c?{from:c.from,to:c.to}:void 0,matched:!0}}else if(he(f.type,t,o))h++;else if(he(f.type,-t,o)){if(h==0){let c=fe(f);return{start:l,end:c&&c.from<c.to?{from:c.from,to:c.to}:void 0,matched:!1}}h--}}while(t<0?f.prevSibling():f.nextSibling());return{start:l,matched:!1}}function Zt(n,e,t,r,s,i,o){let a=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=t>0)return null;let h={from:t<0?e-1:e,to:t>0?e+1:e},f=n.doc.iterRange(e,t>0?n.doc.length:0),c=0;for(let g=0;!f.next().done&&g<=i;){let d=f.value;t<0&&(g+=d.length);let k=e+g*t;for(let v=t>0?0:d.length-1,I=t>0?d.length:-1;v!=I;v+=t){let X=o.indexOf(d[v]);if(!(X<0||r.resolveInner(k+v,1).type!=s))if(X%2==0==t>0)c++;else{if(c==1)return{start:h,end:{from:k+v,to:k+v+1},matched:X>>1==l>>1};c--}}t>0&&(g+=d.length)}return f.done?{start:h,matched:!1}:null}function Oe(n,e,t,r=0,s=0){e==null&&(e=n.search(/[^\s\u00a0]/),e==-1&&(e=n.length));let i=s;for(let o=r;o<e;o++)n.charCodeAt(o)==9?i+=t-i%t:i++;return i}var G=class{constructor(e,t,r,s){this.string=e,this.tabSize=t,this.indentUnit=r,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),r;if(typeof e=="string"?r=t==e:r=t&&(e instanceof RegExp?e.test(t):e(t)),r)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Oe(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:Oe(this.string,null,this.tabSize)}match(e,t,r){if(typeof e=="string"){let s=o=>r?o.toLowerCase():o,i=this.string.substr(this.pos,e.length);return s(i)==s(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&t!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}};function Qt(n){return{name:n.name||"",token:n.token,blankLine:n.blankLine||(()=>{}),startState:n.startState||(()=>!0),copyState:n.copyState||Xt,indent:n.indent||(()=>null),languageData:n.languageData||{},tokenTable:n.tokenTable||ye,mergeTokens:n.mergeTokens!==!1}}function Xt(n){if(typeof n!="object")return n;let e={};for(let t in n){let r=n[t];e[t]=r instanceof Array?r.slice():r}return e}var Ne=new WeakMap,Me=class n extends p{constructor(e){let t=Ve(e.languageData),r=Qt(e),s,i=new class extends Ee{createParse(o,a,l){return new ue(s,o,a,l)}};super(t,i,[],e.name),this.topNode=nn(t,this),s=this,this.streamParser=r,this.stateAfter=new S({perNode:!0}),this.tokenTable=e.tokenTable?new J(r.tokenTable):tn}static define(e){return new n(e)}getIndent(e){let t,{overrideIndentation:r}=e.options;r&&(t=Ne.get(e.state),t!=null&&t<e.pos-1e4&&(t=void 0));let s=be(this,e.node.tree,e.node.from,e.node.from,t??e.pos),i,o;if(s?(o=s.state,i=s.pos+1):(o=this.streamParser.startState(e.unit),i=e.node.from),e.pos-i>1e4)return null;for(;i<e.pos;){let l=e.state.doc.lineAt(i),h=Math.min(e.pos,l.to);if(l.length){let f=r?r(l.from):-1,c=new G(l.text,e.state.tabSize,e.unit,f<0?void 0:f);for(;c.pos<h-l.from;)st(this.streamParser.token,c,o)}else this.streamParser.blankLine(o,e.unit);if(h==e.pos)break;i=l.to+1}let a=e.lineAt(e.pos);return r&&t==null&&Ne.set(e.state,a.from),this.streamParser.indent(o,/^\s*(.*)/.exec(a.text)[1],e)}get allowsNesting(){return!1}};function be(n,e,t,r,s){let i=t>=r&&t+e.length<=s&&e.prop(n.stateAfter);if(i)return{state:n.streamParser.copyState(i),pos:t+e.length};for(let o=e.children.length-1;o>=0;o--){let a=e.children[o],l=t+e.positions[o],h=a instanceof b&&l<s&&be(n,a,l,r,s);if(h)return h}return null}function rt(n,e,t,r,s){if(s&&t<=0&&r>=e.length)return e;!s&&t==0&&e.type==n.topNode&&(s=!0);for(let i=e.children.length-1;i>=0;i--){let o=e.positions[i],a=e.children[i],l;if(o<r&&a instanceof b){if(!(l=rt(n,a,t-o,r-o,s)))break;return s?new b(e.type,e.children.slice(0,i).concat(l),e.positions.slice(0,i+1),o+l.length):l}}return null}function Yt(n,e,t,r,s){for(let i of e){let o=i.from+(i.openStart?25:0),a=i.to-(i.openEnd?25:0),l=o<=t&&a>t&&be(n,i.tree,0-i.offset,t,a),h;if(l&&l.pos<=r&&(h=rt(n,i.tree,t+i.offset,l.pos+i.offset,!1)))return{state:l.state,tree:h}}return{state:n.streamParser.startState(s?z(s):4),tree:b.empty}}var ue=class{constructor(e,t,r,s){this.lang=e,this.input=t,this.fragments=r,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let i=B.get(),o=s[0].from,{state:a,tree:l}=Yt(e,r,o,this.to,i?.state);this.state=a,this.parsedPos=this.chunkStart=o+l.length;for(let h=0;h<l.children.length;h++)this.chunks.push(l.children[h]),this.chunkPos.push(l.positions[h]);i&&this.parsedPos<i.viewport.from-1e5&&s.some(h=>h.from<=i.viewport.from&&h.to>=i.viewport.from)&&(this.state=this.lang.streamParser.startState(z(i.state)),i.skipUntilInView(this.parsedPos,i.viewport.from),this.parsedPos=i.viewport.from),this.moveRangeIndex()}advance(){let e=B.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(t,this.chunkStart+512);for(e&&(r=Math.min(r,e.viewport.to));this.parsedPos<r;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let r=t.indexOf(`
`);r>-1&&(t=t.slice(0,r))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),r=e+t.length;for(let s=this.rangeIndex;;){let i=this.ranges[s].to;if(i>=r||(t=t.slice(0,i-(r-t.length)),s++,s==this.ranges.length))break;let o=this.ranges[s].from,a=this.lineAfter(o);t+=a,r=o+a.length}return{line:t,end:r}}skipGapsTo(e,t,r){for(;;){let s=this.ranges[this.rangeIndex].to,i=e+t;if(r>0?s>i:s>=i)break;let o=this.ranges[++this.rangeIndex].from;t+=o-s}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,r,s){let i=4;if(this.ranges.length>1){s=this.skipGapsTo(t,s,1),t+=s;let a=this.chunk.length;s=this.skipGapsTo(r,s,-1),r+=s,i+=this.chunk.length-a}let o=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&i==4&&o>=0&&this.chunk[o]==e&&this.chunk[o+2]==t?this.chunk[o+2]=r:this.chunk.push(e,t,r,i),s}parseLine(e){let{line:t,end:r}=this.nextLine(),s=0,{streamParser:i}=this.lang,o=new G(t,e?e.state.tabSize:4,e?z(e.state):2);if(o.eol())i.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let a=st(i.token,o,this.state);if(a&&(s=this.emitToken(this.lang.tokenTable.resolve(a),this.parsedPos+o.start,this.parsedPos+o.pos,s)),o.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=b.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:en,topID:0,maxBufferLength:512,reused:this.chunkReused});e=new b(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new b(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}};function st(n,e,t){e.start=e.pos;for(let r=0;r<10;r++){let s=n(e,t);if(e.pos>e.start)return s}throw new Error("Stream parser failed to advance stream.")}var ye=Object.create(null),U=[K.none],en=new ft(U),Be=[],Re=Object.create(null),it=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])it[n]=ot(ye,e);var J=class{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),it)}resolve(e){return e?this.table[e]||(this.table[e]=ot(this.extra,e)):0}},tn=new J(ye);function re(n,e){Be.indexOf(n)>-1||(Be.push(n),console.warn(e))}function ot(n,e){let t=[];for(let a of e.split(" ")){let l=[];for(let h of a.split(".")){let f=n[h]||u[h];f?typeof f=="function"?l.length?l=l.map(f):re(h,`Modifier ${h} used at start of tag`):l.length?re(h,`Tag ${h} used as modifier`):l=Array.isArray(f)?f:[f]:re(h,`Unknown highlighting tag ${h}`)}for(let h of l)t.push(h)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),s=r+" "+t.map(a=>a.id),i=Re[s];if(i)return i.id;let o=Re[s]=K.define({id:U.length,name:r,props:[kt({[r]:t})]});return U.push(o),o.id}function nn(n,e){let t=K.define({id:U.length,name:"Document",props:[A.add(()=>n),Ge.add(()=>r=>e.getIndent(r))],top:!0});return U.push(t),t}function lt(n){return n.length<=4096&&/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/.test(n)}function at(n){for(let e=n.iter();!e.next().done;)if(lt(e.value))return!0;return!1}function rn(n){let e=!1;return n.iterChanges((t,r,s,i,o)=>{!e&&at(o)&&(e=!0)}),e}var ce=T.define({combine:n=>n.some(e=>e)});function Mn(n={}){let e=[sn];return n.alwaysIsolate&&e.push(ce.of(!0)),e}var sn=Q.fromClass(class{constructor(n){this.always=n.state.facet(ce)||n.textDirection!=$.LTR||n.state.facet(y.perLineTextDirection),this.hasRTL=!this.always&&at(n.state.doc),this.tree=w(n.state),this.decorations=this.always||this.hasRTL?Le(n,this.tree,this.always):m.none}update(n){let e=n.state.facet(ce)||n.view.textDirection!=$.LTR||n.state.facet(y.perLineTextDirection);if(!e&&!this.hasRTL&&rn(n.changes)&&(this.hasRTL=!0),!e&&!this.hasRTL)return;let t=w(n.state);(e!=this.always||t!=this.tree||n.docChanged||n.viewportChanged)&&(this.tree=t,this.always=e,this.decorations=Le(n.view,t,e))}},{provide:n=>{function e(t){var r,s;return(s=(r=t.plugin(n))===null||r===void 0?void 0:r.decorations)!==null&&s!==void 0?s:m.none}return[y.outerDecorations.of(e),We.lowest(y.bidiIsolatedRanges.of(e))]}});function Le(n,e,t){let r=new pe,s=n.visibleRanges;t||(s=on(s,n.state.doc));for(let{from:i,to:o}of s)e.iterate({enter:a=>{let l=a.type.prop(S.isolate);l&&r.add(a.from,a.to,ln[l])},from:i,to:o});return r.finish()}function on(n,e){let t=e.iter(),r=0,s=[],i=null;for(let{from:o,to:a}of n)if(!(i&&i.to>o&&(o=i.to,o>=a)))for(r+t.value.length<o&&(t.next(o-(r+t.value.length)),r=o);;){let l=r,h=r+t.value.length;if(!t.lineBreak&&lt(t.value)&&(i&&i.to>l-10?i.to=Math.min(a,h):s.push(i={from:l,to:Math.min(a,h)})),h>=a)break;r=h,t.next()}return s}var ln={rtl:m.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"rtl"},bidiIsolate:$.RTL}),ltr:m.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"ltr"},bidiIsolate:$.LTR}),auto:m.mark({class:"cm-iso",inclusive:!0,attributes:{dir:"auto"},bidiIsolate:null})};export{se as DocInput,q as HighlightStyle,L as IndentContext,xe as LRLanguage,p as Language,Pe as LanguageDescription,Ae as LanguageSupport,B as ParseContext,Me as StreamLanguage,G as StringStream,ie as TreeIndentContext,Mn as bidiIsolates,Nn as bracketMatching,Jt as bracketMatchingHandle,Qe as codeFolding,vn as continuedIndent,On as defaultHighlightStyle,Ve as defineLanguageFacet,yn as delimitedIndent,yt as ensureSyntaxTree,wn as flatIndent,Lt as foldAll,Bt as foldCode,W as foldEffect,Pn as foldGutter,Tn as foldInside,An as foldKeymap,Dt as foldNodeProp,It as foldService,C as foldState,E as foldable,xn as foldedRanges,mn as forceParsing,z as getIndentUnit,qe as getIndentation,Dn as highlightingFor,Ge as indentNodeProp,Sn as indentOnInput,bn as indentRange,wt as indentService,_e as indentString,ze as indentUnit,x as language,A as languageDataProp,j as matchBrackets,bt as sublanguageProp,In as syntaxHighlighting,gn as syntaxParserRunning,w as syntaxTree,pn as syntaxTreeAvailable,Cn as toggleFold,Et as unfoldAll,Rt as unfoldCode,P as unfoldEffect};
