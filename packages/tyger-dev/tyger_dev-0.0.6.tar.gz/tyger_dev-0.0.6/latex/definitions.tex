%!TEX root = main.tex
\usepackage{xspace}
\usepackage{xparse}
\usepackage{amsmath}
\usepackage{amstext}
\usepackage{array}
\usepackage{mathpartir}
\usepackage{semantic}
\usepackage{listings}
\usepackage{ stmaryrd }
\PassOptionsToPackage{names,dvipsnames}{xcolor}
%Install in sublime: https://github.com/SublimeText/LaTeXTools/issues/657#issuecomment-414410430
%\usepackage{minted}


\definecolor{darkred}{rgb}{0.6,0.0,0.0}
\definecolor{darkgreen}{rgb}{0,0.50,0}
\definecolor{lightblue}{rgb}{0.0,0.42,0.91}
\definecolor{orange}{rgb}{0.99,0.48,0.13}
\definecolor{grass}{rgb}{0.18,0.80,0.18}
\definecolor{pink}{rgb}{0.97,0.15,0.45}




% General Setting of listings
\lstset{
  language=Scala,%
    xleftmargin=4pt,%
    aboveskip=3mm,%
    belowskip=3mm,%
    fontadjust=true,%
    columns=[c]fixed,%flexible
    keepspaces=true,%
    basewidth={0.58em, 0.53em},%
    tabsize=2,%
    basicstyle=\renewcommand{\baselinestretch}{0.85}\ttfamily,%
    commentstyle=\itshape,%
    keywordstyle=\bfseries,%
    mathescape=true,%
    escapechar=Â¤,%
    captionpos=b,%
    firstnumber=0,%
    numbers=left,
    numbersep=1.5mm,%
    numberstyle=\tiny\color{gray},%
    keywordstyle=\color{blue},
    commentstyle=\itshape\color{gray},
    identifierstyle=\color{black},
    stringstyle=\color{green!40!black},
    showstringspaces=false,
}
% 0. Basic Color Theme
\lstdefinestyle{colored}{ %
  basicstyle=\ttfamily,
  backgroundcolor=\color{white},
  commentstyle=\color{green}\itshape,
  keywordstyle=\color{blue}\bfseries\itshape,
  stringstyle=\color{red}, 
}
% 1. General Python Keywords List
\lstdefinelanguage{PythonPlus}[]{Python}{
  morekeywords=[1]{,as,assert,nonlocal,with,yield,self,True,False,None,} % Python builtin
  morekeywords=[2]{,__init__,__add__,__mul__,__div__,__sub__,__call__,__getitem__,__setitem__,__eq__,__ne__,__nonzero__,__rmul__,__radd__,__repr__,__str__,__get__,__truediv__,__pow__,__name__,__future__,__all__,}, % magic methods
  morekeywords=[3]{,object,type,isinstance,copy,deepcopy,zip,enumerate,reversed,list,set,len,dict,tuple,range,xrange,append,execfile,real,imag,reduce,str,repr,}, % common functions
  morekeywords=[4]{,Exception,NameError,IndexError,SyntaxError,TypeError,ValueError,OverflowError,ZeroDivisionError,}, % errors
  morekeywords=[5]{,ode,fsolve,sqrt,exp,sin,cos,arctan,arctan2,arccos,pi, array,norm,solve,dot,arange,isscalar,max,sum,flatten,shape,reshape,find,any,all,abs,plot,linspace,legend,quad,polyval,polyfit,hstack,concatenate,vstack,column_stack,empty,zeros,ones,rand,vander,grid,pcolor,eig,eigs,eigvals,svd,qr,tan,det,logspace,roll,min,mean,cumsum,cumprod,diff,vectorize,lstsq,cla,eye,xlabel,ylabel,squeeze,}, % numpy / math
}
% 2. New Language based on Python
\lstdefinelanguage{PyBrIM}[]{PythonPlus}{
  emph={d,E,a,Fc28,Fy,Fu,D,des,supplier,Material,Rectangle,PyElmt},
}
% 3. Extended theme
\lstdefinestyle{colorEX}{
  basicstyle=\ttfamily,
  backgroundcolor=\color{white},
  commentstyle=\color{darkgreen}\slshape,
  keywordstyle=\color{blue}\bfseries\itshape,
  keywordstyle=[2]\color{blue}\bfseries,
  keywordstyle=[3]\color{grass},
  keywordstyle=[4]\color{red},
  keywordstyle=[5]\color{orange},
  stringstyle=\color{darkred},
  emphstyle=\color{pink}\underbar,
}

\lstset{language=PyBrIM}

\definecolor{RoyalBlue}{HTML}{0071BC}
\definecolor{RedOrange}{HTML}{F26035}
\definecolor{Emerald}{HTML}{00A99D}
\DeclareDocumentCommand{\elab}{m}{{\color{RedOrange} #1}}



\DeclareDocumentCommand{\p}{O{}}{p_{#1}}
\DeclareDocumentCommand{\s}{O{}}{s_{#1}}
\DeclareDocumentCommand{\sp}{O{}}{s'_{#1}}
\DeclareDocumentCommand{\e}{O{}}{e_{#1}}
\DeclareDocumentCommand{\ep}{O{}}{e'_{#1}}
\DeclareDocumentCommand{\epp}{O{}}{e''_{#1}}
\DeclareDocumentCommand{\T}{O{}}{T_{#1}}
\DeclareDocumentCommand{\Tp}{O{}}{T'_{#1}}
\DeclareDocumentCommand{\S}{O{}}{S_{#1}}
\DeclareDocumentCommand{\arg}{O{}}{a_{#1}}
\DeclareDocumentCommand{\b}{O{}}{b_{#1}}
\DeclareDocumentCommand{\bp}{O{}}{b'_{#1}}
\DeclareDocumentCommand{\A}{O{}}{A_{#1}}
\DeclareDocumentCommand{\B}{O{}}{B_{#1}}
\DeclareDocumentCommand{\ev}{O{}}{\varepsilon_{#1}}
\DeclareDocumentCommand{\evp}{O{}}{\varepsilon'_{#1}}

%Types
\DeclareDocumentCommand{\Int}{}{\mathsf{Int}}
\DeclareDocumentCommand{\Bool}{}{\mathsf{Bool}}
\newcommand{\?}{\textsf{\upshape ?}}
\DeclareDocumentCommand{\List}{m}{[#1]}
\DeclareDocumentCommand{\Tuple}{m}{(#1)}

%Stmts
\DeclareDocumentCommand{\Expr}{m}{\mathsf{expr}~#1}
\DeclareDocumentCommand{\Block}{m}{\{#1\}}
\DeclareDocumentCommand{\Def}{m m m O{\overline{\s}}}{\mathsf{def}~{#1}(#2): #3~\Block{#4}}
\DeclareDocumentCommand{\Assign}{m m}{#1 = #2}
\DeclareDocumentCommand{\TAssign}{m m m}{#1: #2 = #3}
\DeclareDocumentCommand{\Return}{m}{\mathsf{return}~#1}
\DeclareDocumentCommand{\Ite}{m m m}{\mathsf{if}~#1~\mathsf{then}~#2~\mathsf{else}~#3}
\DeclareDocumentCommand{\While}{m m m}{\mathsf{while}~#1~\mathsf{do}~#2~\mathsf{else}~#3}
\DeclareDocumentCommand{\For}{m m m m}{\mathsf{for}~#1~\mathsf{in}~#2~\mathsf{do}~#3~\mathsf{else}~#4}
\DeclareDocumentCommand{\AugAssign}{m m}{#1 \mathbin{\mathrel{+}=} #2}
\DeclareDocumentCommand{\Pass}{}{\mathsf{pass}}
\DeclareDocumentCommand{\ClassDef}{m m m}{\mathsf{class}~#1~\mathsf{extends}~#2~#3}
\DeclareDocumentCommand{\binop}{}{\odot}
\DeclareDocumentCommand{\cmp}{}{\boxdot}

%Envs
\DeclareDocumentCommand{\Ctx}{O{}}{C_{#1}}
\DeclareDocumentCommand{\Ctxp}{O{}}{C'_{#1}}
\DeclareDocumentCommand{\CtxNE}{O{}}{\Ctx[\bot]}
\DeclareDocumentCommand{\LEnv}{O{}}{\Delta_{#1}}
\DeclareDocumentCommand{\LEnvp}{O{}}{\Delta'_{#1}}
\DeclareDocumentCommand{\LEnvpp}{O{}}{\Delta''_{#1}}

%Jugdgments
\DeclareDocumentCommand{\JStmts}{m m O{\LEnv} O{\Ctx} O{\LEnvp}}{#4; #3 \vdash #1: #5 \leadsto \elab{#2}}
\DeclareDocumentCommand{\JStmt}{m m O{\LEnv} O{\Ctx} O{\LEnv}}{#4; #3 \vdash #1 : #5 \leadsto \elab{#2}}
\DeclareDocumentCommand{\JExpr}{m m O{\LEnv} O{\Ctx} O{\T}}{#4; #3 \vdash #1 : #5 \leadsto \elab{#2}}

%Rels
\DeclareDocumentCommand{\rel}{m m}{R(#1,#2)}

%metafunctions
\DeclareDocumentCommand{\getTypeFromAnnotation}{m}{\mathit{toType}(#1)}
%\DeclareDocumentCommand{\getTypeFromAnnotation}{m}{\lceil #1 \rceil}
\DeclareDocumentCommand{\collectSignatures}{}{\mathit{collectSignatures}}
\DeclareDocumentCommand{\getAssignedVars}{}{\mathit{getAssignedVars}}
\DeclareDocumentCommand{\updateType}{m m m}{\mathit{taintTpe}_{#1}(#2,#3)}
\DeclareDocumentCommand{\updateCtx}{m m m}{\mathit{taintCtx}_{#1}(#2,#3)}
\DeclareDocumentCommand{\insertAnnotation}{m m m O{\Ctx}}{#4 \vdash #1 :: #2 : #2 \leadsto {\color{RedOrange} #3}}
\DeclareDocumentCommand{\assignToAst}{O{\Ctx} O{\LEnv} m}{\mathit{assignToAst}(#1, #2, #3)}
\DeclareDocumentCommand{\annAssignToAst}{O{\Ctx} O{\LEnv} m}{\mathit{annAssignToAst}(#1, #2, #3)}
\DeclareDocumentCommand{\unify}{}{\mathit{unify}}
\DeclareDocumentCommand{\postProcess}{O{\Ctx} O{\LEnv} m}{\{#3\}^{#1}_{#2}}
\DeclareDocumentCommand{\cast}{m m m m}{\elab{#1}: #2 \Rightarrow #3 \leadsto \elab{#4}}
\DeclareDocumentCommand{\extract}{m m}{#1 \triangleright #2}
\DeclareDocumentCommand{\Interior}{m m O{R}}{\mathcal{I}_{#3}(#1,#2)}
\DeclareDocumentCommand{\Wrap}{m m}{\llparenthesis#1#2\rrparenthesis}


\newcommand{\dom}{\mathit{dom}}
\newcommand{\cod}{\mathit{cod}}